def calculate_metrics(model, X, y_true, dataset_name):
    """Вычисляет метрики для датасета"""
    y_pred = model.predict(X)
    return {
        'dataset': dataset_name,
        'R2': r2_score(y_true, y_pred),
        'MAE': mean_absolute_error(y_true, y_pred),
        'RMSE': mean_squared_error(y_true, y_pred, squared=False)
    }


# Результирующий DataFrame
metrics_df = pd.DataFrame()


# Сбор метрик
    metrics = [
        calculate_metrics(model, train_pool, train_data[target], 'train'),
        calculate_metrics(model, val_pool, val_data[target], 'val'),
        calculate_metrics(model, test_pool, test_data[target], 'test')
    ]
    
    # Добавление в общий DataFrame
    target_metrics = pd.DataFrame(metrics)
    target_metrics['target'] = target
    metrics_df = pd.concat([metrics_df, target_metrics], ignore_index=True)

metrics_df = metrics_df[['target', 'dataset', 'R2', 'MAE', 'RMSE']]
