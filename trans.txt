 %%time
for feat_df, filename in tqdm.tqdm(zip(df_features_lst, filenames), total=len(df_features_lst)):
    duplicates = feat_df[feat_df.duplicated(subset=PRIMARY_KEY, keep=False)]
    diff_cols = (duplicates
                .groupby(PRIMARY_KEY)
                .nunique()
                .gt(1)
                .any(axis=0))
    res = diff_cols[diff_cols].index.tolist()
    feat_df = feat_df.drop(res, axis=1)
    
    MISSING_THRESHOLD = 0.8  # Доля пропусков не более чем
    
    missing_df = preprocessing.analyze_missing_values(feat_df, missing_threshold=MISSING_THRESHOLD)
    if missing_df is not None and not missing_df.empty:
        missing_df.to_excel(f'{REPORTS_FOLDER}/{filename}_missing.xlsx')
        feat_df = preprocessing.remove_columns_by_missing(feat_df, missing_df, 0.8)
    
    merged_df = pd.merge(merged_df, feat_df, on=PRIMARY_KEY, how='left')
    print(feat_df.shape)
    print(merged_df.shape)
    # gc.collect()
