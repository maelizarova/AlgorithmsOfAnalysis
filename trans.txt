from openpyxl import load_workbook
import os

def merge_excel_files(file_paths, final_output):
    """
    Объединяет несколько Excel-файлов в один, копируя листы.
    
    Parameters:
        file_paths (list): Список путей к файлам для объединения
        final_output (str): Путь для итогового файла
    """
    final_wb = load_workbook(file_paths[0]) if os.path.exists(file_paths[0]) else None
    
    for file in file_paths[1:]:
        if not os.path.exists(file):
            continue
        
        source_wb = load_workbook(file)
        if final_wb is None:
            final_wb = source_wb
            continue
            
        for sheet_name in source_wb.sheetnames:
            # Если лист уже существует, переименовываем (добавляем "_2")
            new_sheet_name = sheet_name
            if new_sheet_name in final_wb.sheetnames:
                new_sheet_name = f"{sheet_name}_2"
            
            # Копируем лист
            source_sheet = source_wb[sheet_name]
            new_sheet = final_wb.create_sheet(new_sheet_name)
            
            # Копируем данные и стили
            for row in source_sheet.iter_rows():
                for cell in row:
                    new_sheet[cell.coordinate].value = cell.value
                    if cell.has_style:
                        new_sheet[cell.coordinate].font = cell.font.copy()
                        new_sheet[cell.coordinate].border = cell.border.copy()
                        new_sheet[cell.coordinate].fill = cell.fill.copy()
                        new_sheet[cell.coordinate].alignment = cell.alignment.copy()
    
    if final_wb:
        final_wb.save(final_output)
        print(f"Файлы объединены в: {final_output}")
    else:
        print("Нет файлов для объединения!")

# Пример использования:
merge_excel_files(
    ["file1.xlsx", "file2.xlsx", "file3.xlsx"],
    "merged_result.xlsx"
)
