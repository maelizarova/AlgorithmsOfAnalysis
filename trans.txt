with pd.ExcelWriter('output.xlsx', engine='openpyxl') as writer:
    # Записываем данные
    psi_table.to_excel(
        writer,
        sheet_name=sheet_name,
        startrow=metrics_df.shape[0] + monthly_counts.T.shape[0] + 6,
        index=True
    )
    
    # Получаем лист
    ws = writer.sheets[sheet_name]
    
    # Находим стартовую строку (где начинается psi_table)
    start_row = metrics_df.shape[0] + monthly_counts.T.shape[0] + 6 + 1  # +1 (заголовок)
    
    # Форматируем строку с датами (если они в columns)
    for col_num, date in enumerate(psi_table.columns, start=2):  # start=2, т.к. 1-я колонка — индекс
        cell = ws.cell(row=start_row, column=col_num)
        if isinstance(date, (pd.Timestamp, datetime.datetime)):  # Если дата — datetime
            cell.number_format = 'YYYY-MM-DD'  # Формат без времени
            cell.value = date  # Перезаписываем, чтобы формат применился
