create or replace PROCEDURE            "EMA_COLLECT_FEAT_DM_MRK_TRANSACTION"
(in_table in VARCHAR2,
  out_table in VARCHAR2
 )
AUTHID CURRENT_USER
IS 
my_str clob;
add_str clob; 
tmp_table_1 VARCHAR2(100);
tmp_table_2 VARCHAR2(100);
out_table_1 VARCHAR2(100);
out_table_2 VARCHAR2(100);
out_table_3 VARCHAR2(100);

  -- Универсальная процедура для удаления таблицы, игнорируя ошибку, если таблица не существует
  PROCEDURE drop_table_if_exists(table_name IN VARCHAR2) IS
  BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE ' || table_name;
  EXCEPTION
    WHEN OTHERS THEN
      IF SQLCODE = -942 THEN
        NULL;  -- Игнорируем ошибку "таблица не существует"
      ELSE
        RAISE;  -- Для других ошибок выбрасываем исключение
      END IF;
  END drop_table_if_exists;

BEGIN
-- 0) Промежуточная таблица для сохранения результатов
tmp_table_1 := in_table ||'_trans_p1';
tmp_table_2 := in_table ||'_trans_p2';
out_table_1 := out_table || '_1';
out_table_2 := out_table || '_2';
out_table_3 := out_table || '_3'; 
-- 1) Удаляем уже существующие таблицы
drop_table_if_exists(tmp_table_1);
drop_table_if_exists(tmp_table_2);
drop_table_if_exists(out_table_1);
drop_table_if_exists(out_table_2);
drop_table_if_exists(out_table_3);

drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_00')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_0')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_1')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_2')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_3')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_4')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_5')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_6')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_7')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_8')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_9')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_10')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_11')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_12')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_13')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_14')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_15')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_16')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_17')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_18')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_19')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_20')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_21')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_22')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_23')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_24')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_25')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_26')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_27')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_28')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_29')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_30')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_31')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_32')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_33')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_34')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_35')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_36')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_37')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_38')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_39')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_40')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_41')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_42')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_43')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_44')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_45')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_46')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_47')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_48')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_49')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_50')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_51')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_52')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_53')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_54')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_55')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_56')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_57')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_58')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_59')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_60')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_61')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_62')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_63')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_64')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_65')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_66')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_67')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_68')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_69')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_70')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_71')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_72')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_73')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_74')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_75')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_76')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_77')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_78')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_79')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_80')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_81')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_82')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_83')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_84')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_85')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_86')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_87')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_88')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_89')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_90')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_91')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_92')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_93')));



execute immediate
'
create table '|| tmp_table_1 ||' as 
select /*+parallel(16)*/ 
	a.client_did,
	a.report_date,
	dm.transaction_dtm,
	dm.amount_rur,
	dm.direction,
	c.categ
from '||in_table||' a
join DM_MRK.DM_MRK_TRANSACTION dm
	on  a.client_did = dm.client_did 
	and dm.transaction_dtm < a.report_date 
	and dm.transaction_dtm >= a.report_date - 730
left join sb_dirkaim.ema_mcc_category c
	on dm.mcc_code = c.mcc_code
';

execute immediate
'
create table '|| tmp_table_2 ||' as
select /*+parallel(16)*/ 
	client_did,
	report_date,
	direction,
	categ,
	trunc(transaction_dtm) as transaction_dtm,
	sum(amount_rur) as amount_rur,
	count(amount_rur) as amount_rur_cnt
from '|| tmp_table_1 ||'
group by client_did, report_date, direction, categ, trunc(transaction_dtm)
';

execute immediate 'create index idx_ema_'|| tmp_table_2 ||' on '|| tmp_table_2 ||'(categ) PARALLEL 16';
execute immediate 'alter index idx_ema_'|| tmp_table_2 ||' NOPARALLEL';


execute immediate
'
create table '||in_table||'_TRANS_TEMP_0 as
select /*+parallel(8)*/ 
	client_did, 
	report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_2m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_2m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_4m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_4m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_12m,
	
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -5) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_5m,

	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_2m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_4m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_total_trans_avg_sum_12m,

	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_2m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_4m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_avg_cnt_12m,

    -- Агрегаты за предыдущие 12 месяцев (от 24 до 12 месяцев до отчетной даты)
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -24) AND transaction_dtm < ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_24_12,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -24) AND transaction_dtm < ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_total_trans_sum_24_12,
	
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -10) AND transaction_dtm < ADD_MONTHS(report_date, -5) THEN amount_rur_cnt ELSE null END) AS transaction_total_trans_cnt_10_5,
    -- Первая и последняя транзакция
    MIN(transaction_dtm) AS transaction_first_trans_dt,
    MAX(transaction_dtm) AS transaction_last_trans_dt,

    -- Максимальные транзакции
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE NULL END) AS transaction_max_trans_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur ELSE NULL END) AS transaction_max_trans_2m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE NULL END) AS transaction_max_trans_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur ELSE NULL END) AS transaction_max_trans_4m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE NULL END) AS transaction_max_trans_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE NULL END) AS transaction_max_trans_12m,

    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) AND transaction_dtm < ADD_MONTHS(report_date, -1) THEN amount_rur ELSE NULL END) AS transaction_max_trans_prev_1m,  
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) AND transaction_dtm < ADD_MONTHS(report_date, -3) THEN amount_rur ELSE NULL END) AS transaction_max_trans_prev_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) AND transaction_dtm < ADD_MONTHS(report_date, -6) THEN amount_rur ELSE NULL END) AS transaction_max_trans_prev_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -24) AND transaction_dtm < ADD_MONTHS(report_date, -12) THEN amount_rur ELSE NULL END) AS transaction_max_trans_prev_12m,

    -- Минимальные транзакции
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE NULL END) AS transaction_min_trans_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) THEN amount_rur ELSE NULL END) AS transaction_min_trans_2m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE NULL END) AS transaction_min_trans_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -4) THEN amount_rur ELSE NULL END) AS transaction_min_trans_4m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE NULL END) AS transaction_min_trans_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE NULL END) AS transaction_min_trans_12m,

    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -2) AND transaction_dtm < ADD_MONTHS(report_date, -1) THEN amount_rur ELSE NULL END) AS transaction_min_trans_prev_1m,  
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) AND transaction_dtm < ADD_MONTHS(report_date, -3) THEN amount_rur ELSE NULL END) AS transaction_min_trans_prev_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) AND transaction_dtm < ADD_MONTHS(report_date, -6) THEN amount_rur ELSE NULL END) AS transaction_min_trans_prev_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -24) AND transaction_dtm < ADD_MONTHS(report_date, -12) THEN amount_rur ELSE NULL END) AS transaction_min_trans_prev_12m

from '|| tmp_table_2 ||'  
where direction = ''D''
group by client_did, report_date
';


execute immediate
'
create table '||in_table||'_TRANS_TEMP_1 as
select /*+parallel(8)*/ 
	client_did, 
	report_date,
	-- Дом и ремонт
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_cnt_1m,
	SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_dom_rem_trans_sum_1m,
	MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_dom_rem_trans_max_1m,
	MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_dom_rem_trans_min_1m,
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_cnt_3m,
	SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_dom_rem_trans_sum_3m,
	MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_dom_rem_trans_max_3m,
	MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_dom_rem_trans_min_3m,
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_cnt_6m,
	SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_dom_rem_trans_sum_6m,
	MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_dom_rem_trans_max_6m,
	MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_dom_rem_trans_min_6m,
	COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_cnt_12m,
	SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_dom_rem_trans_sum_12m,
	MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_dom_rem_trans_max_12m,
	MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_dom_rem_trans_min_12m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_dom_rem_trans_avg_sum_1m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_dom_rem_trans_avg_sum_3m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_dom_rem_trans_avg_sum_6m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_dom_rem_trans_avg_sum_12m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_avg_cnt_1m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_avg_cnt_3m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_avg_cnt_6m,
	AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_dom_rem_trans_avg_cnt_12m
from '|| tmp_table_2 ||'  
where categ = ''Дом и ремонт'' and direction = ''D''
group by client_did, report_date
';


-- 2. Кафе и рестораны
execute immediate
'
create table '||in_table||'_TRANS_TEMP_2 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_cafe_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_cafe_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_cafe_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_cafe_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_cafe_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_cafe_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_cafe_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_cafe_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_cafe_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_cafe_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_cafe_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_cafe_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_cafe_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_cafe_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_cafe_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_cafe_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cafe_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Кафе и рестораны'' and direction = ''D'' 
group by client_did, report_date
';

-- 3. Аренда авто
execute immediate
'
create table '||in_table||'_TRANS_TEMP_3 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_rent_auto_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_rent_auto_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_rent_auto_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_rent_auto_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_rent_auto_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_rent_auto_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_rent_auto_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_rent_auto_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_rent_auto_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_rent_auto_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_rent_auto_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_rent_auto_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_rent_auto_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_rent_auto_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_rent_auto_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_rent_auto_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_rent_auto_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Аренда авто'' and direction = ''D'' 
group by client_did, report_date
';

-- 4. Транспорт
execute immediate
'
create table '||in_table||'_TRANS_TEMP_4 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_transport_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_transport_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_transport_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_transport_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_transport_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_transport_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_transport_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_transport_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_transport_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_transport_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_transport_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_transport_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_transport_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_transport_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_transport_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_transport_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_transport_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Транспорт'' and direction = ''D'' 
group by client_did, report_date
';

-- 5. Путешествия
execute immediate
'
create table '||in_table||'_TRANS_TEMP_5 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_travel_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_travel_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_travel_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_travel_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_travel_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_travel_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_travel_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_travel_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_travel_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_travel_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_travel_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_travel_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_travel_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_travel_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_travel_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_travel_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_travel_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Путешествия'' and direction = ''D'' 
group by client_did, report_date
';

-- 6. Медицина
execute immediate
'
create table '||in_table||'_TRANS_TEMP_6 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_medicine_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_medicine_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_medicine_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_medicine_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_medicine_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_medicine_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_medicine_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_medicine_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_medicine_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_medicine_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_medicine_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_medicine_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_medicine_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_medicine_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_medicine_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_medicine_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_medicine_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Медицина'' and direction = ''D'' 
group by client_did, report_date
';

-- 7. Онлайн магазины
execute immediate
'
create table '||in_table||'_TRANS_TEMP_7 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_online_shops_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_online_shops_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_online_shops_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_online_shops_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_online_shops_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_online_shops_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_online_shops_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_online_shops_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_online_shops_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_online_shops_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_online_shops_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_online_shops_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_online_shops_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_online_shops_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_online_shops_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_online_shops_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_online_shops_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Онлайн магазины'' and direction = ''D'' 
group by client_did, report_date
';

-- 8. Музыка
execute immediate
'
create table '||in_table||'_TRANS_TEMP_8 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_music_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_music_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_music_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_music_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_music_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_music_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_music_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_music_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_music_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_music_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_music_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_music_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_music_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_music_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_music_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_music_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_music_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Музыка'' and direction = ''D'' 
group by client_did, report_date
';

-- 9. Ломбарды
execute immediate
'
create table '||in_table||'_TRANS_TEMP_9 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_lombards_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_lombards_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_lombards_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_lombards_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_lombards_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_lombards_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_lombards_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_lombards_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_lombards_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_lombards_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_lombards_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_lombards_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_lombards_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_lombards_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_lombards_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_lombards_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_lombards_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Ломбарды'' and direction = ''D'' 
group by client_did, report_date
';

-- 10. Зоомагазины
execute immediate
'
create table '||in_table||'_TRANS_TEMP_10 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_zoo_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_zoo_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_zoo_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_zoo_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_zoo_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_zoo_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_zoo_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_zoo_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_zoo_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_zoo_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_zoo_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_zoo_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_zoo_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_zoo_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_zoo_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_zoo_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_zoo_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Зоомагазины'' and direction = ''D'' 
group by client_did, report_date
';

-- 11. Авиабилеты
execute immediate
'
create table '||in_table||'_TRANS_TEMP_11 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_air_tickets_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_air_tickets_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_air_tickets_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_air_tickets_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_air_tickets_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_air_tickets_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_air_tickets_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_air_tickets_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_air_tickets_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_air_tickets_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_air_tickets_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_air_tickets_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_air_tickets_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_air_tickets_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_air_tickets_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_air_tickets_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_air_tickets_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Авиабилеты'' and direction = ''D'' 
group by client_did, report_date
';

-- 12. Гостиницы
execute immediate
'
create table '||in_table||'_TRANS_TEMP_12 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_hotels_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_hotels_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_hotels_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_hotels_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_hotels_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_hotels_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_hotels_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_hotels_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_hotels_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_hotels_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_hotels_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_hotels_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_hotels_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_hotels_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_hotels_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_hotels_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_hotels_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Гостиницы'' and direction = ''D'' 
group by client_did, report_date
';

-- 13. Услуги курьера
execute immediate
'
create table '||in_table||'_TRANS_TEMP_13 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_courier_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_courier_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_courier_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_courier_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_courier_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_courier_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_courier_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_courier_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_courier_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_courier_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_courier_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_courier_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_courier_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_courier_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_courier_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_courier_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_courier_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Услуги курьера'' and direction = ''D'' 
group by client_did, report_date
';

-- 14. Сувениры
execute immediate
'
create table '||in_table||'_TRANS_TEMP_14 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_souvenirs_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_souvenirs_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_souvenirs_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_souvenirs_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_souvenirs_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_souvenirs_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_souvenirs_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_souvenirs_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_souvenirs_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_souvenirs_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_souvenirs_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_souvenirs_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_souvenirs_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_souvenirs_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_souvenirs_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_souvenirs_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_souvenirs_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Сувениры'' and direction = ''D'' 
group by client_did, report_date
';

-- 15. Перевод на карту
execute immediate
'
create table '||in_table||'_TRANS_TEMP_15 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_card_transfer_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_card_transfer_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_card_transfer_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_card_transfer_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_card_transfer_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_card_transfer_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_card_transfer_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_card_transfer_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_card_transfer_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_card_transfer_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_card_transfer_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_card_transfer_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Перевод на карту'' and direction = ''D'' 
group by client_did, report_date
';

-- 15. Перевод на карту
execute immediate
'
create table '||in_table||'_TRANS_TEMP_45 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_cnt_1m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_c_trans_sum_1m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_card_transfer_c_trans_max_1m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur END) AS transaction_card_transfer_c_trans_min_1m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_cnt_3m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_c_trans_sum_3m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_card_transfer_c_trans_max_3m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur END) AS transaction_card_transfer_c_trans_min_3m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_cnt_6m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_c_trans_sum_6m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_card_transfer_c_trans_max_6m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur END) AS transaction_card_transfer_c_trans_min_6m,
    COUNT(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_cnt_12m,
    SUM(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_card_transfer_c_trans_sum_12m,
    MAX(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_card_transfer_c_trans_max_12m,
    MIN(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur END) AS transaction_card_transfer_c_trans_min_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur ELSE null END) AS transaction_card_transfer_c_trans_avg_sum_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur ELSE null END) AS transaction_card_transfer_c_trans_avg_sum_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur ELSE null END) AS transaction_card_transfer_c_trans_avg_sum_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur ELSE null END) AS transaction_card_transfer_c_trans_avg_sum_12m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_avg_cnt_1m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_avg_cnt_3m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_avg_cnt_6m,
    AVG(CASE WHEN transaction_dtm >= ADD_MONTHS(report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_card_transfer_c_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Перевод на карту'' and direction = ''C'' 
group by client_did, report_date
';


execute immediate
'
create table '||in_table||'_TRANS_TEMP_16 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_fun_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fun_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fun_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_fun_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fun_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fun_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_fun_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fun_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fun_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_fun_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fun_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fun_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_fun_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_fun_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_fun_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_fun_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fun_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Развлечения'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_17 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_taxes_fines_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_taxes_fines_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_taxes_fines_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_taxes_fines_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_taxes_fines_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_taxes_fines_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_taxes_fines_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_taxes_fines_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_taxes_fines_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_taxes_fines_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_taxes_fines_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_taxes_fines_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_taxes_fines_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_taxes_fines_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_taxes_fines_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_taxes_fines_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_taxes_fines_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Налоги и штрафы'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_18 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_supermarkets_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_supermarkets_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_supermarkets_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_supermarkets_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_supermarkets_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_supermarkets_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_supermarkets_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_supermarkets_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_supermarkets_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_supermarkets_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_supermarkets_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_supermarkets_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_supermarkets_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_supermarkets_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_supermarkets_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_supermarkets_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_supermarkets_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Супермаркеты'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_19 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_sport_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_sport_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_sport_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_sport_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_sport_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_sport_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_sport_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_sport_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_sport_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_sport_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_sport_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_sport_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_sport_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_sport_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_sport_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_sport_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_sport_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Спорттовары'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_20 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_sber_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_sber_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_sber_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_sber_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_sber_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_sber_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_sber_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_sber_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_sber_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_sber_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_sber_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_sber_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_sber_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_sber_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_sber_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_sber_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_sber_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Сервисы Сбера'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_21 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_gosuslugi_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_gosuslugi_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_gosuslugi_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_gosuslugi_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_gosuslugi_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_gosuslugi_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_gosuslugi_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_gosuslugi_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_gosuslugi_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_gosuslugi_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_gosuslugi_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_gosuslugi_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_gosuslugi_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_gosuslugi_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_gosuslugi_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_gosuslugi_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_gosuslugi_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Госуслуги'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_22 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_art_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_art_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_art_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_art_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_art_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_art_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_art_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_art_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_art_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_art_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_art_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_art_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_art_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_art_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_art_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_art_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_art_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Искусство'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_23 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_pharmacies_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_pharmacies_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_pharmacies_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_pharmacies_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_pharmacies_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_pharmacies_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_pharmacies_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_pharmacies_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_pharmacies_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_pharmacies_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_pharmacies_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_pharmacies_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_pharmacies_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_pharmacies_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_pharmacies_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_pharmacies_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_pharmacies_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Аптеки'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_24 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_flowers_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_flowers_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_flowers_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_flowers_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_flowers_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_flowers_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_flowers_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_flowers_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_flowers_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_flowers_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_flowers_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_flowers_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_flowers_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_flowers_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_flowers_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_flowers_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_flowers_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Цветы и растения'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_25 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_train_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_train_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_train_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_train_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_train_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_train_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_train_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_train_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_train_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_train_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_train_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_train_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_train_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_train_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_train_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_train_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_train_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Ж/д билеты'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_26 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_gambling_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_gambling_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_gambling_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_gambling_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_gambling_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_gambling_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_gambling_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_gambling_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_gambling_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_gambling_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_gambling_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_gambling_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_gambling_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_gambling_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_gambling_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_gambling_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_gambling_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Азартные игры'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_27 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_digital_goods_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_digital_goods_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_digital_goods_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_digital_goods_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_digital_goods_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_digital_goods_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_digital_goods_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_digital_goods_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_digital_goods_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_digital_goods_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_digital_goods_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_digital_goods_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_digital_goods_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_digital_goods_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_digital_goods_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_digital_goods_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_digital_goods_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Цифровые товары'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_28 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_books_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_books_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_books_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_books_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_books_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_books_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_books_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_books_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_books_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_books_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_books_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_books_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_books_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_books_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_books_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_books_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_books_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Книги'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_29 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_fuel_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm > ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fuel_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fuel_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_fuel_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fuel_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fuel_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_fuel_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fuel_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fuel_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_fuel_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fuel_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fuel_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_fuel_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_fuel_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_fuel_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_fuel_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fuel_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Топливо'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_30 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_yandex_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_yandex_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_yandex_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_yandex_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_yandex_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_yandex_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_yandex_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_yandex_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_yandex_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_yandex_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_yandex_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_yandex_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_yandex_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_yandex_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_yandex_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_yandex_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_yandex_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Сервисы Яндекса'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_31 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_beauty_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_beauty_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_beauty_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_beauty_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_beauty_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_beauty_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_beauty_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_beauty_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_beauty_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_beauty_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_beauty_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_beauty_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_beauty_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_beauty_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_beauty_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_beauty_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_beauty_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Красота'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_32 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_cinema_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cinema_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cinema_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_cinema_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cinema_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cinema_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_cinema_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cinema_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cinema_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_cinema_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cinema_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cinema_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_cinema_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_cinema_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_cinema_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_cinema_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cinema_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Кино'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_33 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_charity_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_charity_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_charity_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_charity_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_charity_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_charity_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_charity_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_charity_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_charity_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_charity_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_charity_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_charity_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_charity_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_charity_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_charity_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_charity_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_charity_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Благотворительность'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_34 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_money_transfers_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_money_transfers_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_money_transfers_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_money_transfers_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_money_transfers_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_money_transfers_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_money_transfers_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_money_transfers_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_money_transfers_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_money_transfers_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_money_transfers_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_money_transfers_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Денежные переводы'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_46 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_c_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_money_transfers_c_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_money_transfers_c_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_c_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_money_transfers_c_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_money_transfers_c_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_c_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_money_transfers_c_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_money_transfers_c_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_money_transfers_c_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_money_transfers_c_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_money_transfers_c_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_money_transfers_c_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_money_transfers_c_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_money_transfers_c_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_money_transfers_c_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_money_transfers_c_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Денежные переводы'' and direction = ''C'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_35 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_auto_services_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_auto_services_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_auto_services_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_auto_services_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_auto_services_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_auto_services_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_auto_services_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_auto_services_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_auto_services_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_auto_services_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_auto_services_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_auto_services_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_auto_services_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_auto_services_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_auto_services_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_auto_services_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_auto_services_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Автоуслуги'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_36 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_consulting_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_consulting_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_consulting_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_consulting_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_consulting_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_consulting_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_consulting_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_consulting_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_consulting_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_consulting_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_consulting_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_consulting_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_consulting_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_consulting_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_consulting_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_consulting_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_consulting_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Услуги и консультации'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_37 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_cash_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cash_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cash_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_cash_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cash_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cash_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_cash_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cash_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cash_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_cash_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cash_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cash_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_cash_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_cash_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_cash_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_cash_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cash_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Снятие наличных'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_47 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_cash_c_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cash_c_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_cash_c_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_cash_c_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cash_c_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_cash_c_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_cash_c_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cash_c_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_cash_c_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_cash_c_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cash_c_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_cash_c_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_cash_c_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_cash_c_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_cash_c_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_cash_c_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_cash_c_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Снятие наличных'' and direction = ''C'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_38 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_other_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_other_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_other_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_other_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_other_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_other_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_other_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_other_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_other_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_other_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_other_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_other_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_other_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_other_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_other_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_other_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_other_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Прочие расходы'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_39 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_utilities_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_utilities_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_utilities_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_utilities_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_utilities_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_utilities_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_utilities_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_utilities_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_utilities_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_utilities_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_utilities_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_utilities_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_utilities_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_utilities_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_utilities_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_utilities_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_utilities_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''ЖКУ, связь'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_40 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_tech_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_tech_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_tech_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_tech_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_tech_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_tech_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_tech_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_tech_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_tech_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_tech_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_tech_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_tech_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_tech_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_tech_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_tech_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_tech_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_tech_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Техника и электроника'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_41 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_jewelry_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_jewelry_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_jewelry_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_jewelry_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_jewelry_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_jewelry_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_jewelry_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_jewelry_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_jewelry_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_jewelry_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_jewelry_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_jewelry_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_jewelry_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_jewelry_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_jewelry_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_jewelry_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_jewelry_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Ювелирные изделия'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_42 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_clothes_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_clothes_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_clothes_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_clothes_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_clothes_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_clothes_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_clothes_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_clothes_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_clothes_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_clothes_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_clothes_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_clothes_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_clothes_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_clothes_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_clothes_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_clothes_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_clothes_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Одежда и обувь'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_43 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_education_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_education_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_education_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_education_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_education_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_education_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_education_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_education_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_education_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_education_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_education_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_education_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_education_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_education_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_education_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_education_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_education_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Образование'' and direction = ''D'' 
group by client_did, report_date
';

execute immediate
'
create table '||in_table||'_TRANS_TEMP_44 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_finance_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_finance_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_finance_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_finance_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_finance_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_finance_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_finance_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_finance_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_finance_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_finance_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_finance_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_finance_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_finance_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_finance_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_finance_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_finance_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_finance_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Финансы'' and direction = ''D'' 
group by client_did, report_date
';


execute immediate
'
create table '||in_table||'_TRANS_TEMP_92 as
select /*+parallel(8)*/ 
    client_did,    
    report_date,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_cnt_1m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE 0 END) AS transaction_fastfood_trans_sum_1m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fastfood_trans_max_1m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur END) AS transaction_fastfood_trans_min_1m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_cnt_3m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE 0 END) AS transaction_fastfood_trans_sum_3m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fastfood_trans_max_3m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur END) AS transaction_fastfood_trans_min_3m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_cnt_6m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE 0 END) AS transaction_fastfood_trans_sum_6m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fastfood_trans_max_6m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur END) AS transaction_fastfood_trans_min_6m,
    COUNT (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_cnt_12m,
    SUM (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE 0 END) AS transaction_fastfood_trans_sum_12m,
    MAX (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fastfood_trans_max_12m,
    MIN (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur END) AS transaction_fastfood_trans_min_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur ELSE null END) AS transaction_fastfood_trans_avg_sum_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur ELSE null END) AS transaction_fastfood_trans_avg_sum_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur ELSE null END) AS transaction_fastfood_trans_avg_sum_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur ELSE null END) AS transaction_fastfood_trans_avg_sum_12m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -1) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_avg_cnt_1m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -3) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_avg_cnt_3m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -6) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_avg_cnt_6m,
    AVG (CASE WHEN transaction_dtm >= ADD_MONTHS (report_date, -12) THEN amount_rur_cnt ELSE null END) AS transaction_fastfood_trans_avg_cnt_12m
from '|| tmp_table_2 ||'
where categ = ''Фастфуд'' and direction = ''D'' 
group by client_did, report_date
';


execute immediate 'create index idx_'||in_table||'_1 on '||in_table||'_TRANS_TEMP_1 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_1 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_2 on '||in_table||'_TRANS_TEMP_2 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_2 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_3 on '||in_table||'_TRANS_TEMP_3 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_3 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_4 on '||in_table||'_TRANS_TEMP_4 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_4 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_5 on '||in_table||'_TRANS_TEMP_5 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_5 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_6 on '||in_table||'_TRANS_TEMP_6 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_6 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_7 on '||in_table||'_TRANS_TEMP_7 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_7 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_8 on '||in_table||'_TRANS_TEMP_8 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_8 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_9 on '||in_table||'_TRANS_TEMP_9 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_9 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_10 on '||in_table||'_TRANS_TEMP_10 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_10 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_11 on '||in_table||'_TRANS_TEMP_11 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_11 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_12 on '||in_table||'_TRANS_TEMP_12 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_12 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_13 on '||in_table||'_TRANS_TEMP_13 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_13 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_14 on '||in_table||'_TRANS_TEMP_14 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_14 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_15 on '||in_table||'_TRANS_TEMP_15 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_15 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_16 on '||in_table||'_TRANS_TEMP_16 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_16 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_17 on '||in_table||'_TRANS_TEMP_17 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_17 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_18 on '||in_table||'_TRANS_TEMP_18 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_18 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_19 on '||in_table||'_TRANS_TEMP_19 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_19 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_20 on '||in_table||'_TRANS_TEMP_20 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_20 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_21 on '||in_table||'_TRANS_TEMP_21 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_21 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_22 on '||in_table||'_TRANS_TEMP_22 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_22 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_23 on '||in_table||'_TRANS_TEMP_23 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_23 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_24 on '||in_table||'_TRANS_TEMP_24 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_24 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_25 on '||in_table||'_TRANS_TEMP_25 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_25 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_26 on '||in_table||'_TRANS_TEMP_26 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_26 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_27 on '||in_table||'_TRANS_TEMP_27 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_27 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_28 on '||in_table||'_TRANS_TEMP_28 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_28 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_29 on '||in_table||'_TRANS_TEMP_29 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_29 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_30 on '||in_table||'_TRANS_TEMP_30 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_30 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_31 on '||in_table||'_TRANS_TEMP_31 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_31 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_32 on '||in_table||'_TRANS_TEMP_32 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_32 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_33 on '||in_table||'_TRANS_TEMP_33 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_33 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_34 on '||in_table||'_TRANS_TEMP_34 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_34 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_35 on '||in_table||'_TRANS_TEMP_35 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_35 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_36 on '||in_table||'_TRANS_TEMP_36 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_36 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_37 on '||in_table||'_TRANS_TEMP_37 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_37 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_38 on '||in_table||'_TRANS_TEMP_38 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_38 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_39 on '||in_table||'_TRANS_TEMP_39 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_39 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_40 on '||in_table||'_TRANS_TEMP_40 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_40 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_41 on '||in_table||'_TRANS_TEMP_41 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_41 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_42 on '||in_table||'_TRANS_TEMP_42 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_42 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_43 on '||in_table||'_TRANS_TEMP_43 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_43 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_44 on '||in_table||'_TRANS_TEMP_44 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_44 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_45 on '||in_table||'_TRANS_TEMP_45 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_45 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_46 on '||in_table||'_TRANS_TEMP_46 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_46 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_47 on '||in_table||'_TRANS_TEMP_47 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_47 NOPARALLEL';

execute immediate 'create index idx_'||in_table||'_92 on '||in_table||'_TRANS_TEMP_92 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_92 NOPARALLEL';

my_str := '
create table '||out_table_1|| ' as
select /* +parallel(16)+ */
	a.client_did,
	a.report_date,
	transaction_dom_rem_trans_cnt_1m,
	transaction_dom_rem_trans_sum_1m,
	transaction_dom_rem_trans_max_1m,
	transaction_dom_rem_trans_min_1m,
	transaction_dom_rem_trans_cnt_3m,
	transaction_dom_rem_trans_sum_3m,
	transaction_dom_rem_trans_max_3m,
	transaction_dom_rem_trans_min_3m,
	transaction_dom_rem_trans_cnt_6m,
	transaction_dom_rem_trans_sum_6m,
	transaction_dom_rem_trans_max_6m,
	transaction_dom_rem_trans_min_6m,
	transaction_dom_rem_trans_cnt_12m,
	transaction_dom_rem_trans_sum_12m,
	transaction_dom_rem_trans_max_12m,
	transaction_dom_rem_trans_min_12m,
	transaction_dom_rem_trans_avg_sum_1m,
	transaction_dom_rem_trans_avg_sum_3m,
	transaction_dom_rem_trans_avg_sum_6m,
	transaction_dom_rem_trans_avg_sum_12m,
	transaction_dom_rem_trans_avg_cnt_1m,
	transaction_dom_rem_trans_avg_cnt_3m,
	transaction_dom_rem_trans_avg_cnt_6m,
	transaction_dom_rem_trans_avg_cnt_12m,
	transaction_cafe_trans_cnt_1m,
	transaction_cafe_trans_sum_1m,
	transaction_cafe_trans_max_1m,
	transaction_cafe_trans_min_1m,
	transaction_cafe_trans_cnt_3m,
	transaction_cafe_trans_sum_3m,
	transaction_cafe_trans_max_3m,
	transaction_cafe_trans_min_3m,
	transaction_cafe_trans_cnt_6m,
	transaction_cafe_trans_sum_6m,
	transaction_cafe_trans_max_6m,
	transaction_cafe_trans_min_6m,
	transaction_cafe_trans_cnt_12m,
	transaction_cafe_trans_sum_12m,
	transaction_cafe_trans_max_12m,
	transaction_cafe_trans_min_12m,
	transaction_cafe_trans_avg_sum_1m,
	transaction_cafe_trans_avg_sum_3m,
	transaction_cafe_trans_avg_sum_6m,
	transaction_cafe_trans_avg_sum_12m,
	transaction_cafe_trans_avg_cnt_1m,
	transaction_cafe_trans_avg_cnt_3m,
	transaction_cafe_trans_avg_cnt_6m,
	transaction_cafe_trans_avg_cnt_12m,
	transaction_rent_auto_trans_cnt_1m,
	transaction_rent_auto_trans_sum_1m,
	transaction_rent_auto_trans_max_1m,
	transaction_rent_auto_trans_min_1m,
	transaction_rent_auto_trans_cnt_3m,
	transaction_rent_auto_trans_sum_3m,
	transaction_rent_auto_trans_max_3m,
	transaction_rent_auto_trans_min_3m,
	transaction_rent_auto_trans_cnt_6m,
	transaction_rent_auto_trans_sum_6m,
	transaction_rent_auto_trans_max_6m,
	transaction_rent_auto_trans_min_6m,
	transaction_rent_auto_trans_cnt_12m,
	transaction_rent_auto_trans_sum_12m,
	transaction_rent_auto_trans_max_12m,
	transaction_rent_auto_trans_min_12m,
	transaction_rent_auto_trans_avg_sum_1m,
	transaction_rent_auto_trans_avg_sum_3m,
	transaction_rent_auto_trans_avg_sum_6m,
	transaction_rent_auto_trans_avg_sum_12m,
	transaction_rent_auto_trans_avg_cnt_1m,
	transaction_rent_auto_trans_avg_cnt_3m,
	transaction_rent_auto_trans_avg_cnt_6m,
	transaction_rent_auto_trans_avg_cnt_12m,
	transaction_transport_trans_cnt_1m,
	transaction_transport_trans_sum_1m,
	transaction_transport_trans_max_1m,
	transaction_transport_trans_min_1m,
	transaction_transport_trans_cnt_3m,
	transaction_transport_trans_sum_3m,
	transaction_transport_trans_max_3m,
	transaction_transport_trans_min_3m,
	transaction_transport_trans_cnt_6m,
	transaction_transport_trans_sum_6m,
	transaction_transport_trans_max_6m,
	transaction_transport_trans_min_6m,
	transaction_transport_trans_cnt_12m,
	transaction_transport_trans_sum_12m,
	transaction_transport_trans_max_12m,
	transaction_transport_trans_min_12m,
	transaction_transport_trans_avg_sum_1m,
	transaction_transport_trans_avg_sum_3m,
	transaction_transport_trans_avg_sum_6m,
	transaction_transport_trans_avg_sum_12m,
	transaction_transport_trans_avg_cnt_1m,
	transaction_transport_trans_avg_cnt_3m,
	transaction_transport_trans_avg_cnt_6m,
	transaction_transport_trans_avg_cnt_12m,
	transaction_travel_trans_cnt_1m,
	transaction_travel_trans_sum_1m,
	transaction_travel_trans_max_1m,
	transaction_travel_trans_min_1m,
	transaction_travel_trans_cnt_3m,
	transaction_travel_trans_sum_3m,
	transaction_travel_trans_max_3m,
	transaction_travel_trans_min_3m,
	transaction_travel_trans_cnt_6m,
	transaction_travel_trans_sum_6m,
	transaction_travel_trans_max_6m,
	transaction_travel_trans_min_6m,
	transaction_travel_trans_cnt_12m,
	transaction_travel_trans_sum_12m,
	transaction_travel_trans_max_12m,
	transaction_travel_trans_min_12m,
	transaction_travel_trans_avg_sum_1m,
	transaction_travel_trans_avg_sum_3m,
	transaction_travel_trans_avg_sum_6m,
	transaction_travel_trans_avg_sum_12m,
	transaction_travel_trans_avg_cnt_1m,
	transaction_travel_trans_avg_cnt_3m,
	transaction_travel_trans_avg_cnt_6m,
	transaction_travel_trans_avg_cnt_12m,
	transaction_medicine_trans_cnt_1m,
	transaction_medicine_trans_sum_1m,
	transaction_medicine_trans_max_1m,
	transaction_medicine_trans_min_1m,
	transaction_medicine_trans_cnt_3m,
	transaction_medicine_trans_sum_3m,
	transaction_medicine_trans_max_3m,
	transaction_medicine_trans_min_3m,
	transaction_medicine_trans_cnt_6m,
	transaction_medicine_trans_sum_6m,
	transaction_medicine_trans_max_6m,
	transaction_medicine_trans_min_6m,
	transaction_medicine_trans_cnt_12m,
	transaction_medicine_trans_sum_12m,
	transaction_medicine_trans_max_12m,
	transaction_medicine_trans_min_12m,
	transaction_medicine_trans_avg_sum_1m,
	transaction_medicine_trans_avg_sum_3m,
	transaction_medicine_trans_avg_sum_6m,
	transaction_medicine_trans_avg_sum_12m,
	transaction_medicine_trans_avg_cnt_1m,
	transaction_medicine_trans_avg_cnt_3m,
	transaction_medicine_trans_avg_cnt_6m,
	transaction_medicine_trans_avg_cnt_12m,
	transaction_online_shops_trans_cnt_1m,
	transaction_online_shops_trans_sum_1m,
	transaction_online_shops_trans_max_1m,
	transaction_online_shops_trans_min_1m,
	transaction_online_shops_trans_cnt_3m,
	transaction_online_shops_trans_sum_3m,
	transaction_online_shops_trans_max_3m,
	transaction_online_shops_trans_min_3m,
	transaction_online_shops_trans_cnt_6m,
	transaction_online_shops_trans_sum_6m,
	transaction_online_shops_trans_max_6m,
	transaction_online_shops_trans_min_6m,
	transaction_online_shops_trans_cnt_12m,
	transaction_online_shops_trans_sum_12m,
	transaction_online_shops_trans_max_12m,
	transaction_online_shops_trans_min_12m,
	transaction_online_shops_trans_avg_sum_1m,
	transaction_online_shops_trans_avg_sum_3m,
	transaction_online_shops_trans_avg_sum_6m,
	transaction_online_shops_trans_avg_sum_12m,
	transaction_online_shops_trans_avg_cnt_1m,
	transaction_online_shops_trans_avg_cnt_3m,
	transaction_online_shops_trans_avg_cnt_6m,
	transaction_online_shops_trans_avg_cnt_12m,
	transaction_music_trans_cnt_1m,
	transaction_music_trans_sum_1m,
	transaction_music_trans_max_1m,
	transaction_music_trans_min_1m,
	transaction_music_trans_cnt_3m,
	transaction_music_trans_sum_3m,
	transaction_music_trans_max_3m,
	transaction_music_trans_min_3m,
	transaction_music_trans_cnt_6m,
	transaction_music_trans_sum_6m,
	transaction_music_trans_max_6m,
	transaction_music_trans_min_6m,
	transaction_music_trans_cnt_12m,
	transaction_music_trans_sum_12m,
	transaction_music_trans_max_12m,
	transaction_music_trans_min_12m,
	transaction_music_trans_avg_sum_1m,
	transaction_music_trans_avg_sum_3m,
	transaction_music_trans_avg_sum_6m,
	transaction_music_trans_avg_sum_12m,
	transaction_music_trans_avg_cnt_1m,
	transaction_music_trans_avg_cnt_3m,
	transaction_music_trans_avg_cnt_6m,
	transaction_music_trans_avg_cnt_12m,
	transaction_lombards_trans_cnt_1m,
	transaction_lombards_trans_sum_1m,
	transaction_lombards_trans_max_1m,
	transaction_lombards_trans_min_1m,
	transaction_lombards_trans_cnt_3m,
	transaction_lombards_trans_sum_3m,
	transaction_lombards_trans_max_3m,
	transaction_lombards_trans_min_3m,
	transaction_lombards_trans_cnt_6m,
	transaction_lombards_trans_sum_6m,
	transaction_lombards_trans_max_6m,
	transaction_lombards_trans_min_6m,
	transaction_lombards_trans_cnt_12m,
	transaction_lombards_trans_sum_12m,
	transaction_lombards_trans_max_12m,
	transaction_lombards_trans_min_12m,
	transaction_lombards_trans_avg_sum_1m,
	transaction_lombards_trans_avg_sum_3m,
	transaction_lombards_trans_avg_sum_6m,
	transaction_lombards_trans_avg_sum_12m,
	transaction_lombards_trans_avg_cnt_1m,
	transaction_lombards_trans_avg_cnt_3m,
	transaction_lombards_trans_avg_cnt_6m,
	transaction_lombards_trans_avg_cnt_12m,
	transaction_zoo_trans_cnt_1m,
	transaction_zoo_trans_sum_1m,
	transaction_zoo_trans_max_1m,
	transaction_zoo_trans_min_1m,
	transaction_zoo_trans_cnt_3m,
	transaction_zoo_trans_sum_3m,
	transaction_zoo_trans_max_3m,
	transaction_zoo_trans_min_3m,
	transaction_zoo_trans_cnt_6m,
	transaction_zoo_trans_sum_6m,
	transaction_zoo_trans_max_6m,
	transaction_zoo_trans_min_6m,
	transaction_zoo_trans_cnt_12m,
	transaction_zoo_trans_sum_12m,
	transaction_zoo_trans_max_12m,
	transaction_zoo_trans_min_12m,
	transaction_zoo_trans_avg_sum_1m,
	transaction_zoo_trans_avg_sum_3m,
	transaction_zoo_trans_avg_sum_6m,
	transaction_zoo_trans_avg_sum_12m,
	transaction_zoo_trans_avg_cnt_1m,
	transaction_zoo_trans_avg_cnt_3m,
	transaction_zoo_trans_avg_cnt_6m,
	transaction_zoo_trans_avg_cnt_12m,
	transaction_air_tickets_trans_cnt_1m,
	transaction_air_tickets_trans_sum_1m,
	transaction_air_tickets_trans_max_1m,
	transaction_air_tickets_trans_min_1m,
	transaction_air_tickets_trans_cnt_3m,
	transaction_air_tickets_trans_sum_3m,
	transaction_air_tickets_trans_max_3m,
	transaction_air_tickets_trans_min_3m,
	transaction_air_tickets_trans_cnt_6m,
	transaction_air_tickets_trans_sum_6m,
	transaction_air_tickets_trans_max_6m,
	transaction_air_tickets_trans_min_6m,
	transaction_air_tickets_trans_cnt_12m,
	transaction_air_tickets_trans_sum_12m,
	transaction_air_tickets_trans_max_12m,
	transaction_air_tickets_trans_min_12m,
	transaction_air_tickets_trans_avg_sum_1m,
	transaction_air_tickets_trans_avg_sum_3m,
	transaction_air_tickets_trans_avg_sum_6m,
	transaction_air_tickets_trans_avg_sum_12m,
	transaction_air_tickets_trans_avg_cnt_1m,
	transaction_air_tickets_trans_avg_cnt_3m,
	transaction_air_tickets_trans_avg_cnt_6m,
	transaction_air_tickets_trans_avg_cnt_12m,
	transaction_hotels_trans_cnt_1m,
	transaction_hotels_trans_sum_1m,
	transaction_hotels_trans_max_1m,
	transaction_hotels_trans_min_1m,
	transaction_hotels_trans_cnt_3m,
	transaction_hotels_trans_sum_3m,
	transaction_hotels_trans_max_3m,
	transaction_hotels_trans_min_3m,
	transaction_hotels_trans_cnt_6m,
	transaction_hotels_trans_sum_6m,
	transaction_hotels_trans_max_6m,
	transaction_hotels_trans_min_6m,
	transaction_hotels_trans_cnt_12m,
	transaction_hotels_trans_sum_12m,
	transaction_hotels_trans_max_12m,
	transaction_hotels_trans_min_12m,
	transaction_hotels_trans_avg_sum_1m,
	transaction_hotels_trans_avg_sum_3m,
	transaction_hotels_trans_avg_sum_6m,
	transaction_hotels_trans_avg_sum_12m,
	transaction_hotels_trans_avg_cnt_1m,
	transaction_hotels_trans_avg_cnt_3m,
	transaction_hotels_trans_avg_cnt_6m,
	transaction_hotels_trans_avg_cnt_12m,
	transaction_courier_trans_cnt_1m,
	transaction_courier_trans_sum_1m,
	transaction_courier_trans_max_1m,
	transaction_courier_trans_min_1m,
	transaction_courier_trans_cnt_3m,
	transaction_courier_trans_sum_3m,
	transaction_courier_trans_max_3m,
	transaction_courier_trans_min_3m,
	transaction_courier_trans_cnt_6m,
	transaction_courier_trans_sum_6m,
	transaction_courier_trans_max_6m,
	transaction_courier_trans_min_6m,
	transaction_courier_trans_cnt_12m,
	transaction_courier_trans_sum_12m,
	transaction_courier_trans_max_12m,
	transaction_courier_trans_min_12m,
	transaction_courier_trans_avg_sum_1m,
	transaction_courier_trans_avg_sum_3m,
	transaction_courier_trans_avg_sum_6m,
	transaction_courier_trans_avg_sum_12m,
	transaction_courier_trans_avg_cnt_1m,
	transaction_courier_trans_avg_cnt_3m,
	transaction_courier_trans_avg_cnt_6m,
	transaction_courier_trans_avg_cnt_12m,
	transaction_souvenirs_trans_cnt_1m,
	transaction_souvenirs_trans_sum_1m,
	transaction_souvenirs_trans_max_1m,
	transaction_souvenirs_trans_min_1m,
	transaction_souvenirs_trans_cnt_3m,
	transaction_souvenirs_trans_sum_3m,
	transaction_souvenirs_trans_max_3m,
	transaction_souvenirs_trans_min_3m,
	transaction_souvenirs_trans_cnt_6m,
	transaction_souvenirs_trans_sum_6m,
	transaction_souvenirs_trans_max_6m,
	transaction_souvenirs_trans_min_6m,
	transaction_souvenirs_trans_cnt_12m,
	transaction_souvenirs_trans_sum_12m,
	transaction_souvenirs_trans_max_12m,
	transaction_souvenirs_trans_min_12m,
	transaction_souvenirs_trans_avg_sum_1m,
	transaction_souvenirs_trans_avg_sum_3m,
	transaction_souvenirs_trans_avg_sum_6m,
	transaction_souvenirs_trans_avg_sum_12m,
	transaction_souvenirs_trans_avg_cnt_1m,
	transaction_souvenirs_trans_avg_cnt_3m,
	transaction_souvenirs_trans_avg_cnt_6m,
	transaction_souvenirs_trans_avg_cnt_12m,
	transaction_fun_trans_cnt_1m,
	transaction_fun_trans_sum_1m,
	transaction_fun_trans_max_1m,
	transaction_fun_trans_min_1m,
	transaction_fun_trans_cnt_3m,
	transaction_fun_trans_sum_3m,
	transaction_fun_trans_max_3m,
	transaction_fun_trans_min_3m,
	transaction_fun_trans_cnt_6m,
	transaction_fun_trans_sum_6m,
	transaction_fun_trans_max_6m,
	transaction_fun_trans_min_6m,
	transaction_fun_trans_cnt_12m,
	transaction_fun_trans_sum_12m,
	transaction_fun_trans_max_12m,
	transaction_fun_trans_min_12m,
	transaction_fun_trans_avg_sum_1m,
	transaction_fun_trans_avg_sum_3m,
	transaction_fun_trans_avg_sum_6m,
	transaction_fun_trans_avg_sum_12m,
	transaction_fun_trans_avg_cnt_1m,
	transaction_fun_trans_avg_cnt_3m,
	transaction_fun_trans_avg_cnt_6m,
	transaction_fun_trans_avg_cnt_12m,
	transaction_taxes_fines_trans_cnt_1m,
	transaction_taxes_fines_trans_sum_1m,
	transaction_taxes_fines_trans_max_1m,
	transaction_taxes_fines_trans_min_1m,
	transaction_taxes_fines_trans_cnt_3m,
	transaction_taxes_fines_trans_sum_3m,
	transaction_taxes_fines_trans_max_3m,
	transaction_taxes_fines_trans_min_3m,
	transaction_taxes_fines_trans_cnt_6m,
	transaction_taxes_fines_trans_sum_6m,
	transaction_taxes_fines_trans_max_6m,
	transaction_taxes_fines_trans_min_6m,
	transaction_taxes_fines_trans_cnt_12m,
	transaction_taxes_fines_trans_sum_12m,
	transaction_taxes_fines_trans_max_12m,
	transaction_taxes_fines_trans_min_12m,
	transaction_taxes_fines_trans_avg_sum_1m,
	transaction_taxes_fines_trans_avg_sum_3m,
	transaction_taxes_fines_trans_avg_sum_6m,
	transaction_taxes_fines_trans_avg_sum_12m,
	transaction_taxes_fines_trans_avg_cnt_1m,
	transaction_taxes_fines_trans_avg_cnt_3m,
	transaction_taxes_fines_trans_avg_cnt_6m,
	transaction_taxes_fines_trans_avg_cnt_12m,
	transaction_supermarkets_trans_cnt_1m,
	transaction_supermarkets_trans_sum_1m,
	transaction_supermarkets_trans_max_1m,
	transaction_supermarkets_trans_min_1m,
	transaction_supermarkets_trans_cnt_3m,
	transaction_supermarkets_trans_sum_3m,
	transaction_supermarkets_trans_max_3m,
	transaction_supermarkets_trans_min_3m,
	transaction_supermarkets_trans_cnt_6m,
	transaction_supermarkets_trans_sum_6m,
	transaction_supermarkets_trans_max_6m,
	transaction_supermarkets_trans_min_6m,
	transaction_supermarkets_trans_cnt_12m,
	transaction_supermarkets_trans_sum_12m,
	transaction_supermarkets_trans_max_12m,
	transaction_supermarkets_trans_min_12m,
	transaction_supermarkets_trans_avg_sum_1m,
	transaction_supermarkets_trans_avg_sum_3m,
	transaction_supermarkets_trans_avg_sum_6m,
	transaction_supermarkets_trans_avg_sum_12m,
	transaction_supermarkets_trans_avg_cnt_1m,
	transaction_supermarkets_trans_avg_cnt_3m,
	transaction_supermarkets_trans_avg_cnt_6m,
	transaction_supermarkets_trans_avg_cnt_12m,
	transaction_sport_trans_cnt_1m,
	transaction_sport_trans_sum_1m,
	transaction_sport_trans_max_1m,
	transaction_sport_trans_min_1m,
	transaction_sport_trans_cnt_3m,
	transaction_sport_trans_sum_3m,
	transaction_sport_trans_max_3m,
	transaction_sport_trans_min_3m,
	transaction_sport_trans_cnt_6m,
	transaction_sport_trans_sum_6m,
	transaction_sport_trans_max_6m,
	transaction_sport_trans_min_6m,
	transaction_sport_trans_cnt_12m,
	transaction_sport_trans_sum_12m,
	transaction_sport_trans_max_12m,
	transaction_sport_trans_min_12m,
	transaction_sport_trans_avg_sum_1m,
	transaction_sport_trans_avg_sum_3m,
	transaction_sport_trans_avg_sum_6m,
	transaction_sport_trans_avg_sum_12m,
	transaction_sport_trans_avg_cnt_1m,
	transaction_sport_trans_avg_cnt_3m,
	transaction_sport_trans_avg_cnt_6m,
	transaction_sport_trans_avg_cnt_12m,
	transaction_sber_trans_cnt_1m,
	transaction_sber_trans_sum_1m,
	transaction_sber_trans_max_1m,
	transaction_sber_trans_min_1m,
	transaction_sber_trans_cnt_3m,
	transaction_sber_trans_sum_3m,
	transaction_sber_trans_max_3m,
	transaction_sber_trans_min_3m,
	transaction_sber_trans_cnt_6m,
	transaction_sber_trans_sum_6m,
	transaction_sber_trans_max_6m,
	transaction_sber_trans_min_6m,
	transaction_sber_trans_cnt_12m,
	transaction_sber_trans_sum_12m,
	transaction_sber_trans_max_12m,
	transaction_sber_trans_min_12m,
	transaction_sber_trans_avg_sum_1m,
	transaction_sber_trans_avg_sum_3m,
	transaction_sber_trans_avg_sum_6m,
	transaction_sber_trans_avg_sum_12m,
	transaction_sber_trans_avg_cnt_1m,
	transaction_sber_trans_avg_cnt_3m,
	transaction_sber_trans_avg_cnt_6m,
	transaction_sber_trans_avg_cnt_12m,
';
add_str := '
	transaction_gosuslugi_trans_cnt_1m,
	transaction_gosuslugi_trans_sum_1m,
	transaction_gosuslugi_trans_max_1m,
	transaction_gosuslugi_trans_min_1m,
	transaction_gosuslugi_trans_cnt_3m,
	transaction_gosuslugi_trans_sum_3m,
	transaction_gosuslugi_trans_max_3m,
	transaction_gosuslugi_trans_min_3m,
	transaction_gosuslugi_trans_cnt_6m,
	transaction_gosuslugi_trans_sum_6m,
	transaction_gosuslugi_trans_max_6m,
	transaction_gosuslugi_trans_min_6m,
	transaction_gosuslugi_trans_cnt_12m,
	transaction_gosuslugi_trans_sum_12m,
	transaction_gosuslugi_trans_max_12m,
	transaction_gosuslugi_trans_min_12m,
	transaction_gosuslugi_trans_avg_sum_1m,
	transaction_gosuslugi_trans_avg_sum_3m,
	transaction_gosuslugi_trans_avg_sum_6m,
	transaction_gosuslugi_trans_avg_sum_12m,
	transaction_gosuslugi_trans_avg_cnt_1m,
	transaction_gosuslugi_trans_avg_cnt_3m,
	transaction_gosuslugi_trans_avg_cnt_6m,
	transaction_gosuslugi_trans_avg_cnt_12m,
	transaction_art_trans_cnt_1m,
	transaction_art_trans_sum_1m,
	transaction_art_trans_max_1m,
	transaction_art_trans_min_1m,
	transaction_art_trans_cnt_3m,
	transaction_art_trans_sum_3m,
	transaction_art_trans_max_3m,
	transaction_art_trans_min_3m,
	transaction_art_trans_cnt_6m,
	transaction_art_trans_sum_6m,
	transaction_art_trans_max_6m,
	transaction_art_trans_min_6m,
	transaction_art_trans_cnt_12m,
	transaction_art_trans_sum_12m,
	transaction_art_trans_max_12m,
	transaction_art_trans_min_12m,
	transaction_art_trans_avg_sum_1m,
	transaction_art_trans_avg_sum_3m,
	transaction_art_trans_avg_sum_6m,
	transaction_art_trans_avg_sum_12m,
	transaction_art_trans_avg_cnt_1m,
	transaction_art_trans_avg_cnt_3m,
	transaction_art_trans_avg_cnt_6m,
	transaction_art_trans_avg_cnt_12m,
	transaction_pharmacies_trans_cnt_1m,
	transaction_pharmacies_trans_sum_1m,
	transaction_pharmacies_trans_max_1m,
	transaction_pharmacies_trans_min_1m,
	transaction_pharmacies_trans_cnt_3m,
	transaction_pharmacies_trans_sum_3m,
	transaction_pharmacies_trans_max_3m,
	transaction_pharmacies_trans_min_3m,
	transaction_pharmacies_trans_cnt_6m,
	transaction_pharmacies_trans_sum_6m,
	transaction_pharmacies_trans_max_6m,
	transaction_pharmacies_trans_min_6m,
	transaction_pharmacies_trans_cnt_12m,
	transaction_pharmacies_trans_sum_12m,
	transaction_pharmacies_trans_max_12m,
	transaction_pharmacies_trans_min_12m,
	transaction_pharmacies_trans_avg_sum_1m,
	transaction_pharmacies_trans_avg_sum_3m,
	transaction_pharmacies_trans_avg_sum_6m,
	transaction_pharmacies_trans_avg_sum_12m,
	transaction_pharmacies_trans_avg_cnt_1m,
	transaction_pharmacies_trans_avg_cnt_3m,
	transaction_pharmacies_trans_avg_cnt_6m,
	transaction_pharmacies_trans_avg_cnt_12m,
	transaction_flowers_trans_cnt_1m,
	transaction_flowers_trans_sum_1m,
	transaction_flowers_trans_max_1m,
	transaction_flowers_trans_min_1m,
	transaction_flowers_trans_cnt_3m,
	transaction_flowers_trans_sum_3m,
	transaction_flowers_trans_max_3m,
	transaction_flowers_trans_min_3m,
	transaction_flowers_trans_cnt_6m,
	transaction_flowers_trans_sum_6m,
	transaction_flowers_trans_max_6m,
	transaction_flowers_trans_min_6m,
	transaction_flowers_trans_cnt_12m,
	transaction_flowers_trans_sum_12m,
	transaction_flowers_trans_max_12m,
	transaction_flowers_trans_min_12m,
	transaction_flowers_trans_avg_sum_1m,
	transaction_flowers_trans_avg_sum_3m,
	transaction_flowers_trans_avg_sum_6m,
	transaction_flowers_trans_avg_sum_12m,
	transaction_flowers_trans_avg_cnt_1m,
	transaction_flowers_trans_avg_cnt_3m,
	transaction_flowers_trans_avg_cnt_6m,
	transaction_flowers_trans_avg_cnt_12m,
	transaction_train_trans_cnt_1m,
	transaction_train_trans_sum_1m,
	transaction_train_trans_max_1m,
	transaction_train_trans_min_1m,
	transaction_train_trans_cnt_3m,
	transaction_train_trans_sum_3m,
	transaction_train_trans_max_3m,
	transaction_train_trans_min_3m,
	transaction_train_trans_cnt_6m,
	transaction_train_trans_sum_6m,
	transaction_train_trans_max_6m,
	transaction_train_trans_min_6m,
	transaction_train_trans_cnt_12m,
	transaction_train_trans_sum_12m,
	transaction_train_trans_max_12m,
	transaction_train_trans_min_12m,
	transaction_train_trans_avg_sum_1m,
	transaction_train_trans_avg_sum_3m,
	transaction_train_trans_avg_sum_6m,
	transaction_train_trans_avg_sum_12m,
	transaction_train_trans_avg_cnt_1m,
	transaction_train_trans_avg_cnt_3m,
	transaction_train_trans_avg_cnt_6m,
	transaction_train_trans_avg_cnt_12m,
	transaction_gambling_trans_cnt_1m,
	transaction_gambling_trans_sum_1m,
	transaction_gambling_trans_max_1m,
	transaction_gambling_trans_min_1m,
	transaction_gambling_trans_cnt_3m,
	transaction_gambling_trans_sum_3m,
	transaction_gambling_trans_max_3m,
	transaction_gambling_trans_min_3m,
	transaction_gambling_trans_cnt_6m,
	transaction_gambling_trans_sum_6m,
	transaction_gambling_trans_max_6m,
	transaction_gambling_trans_min_6m,
	transaction_gambling_trans_cnt_12m,
	transaction_gambling_trans_sum_12m,
	transaction_gambling_trans_max_12m,
	transaction_gambling_trans_min_12m,
	transaction_gambling_trans_avg_sum_1m,
	transaction_gambling_trans_avg_sum_3m,
	transaction_gambling_trans_avg_sum_6m,
	transaction_gambling_trans_avg_sum_12m,
	transaction_gambling_trans_avg_cnt_1m,
	transaction_gambling_trans_avg_cnt_3m,
	transaction_gambling_trans_avg_cnt_6m,
	transaction_gambling_trans_avg_cnt_12m,
	transaction_digital_goods_trans_cnt_1m,
	transaction_digital_goods_trans_sum_1m,
	transaction_digital_goods_trans_max_1m,
	transaction_digital_goods_trans_min_1m,
	transaction_digital_goods_trans_cnt_3m,
	transaction_digital_goods_trans_sum_3m,
	transaction_digital_goods_trans_max_3m,
	transaction_digital_goods_trans_min_3m,
	transaction_digital_goods_trans_cnt_6m,
	transaction_digital_goods_trans_sum_6m,
	transaction_digital_goods_trans_max_6m,
	transaction_digital_goods_trans_min_6m,
	transaction_digital_goods_trans_cnt_12m,
	transaction_digital_goods_trans_sum_12m,
	transaction_digital_goods_trans_max_12m,
	transaction_digital_goods_trans_min_12m,
	transaction_digital_goods_trans_avg_sum_1m,
	transaction_digital_goods_trans_avg_sum_3m,
	transaction_digital_goods_trans_avg_sum_6m,
	transaction_digital_goods_trans_avg_sum_12m,
	transaction_digital_goods_trans_avg_cnt_1m,
	transaction_digital_goods_trans_avg_cnt_3m,
	transaction_digital_goods_trans_avg_cnt_6m,
	transaction_digital_goods_trans_avg_cnt_12m,
	transaction_books_trans_cnt_1m,
	transaction_books_trans_sum_1m,
	transaction_books_trans_max_1m,
	transaction_books_trans_min_1m,
	transaction_books_trans_cnt_3m,
	transaction_books_trans_sum_3m,
	transaction_books_trans_max_3m,
	transaction_books_trans_min_3m,
	transaction_books_trans_cnt_6m,
	transaction_books_trans_sum_6m,
	transaction_books_trans_max_6m,
	transaction_books_trans_min_6m,
	transaction_books_trans_cnt_12m,
	transaction_books_trans_sum_12m,
	transaction_books_trans_max_12m,
	transaction_books_trans_min_12m,
	transaction_books_trans_avg_sum_1m,
	transaction_books_trans_avg_sum_3m,
	transaction_books_trans_avg_sum_6m,
	transaction_books_trans_avg_sum_12m,
	transaction_books_trans_avg_cnt_1m,
	transaction_books_trans_avg_cnt_3m,
	transaction_books_trans_avg_cnt_6m,
	transaction_books_trans_avg_cnt_12m,
	transaction_fuel_trans_cnt_1m,
	transaction_fuel_trans_sum_1m,
	transaction_fuel_trans_max_1m,
	transaction_fuel_trans_min_1m,
	transaction_fuel_trans_cnt_3m,
	transaction_fuel_trans_sum_3m,
	transaction_fuel_trans_max_3m,
	transaction_fuel_trans_min_3m,
	transaction_fuel_trans_cnt_6m,
	transaction_fuel_trans_sum_6m,
	transaction_fuel_trans_max_6m,
	transaction_fuel_trans_min_6m,
	transaction_fuel_trans_cnt_12m,
	transaction_fuel_trans_sum_12m,
	transaction_fuel_trans_max_12m,
	transaction_fuel_trans_min_12m,
	transaction_fuel_trans_avg_sum_1m,
	transaction_fuel_trans_avg_sum_3m,
	transaction_fuel_trans_avg_sum_6m,
	transaction_fuel_trans_avg_sum_12m,
	transaction_fuel_trans_avg_cnt_1m,
	transaction_fuel_trans_avg_cnt_3m,
	transaction_fuel_trans_avg_cnt_6m,
	transaction_fuel_trans_avg_cnt_12m,
	transaction_yandex_trans_cnt_1m,
	transaction_yandex_trans_sum_1m,
	transaction_yandex_trans_max_1m,
	transaction_yandex_trans_min_1m,
	transaction_yandex_trans_cnt_3m,
	transaction_yandex_trans_sum_3m,
	transaction_yandex_trans_max_3m,
	transaction_yandex_trans_min_3m,
	transaction_yandex_trans_cnt_6m,
	transaction_yandex_trans_sum_6m,
	transaction_yandex_trans_max_6m,
	transaction_yandex_trans_min_6m,
	transaction_yandex_trans_cnt_12m,
	transaction_yandex_trans_sum_12m,
	transaction_yandex_trans_max_12m,
	transaction_yandex_trans_min_12m,
	transaction_yandex_trans_avg_sum_1m,
	transaction_yandex_trans_avg_sum_3m,
	transaction_yandex_trans_avg_sum_6m,
	transaction_yandex_trans_avg_sum_12m,
	transaction_yandex_trans_avg_cnt_1m,
	transaction_yandex_trans_avg_cnt_3m,
	transaction_yandex_trans_avg_cnt_6m,
	transaction_yandex_trans_avg_cnt_12m,
	transaction_beauty_trans_cnt_1m,
	transaction_beauty_trans_sum_1m,
	transaction_beauty_trans_max_1m,
	transaction_beauty_trans_min_1m,
	transaction_beauty_trans_cnt_3m,
	transaction_beauty_trans_sum_3m,
	transaction_beauty_trans_max_3m,
	transaction_beauty_trans_min_3m,
	transaction_beauty_trans_cnt_6m,
	transaction_beauty_trans_sum_6m,
	transaction_beauty_trans_max_6m,
	transaction_beauty_trans_min_6m,
	transaction_beauty_trans_cnt_12m,
	transaction_beauty_trans_sum_12m,
	transaction_beauty_trans_max_12m,
	transaction_beauty_trans_min_12m,
	transaction_beauty_trans_avg_sum_1m,
	transaction_beauty_trans_avg_sum_3m,
	transaction_beauty_trans_avg_sum_6m,
	transaction_beauty_trans_avg_sum_12m,
	transaction_beauty_trans_avg_cnt_1m,
	transaction_beauty_trans_avg_cnt_3m,
	transaction_beauty_trans_avg_cnt_6m,
	transaction_beauty_trans_avg_cnt_12m,
	transaction_cinema_trans_cnt_1m,
	transaction_cinema_trans_sum_1m,
	transaction_cinema_trans_max_1m,
	transaction_cinema_trans_min_1m,
	transaction_cinema_trans_cnt_3m,
	transaction_cinema_trans_sum_3m,
	transaction_cinema_trans_max_3m,
	transaction_cinema_trans_min_3m,
	transaction_cinema_trans_cnt_6m,
	transaction_cinema_trans_sum_6m,
	transaction_cinema_trans_max_6m,
	transaction_cinema_trans_min_6m,
	transaction_cinema_trans_cnt_12m,
	transaction_cinema_trans_sum_12m,
	transaction_cinema_trans_max_12m,
	transaction_cinema_trans_min_12m,
	transaction_cinema_trans_avg_sum_1m,
	transaction_cinema_trans_avg_sum_3m,
	transaction_cinema_trans_avg_sum_6m,
	transaction_cinema_trans_avg_sum_12m,
	transaction_cinema_trans_avg_cnt_1m,
	transaction_cinema_trans_avg_cnt_3m,
	transaction_cinema_trans_avg_cnt_6m,
	transaction_cinema_trans_avg_cnt_12m,
	transaction_charity_trans_cnt_1m,
	transaction_charity_trans_sum_1m,
	transaction_charity_trans_max_1m,
	transaction_charity_trans_min_1m,
	transaction_charity_trans_cnt_3m,
	transaction_charity_trans_sum_3m,
	transaction_charity_trans_max_3m,
	transaction_charity_trans_min_3m,
	transaction_charity_trans_cnt_6m,
	transaction_charity_trans_sum_6m,
	transaction_charity_trans_max_6m,
	transaction_charity_trans_min_6m,
	transaction_charity_trans_cnt_12m,
	transaction_charity_trans_sum_12m,
	transaction_charity_trans_max_12m,
	transaction_charity_trans_min_12m,
	transaction_charity_trans_avg_sum_1m,
	transaction_charity_trans_avg_sum_3m,
	transaction_charity_trans_avg_sum_6m,
	transaction_charity_trans_avg_sum_12m,
	transaction_charity_trans_avg_cnt_1m,
	transaction_charity_trans_avg_cnt_3m,
	transaction_charity_trans_avg_cnt_6m,
	transaction_charity_trans_avg_cnt_12m,
	transaction_auto_services_trans_cnt_1m,
	transaction_auto_services_trans_sum_1m,
	transaction_auto_services_trans_max_1m,
	transaction_auto_services_trans_min_1m,
	transaction_auto_services_trans_cnt_3m,
	transaction_auto_services_trans_sum_3m,
	transaction_auto_services_trans_max_3m,
	transaction_auto_services_trans_min_3m,
	transaction_auto_services_trans_cnt_6m,
	transaction_auto_services_trans_sum_6m,
	transaction_auto_services_trans_max_6m,
	transaction_auto_services_trans_min_6m,
	transaction_auto_services_trans_cnt_12m,
	transaction_auto_services_trans_sum_12m,
	transaction_auto_services_trans_max_12m,
	transaction_auto_services_trans_min_12m,
	transaction_auto_services_trans_avg_sum_1m,
	transaction_auto_services_trans_avg_sum_3m,
	transaction_auto_services_trans_avg_sum_6m,
	transaction_auto_services_trans_avg_sum_12m,
	transaction_auto_services_trans_avg_cnt_1m,
	transaction_auto_services_trans_avg_cnt_3m,
	transaction_auto_services_trans_avg_cnt_6m,
	transaction_auto_services_trans_avg_cnt_12m,
	transaction_consulting_trans_cnt_1m,
	transaction_consulting_trans_sum_1m,
	transaction_consulting_trans_max_1m,
	transaction_consulting_trans_min_1m,
	transaction_consulting_trans_cnt_3m,
	transaction_consulting_trans_sum_3m,
	transaction_consulting_trans_max_3m,
	transaction_consulting_trans_min_3m,
	transaction_consulting_trans_cnt_6m,
	transaction_consulting_trans_sum_6m,
	transaction_consulting_trans_max_6m,
	transaction_consulting_trans_min_6m,
	transaction_consulting_trans_cnt_12m,
	transaction_consulting_trans_sum_12m,
	transaction_consulting_trans_max_12m,
	transaction_consulting_trans_min_12m,
	transaction_consulting_trans_avg_sum_1m,
	transaction_consulting_trans_avg_sum_3m,
	transaction_consulting_trans_avg_sum_6m,
	transaction_consulting_trans_avg_sum_12m,
	transaction_consulting_trans_avg_cnt_1m,
	transaction_consulting_trans_avg_cnt_3m,
	transaction_consulting_trans_avg_cnt_6m,
	transaction_consulting_trans_avg_cnt_12m,
	transaction_other_trans_cnt_1m,
	transaction_other_trans_sum_1m,
	transaction_other_trans_max_1m,
	transaction_other_trans_min_1m,
	transaction_other_trans_cnt_3m,
	transaction_other_trans_sum_3m,
	transaction_other_trans_max_3m,
	transaction_other_trans_min_3m,
	transaction_other_trans_cnt_6m,
	transaction_other_trans_sum_6m,
	transaction_other_trans_max_6m,
	transaction_other_trans_min_6m,
	transaction_other_trans_cnt_12m,
	transaction_other_trans_sum_12m,
	transaction_other_trans_max_12m,
	transaction_other_trans_min_12m,
	transaction_other_trans_avg_sum_1m,
	transaction_other_trans_avg_sum_3m,
	transaction_other_trans_avg_sum_6m,
	transaction_other_trans_avg_sum_12m,
	transaction_other_trans_avg_cnt_1m,
	transaction_other_trans_avg_cnt_3m,
	transaction_other_trans_avg_cnt_6m,
	transaction_other_trans_avg_cnt_12m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_utilities_trans_cnt_1m,
	transaction_utilities_trans_sum_1m,
	transaction_utilities_trans_max_1m,
	transaction_utilities_trans_min_1m,
	transaction_utilities_trans_cnt_3m,
	transaction_utilities_trans_sum_3m,
	transaction_utilities_trans_max_3m,
	transaction_utilities_trans_min_3m,
	transaction_utilities_trans_cnt_6m,
	transaction_utilities_trans_sum_6m,
	transaction_utilities_trans_max_6m,
	transaction_utilities_trans_min_6m,
	transaction_utilities_trans_cnt_12m,
	transaction_utilities_trans_sum_12m,
	transaction_utilities_trans_max_12m,
	transaction_utilities_trans_min_12m,
	transaction_utilities_trans_avg_sum_1m,
	transaction_utilities_trans_avg_sum_3m,
	transaction_utilities_trans_avg_sum_6m,
	transaction_utilities_trans_avg_sum_12m,
	transaction_utilities_trans_avg_cnt_1m,
	transaction_utilities_trans_avg_cnt_3m,
	transaction_utilities_trans_avg_cnt_6m,
	transaction_utilities_trans_avg_cnt_12m,
	transaction_tech_trans_cnt_1m,
	transaction_tech_trans_sum_1m,
	transaction_tech_trans_max_1m,
	transaction_tech_trans_min_1m,
	transaction_tech_trans_cnt_3m,
	transaction_tech_trans_sum_3m,
	transaction_tech_trans_max_3m,
	transaction_tech_trans_min_3m,
	transaction_tech_trans_cnt_6m,
	transaction_tech_trans_sum_6m,
	transaction_tech_trans_max_6m,
	transaction_tech_trans_min_6m,
	transaction_tech_trans_cnt_12m,
	transaction_tech_trans_sum_12m,
	transaction_tech_trans_max_12m,
	transaction_tech_trans_min_12m,
	transaction_tech_trans_avg_sum_1m,
	transaction_tech_trans_avg_sum_3m,
	transaction_tech_trans_avg_sum_6m,
	transaction_tech_trans_avg_sum_12m,
	transaction_tech_trans_avg_cnt_1m,
	transaction_tech_trans_avg_cnt_3m,
	transaction_tech_trans_avg_cnt_6m,
	transaction_tech_trans_avg_cnt_12m,
	transaction_jewelry_trans_cnt_1m,
	transaction_jewelry_trans_sum_1m,
	transaction_jewelry_trans_max_1m,
	transaction_jewelry_trans_min_1m,
	transaction_jewelry_trans_cnt_3m,
	transaction_jewelry_trans_sum_3m,
	transaction_jewelry_trans_max_3m,
	transaction_jewelry_trans_min_3m,
	transaction_jewelry_trans_cnt_6m,
	transaction_jewelry_trans_sum_6m,
	transaction_jewelry_trans_max_6m,
	transaction_jewelry_trans_min_6m,
	transaction_jewelry_trans_cnt_12m,
	transaction_jewelry_trans_sum_12m,
	transaction_jewelry_trans_max_12m,
	transaction_jewelry_trans_min_12m,
	transaction_jewelry_trans_avg_sum_1m,
	transaction_jewelry_trans_avg_sum_3m,
	transaction_jewelry_trans_avg_sum_6m,
	transaction_jewelry_trans_avg_sum_12m,
	transaction_jewelry_trans_avg_cnt_1m,
	transaction_jewelry_trans_avg_cnt_3m,
	transaction_jewelry_trans_avg_cnt_6m,
	transaction_jewelry_trans_avg_cnt_12m,
	transaction_clothes_trans_cnt_1m,
	transaction_clothes_trans_sum_1m,
	transaction_clothes_trans_max_1m,
	transaction_clothes_trans_min_1m,
	transaction_clothes_trans_cnt_3m,
	transaction_clothes_trans_sum_3m,
	transaction_clothes_trans_max_3m,
	transaction_clothes_trans_min_3m,
	transaction_clothes_trans_cnt_6m,
	transaction_clothes_trans_sum_6m,
	transaction_clothes_trans_max_6m,
	transaction_clothes_trans_min_6m,
	transaction_clothes_trans_cnt_12m,
	transaction_clothes_trans_sum_12m,
	transaction_clothes_trans_max_12m,
	transaction_clothes_trans_min_12m,
	transaction_clothes_trans_avg_sum_1m,
	transaction_clothes_trans_avg_sum_3m,
	transaction_clothes_trans_avg_sum_6m,
	transaction_clothes_trans_avg_sum_12m,
	transaction_clothes_trans_avg_cnt_1m,
	transaction_clothes_trans_avg_cnt_3m,
	transaction_clothes_trans_avg_cnt_6m,
	transaction_clothes_trans_avg_cnt_12m,
	transaction_education_trans_cnt_1m,
	transaction_education_trans_sum_1m,
	transaction_education_trans_max_1m,
	transaction_education_trans_min_1m,
	transaction_education_trans_cnt_3m,
	transaction_education_trans_sum_3m,
	transaction_education_trans_max_3m,
	transaction_education_trans_min_3m,
	transaction_education_trans_cnt_6m,
	transaction_education_trans_sum_6m,
	transaction_education_trans_max_6m,
	transaction_education_trans_min_6m,
	transaction_education_trans_cnt_12m,
	transaction_education_trans_sum_12m,
	transaction_education_trans_max_12m,
	transaction_education_trans_min_12m,
	transaction_education_trans_avg_sum_1m,
	transaction_education_trans_avg_sum_3m,
	transaction_education_trans_avg_sum_6m,
	transaction_education_trans_avg_sum_12m,
	transaction_education_trans_avg_cnt_1m,
	transaction_education_trans_avg_cnt_3m,
	transaction_education_trans_avg_cnt_6m,
	transaction_education_trans_avg_cnt_12m,
	transaction_finance_trans_cnt_1m,
	transaction_finance_trans_sum_1m,
	transaction_finance_trans_max_1m,
	transaction_finance_trans_min_1m,
	transaction_finance_trans_cnt_3m,
	transaction_finance_trans_sum_3m,
	transaction_finance_trans_max_3m,
	transaction_finance_trans_min_3m,
	transaction_finance_trans_cnt_6m,
	transaction_finance_trans_sum_6m,
	transaction_finance_trans_max_6m,
	transaction_finance_trans_min_6m,
	transaction_finance_trans_cnt_12m,
	transaction_finance_trans_sum_12m,
	transaction_finance_trans_max_12m,
	transaction_finance_trans_min_12m,
	transaction_finance_trans_avg_sum_1m,
	transaction_finance_trans_avg_sum_3m,
	transaction_finance_trans_avg_sum_6m,
	transaction_finance_trans_avg_sum_12m,
	transaction_finance_trans_avg_cnt_1m,
	transaction_finance_trans_avg_cnt_3m,
	transaction_finance_trans_avg_cnt_6m,
	transaction_finance_trans_avg_cnt_12m
from '||in_table||' a
LEFT JOIN '||in_table||'_TRANS_TEMP_1 t1
    ON t1.client_did = a.client_did
    AND t1.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_2 t2
    ON t2.client_did = a.client_did
    AND t2.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_3 t3
    ON t3.client_did = a.client_did
    AND t3.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_4 t4
    ON t4.client_did = a.client_did
    AND t4.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_5 t5
    ON t5.client_did = a.client_did
    AND t5.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_6 t6
    ON t6.client_did = a.client_did
    AND t6.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_7 t7
    ON t7.client_did = a.client_did
    AND t7.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_8 t8
    ON t8.client_did = a.client_did
    AND t8.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_9 t9
    ON t9.client_did = a.client_did
    AND t9.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_10 t10
    ON t10.client_did = a.client_did
    AND t10.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_11 t11
    ON t11.client_did = a.client_did
    AND t11.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_12 t12
    ON t12.client_did = a.client_did
    AND t12.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_13 t13
    ON t13.client_did = a.client_did
    AND t13.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_14 t14
    ON t14.client_did = a.client_did
    AND t14.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_16 t16
    ON t16.client_did = a.client_did
    AND t16.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_17 t17
    ON t17.client_did = a.client_did
    AND t17.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_18 t18
    ON t18.client_did = a.client_did
    AND t18.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_19 t19
    ON t19.client_did = a.client_did
    AND t19.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_20 t20
    ON t20.client_did = a.client_did
    AND t20.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_21 t21
    ON t21.client_did = a.client_did
    AND t21.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_22 t22
    ON t22.client_did = a.client_did
    AND t22.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_23 t23
    ON t23.client_did = a.client_did
    AND t23.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_24 t24
    ON t24.client_did = a.client_did
    AND t24.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_25 t25
    ON t25.client_did = a.client_did
    AND t25.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_26 t26
    ON t26.client_did = a.client_did
    AND t26.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_27 t27
    ON t27.client_did = a.client_did
    AND t27.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_28 t28
    ON t28.client_did = a.client_did
    AND t28.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_29 t29
    ON t29.client_did = a.client_did
    AND t29.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_30 t30
    ON t30.client_did = a.client_did
    AND t30.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_31 t31
    ON t31.client_did = a.client_did
    AND t31.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_32 t32
    ON t32.client_did = a.client_did
    AND t32.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_33 t33
    ON t33.client_did = a.client_did
    AND t33.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_35 t35
    ON t35.client_did = a.client_did
    AND t35.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_36 t36
    ON t36.client_did = a.client_did
    AND t36.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_38 t38
    ON t38.client_did = a.client_did
    AND t38.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_39 t39
    ON t39.client_did = a.client_did
    AND t39.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_40 t40
    ON t40.client_did = a.client_did
    AND t40.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_41 t41
    ON t41.client_did = a.client_did
    AND t41.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_42 t42
    ON t42.client_did = a.client_did
    AND t42.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_43 t43
    ON t43.client_did = a.client_did
    AND t43.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_44 t44
    ON t44.client_did = a.client_did
    AND t44.report_date = a.report_date

';

dbms_lob.append(my_str, add_str);

execute immediate my_str;



execute immediate '
create table '||in_table||'_TRANS_TEMP_00 as
select /*+parallel(8)*/ 
	client_did, 
	report_date,
	-- Средняя транзакция за последний месяц
    transaction_total_trans_sum_1m / NULLIF(transaction_total_trans_cnt_1m, 0) AS transaction_avg_trans_1m,

    -- Средняя транзакция за предыдущий месяц (рассчитывается как разница между 2-м и 1-м месяцем)
    (transaction_total_trans_sum_2m - transaction_total_trans_sum_1m) / NULLIF((transaction_total_trans_cnt_2m - transaction_total_trans_cnt_1m), 0) AS transaction_avg_trans_prev_1m,

    -- Разница средней транзакции последний месяц - transaction_предыдущий месяц
    (transaction_total_trans_sum_1m / NULLIF(transaction_total_trans_cnt_1m, 0) -
    (transaction_total_trans_sum_2m - transaction_total_trans_sum_1m) / NULLIF((transaction_total_trans_cnt_2m - transaction_total_trans_cnt_1m), 0)
    ) AS transaction_diff_avg_trans_1m,

    -- Средняя транзакция за последние 3 месяца
    transaction_total_trans_sum_3m / NULLIF(transaction_total_trans_cnt_3m, 0) AS transaction_avg_trans_3m,

    -- Средняя транзакция за предыдущие 3 месяца (рассчитывается как разница между 6-м и 3-м месяцем)
    (transaction_total_trans_sum_6m - transaction_total_trans_sum_3m) / NULLIF((transaction_total_trans_cnt_6m - transaction_total_trans_cnt_3m), 0) AS transaction_avg_trans_prev_3m,

    -- Разница средней транзакции за последние 3 месяца - transaction_предыдущие 3 месяца
    (transaction_total_trans_sum_3m / NULLIF(transaction_total_trans_cnt_3m, 0) -
    (transaction_total_trans_sum_6m - transaction_total_trans_sum_3m) / NULLIF((transaction_total_trans_cnt_6m - transaction_total_trans_cnt_3m), 0)
    ) AS transaction_diff_avg_trans_3m,

    -- Средняя транзакция за последние 12 месяцев
    transaction_total_trans_sum_12m / NULLIF(transaction_total_trans_cnt_12m, 0) AS transaction_avg_trans_12m,

    -- Средняя транзакция за предыдущие 12 месяцев
    transaction_total_trans_sum_24_12 / NULLIF(transaction_total_trans_cnt_24_12, 0) AS transaction_avg_trans_prev_12m,

    -- Разница средней транзакции за последние 12 месяцев - transaction_предыдущие 12 месяцев
    (transaction_total_trans_sum_12m / NULLIF(transaction_total_trans_cnt_12m, 0) -
    transaction_total_trans_sum_24_12 / NULLIF(transaction_total_trans_cnt_24_12, 0)
    ) AS transaction_diff_avg_trans_12m,

    -- Отношение средней транзакции последний месяц / предыдущий месяц
    (transaction_total_trans_sum_1m / NULLIF(transaction_total_trans_cnt_1m, 0)) /
    NULLIF(((transaction_total_trans_sum_2m - transaction_total_trans_sum_1m) / NULLIF((transaction_total_trans_cnt_2m - transaction_total_trans_cnt_1m), 0)), 0)
        AS transaction_ratio_avg_trans_1m,

    -- Отношение средней транзакции последние 3 месяца / предыдущие 3 месяца
    (transaction_total_trans_sum_3m / NULLIF(transaction_total_trans_cnt_3m, 0)) /
    NULLIF(((transaction_total_trans_sum_6m - transaction_total_trans_sum_3m) / NULLIF((transaction_total_trans_cnt_6m - transaction_total_trans_cnt_3m), 0)), 0)
        AS transaction_ratio_avg_trans_3m,

	-- Отношение средней транзакции последние 6 месяца / предыдущие 6 месяца
    (transaction_total_trans_sum_6m / NULLIF(transaction_total_trans_cnt_6m, 0)) /
    NULLIF(((transaction_total_trans_sum_12m - transaction_total_trans_sum_6m) / NULLIF((transaction_total_trans_cnt_12m - transaction_total_trans_cnt_6m), 0)), 0)
        AS transaction_ratio_avg_trans_6m,

    -- Отношение средней транзакции последние 12 месяцев / предыдущие 12 месяцев
    (transaction_total_trans_sum_12m / NULLIF(transaction_total_trans_cnt_12m, 0)) /
    NULLIF((transaction_total_trans_sum_24_12 / NULLIF(transaction_total_trans_cnt_24_12, 0)), 0)
        AS transaction_ratio_avg_trans_12m,

    -- Количество дней с первой и последней транзакции
    (report_date - transaction_first_trans_dt) AS transaction_days_since_first_trans,
    (report_date - transaction_last_trans_dt) AS transaction_days_since_last_trans,

    -- Максимальные транзакции
    (transaction_max_trans_1m - transaction_max_trans_prev_1m) AS transaction_diff_max_trans_1m,
	(transaction_max_trans_3m - transaction_max_trans_prev_3m) AS transaction_diff_max_trans_3m,
	(transaction_max_trans_6m - transaction_max_trans_prev_6m) AS transaction_diff_max_trans_6m,
    (transaction_max_trans_12m - transaction_max_trans_prev_12m) AS transaction_diff_max_trans_12m,

    transaction_max_trans_1m / NULLIF(transaction_max_trans_prev_1m, 0) AS transaction_ratio_max_trans_1m,
	transaction_max_trans_3m / NULLIF(transaction_max_trans_prev_3m, 0) AS transaction_ratio_max_trans_3m,
	transaction_max_trans_6m / NULLIF(transaction_max_trans_prev_6m, 0) AS transaction_ratio_max_trans_6m,
    transaction_max_trans_12m / NULLIF(transaction_max_trans_prev_12m, 0) AS transaction_ratio_max_trans_12m,

    -- Минимальные транзакции
    (transaction_min_trans_1m - transaction_min_trans_prev_1m) AS transaction_diff_min_trans_1m,
    (transaction_min_trans_3m - transaction_min_trans_prev_3m) AS transaction_diff_min_trans_3m,
	(transaction_min_trans_6m - transaction_min_trans_prev_6m) AS transaction_diff_min_trans_6m,
    (transaction_min_trans_12m - transaction_min_trans_prev_12m) AS transaction_diff_min_trans_12m,

    transaction_min_trans_1m / NULLIF(transaction_min_trans_prev_1m, 0) AS transaction_ratio_min_trans_1m,
    transaction_min_trans_3m / NULLIF(transaction_min_trans_prev_3m, 0) AS transaction_ratio_min_trans_3m,
	transaction_min_trans_6m / NULLIF(transaction_min_trans_prev_6m, 0) AS transaction_ratio_min_trans_6m,
    transaction_min_trans_12m / NULLIF(transaction_min_trans_prev_12m, 0) AS transaction_ratio_min_trans_12m,

    -- Разница суммы транзакций
    (transaction_total_trans_sum_1m - (transaction_total_trans_sum_2m - transaction_total_trans_sum_1m)) AS transaction_diff_total_trans_sum_1m,
    (transaction_total_trans_sum_3m - (transaction_total_trans_sum_6m - transaction_total_trans_sum_3m)) AS transaction_diff_total_trans_sum_3m,
	(transaction_total_trans_sum_6m - (transaction_total_trans_sum_12m - transaction_total_trans_sum_6m)) AS transaction_diff_total_trans_sum_6m,
    (transaction_total_trans_sum_12m - transaction_total_trans_sum_24_12) AS transaction_diff_total_trans_sum_12m,
	
	-- Отношение количества транзакции последний месяц / предыдущий месяц
    transaction_total_trans_cnt_1m / NULLIF((transaction_total_trans_cnt_2m - transaction_total_trans_cnt_1m), 0)
        AS transaction_ratio_cnt_trans_1m_to_1m, --t_30_all_cnt

	-- Отношение количества транзакции последние 3 месяца / предыдущие 3 месяца
    transaction_total_trans_cnt_3m /
    NULLIF((transaction_total_trans_cnt_6m - transaction_total_trans_cnt_3m), 0)
        AS transaction_ratio_cnt_trans_3m_to_3m, --t_90_all_cnt
		
	-- Отношение количества транзакции последние 5 месяцев / предыдущие 5 месяцев
    transaction_total_trans_cnt_5m /
    NULLIF(transaction_total_trans_cnt_10_5, 0)
        AS transaction_ratio_cnt_trans_5m_to_5m --t_150_all_cnt

	FROM '||in_table||'_TRANS_TEMP_0
	';

execute immediate '
create table '||in_table||'_TRANS_TEMP_48 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_dom_rem_trans_cnt_1m / NULLIF (transaction_dom_rem_trans_cnt_3m, 0) AS transaction_dom_rem_trans_cnt_1m_to_3m,
    transaction_dom_rem_trans_sum_1m / NULLIF (transaction_dom_rem_trans_sum_3m, 0) AS transaction_dom_rem_trans_sum_1m_to_3m,
    transaction_dom_rem_trans_cnt_3m / NULLIF (transaction_dom_rem_trans_cnt_6m, 0) AS transaction_dom_rem_trans_cnt_3m_to_6m,
    transaction_dom_rem_trans_sum_3m / NULLIF (transaction_dom_rem_trans_sum_6m, 0) AS transaction_dom_rem_trans_sum_3m_to_6m,
    transaction_dom_rem_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_dom_rem_trans_cnt_1m_to_total_1m, 
    transaction_dom_rem_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_dom_rem_trans_sum_1m_to_total_1m, 
    transaction_dom_rem_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_dom_rem_trans_cnt_3m_to_total_3m, 
    transaction_dom_rem_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_dom_rem_trans_sum_3m_to_total_3m,
    transaction_dom_rem_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_dom_rem_trans_cnt_3m_to_total_6m, 
    transaction_dom_rem_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_dom_rem_trans_sum_3m_to_total_6m, 
    transaction_dom_rem_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_dom_rem_trans_cnt_6m_to_total_6m, 
    transaction_dom_rem_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_dom_rem_trans_sum_6m_to_total_6m, 
    transaction_dom_rem_trans_avg_sum_1m / NULLIF (transaction_dom_rem_trans_avg_sum_3m, 0) AS transaction_dom_rem_trans_avg_sum_1m_to_3m, 
    transaction_dom_rem_trans_avg_cnt_1m / NULLIF (transaction_dom_rem_trans_avg_cnt_3m, 0) AS transaction_dom_rem_trans_avg_cnt_1m_to_3m, 
    transaction_dom_rem_trans_avg_sum_3m / NULLIF (transaction_dom_rem_trans_avg_sum_6m, 0) AS transaction_dom_rem_trans_avg_sum_3m_to_6m, 
    transaction_dom_rem_trans_avg_cnt_3m / NULLIF (transaction_dom_rem_trans_avg_cnt_6m, 0) AS transaction_dom_rem_trans_avg_cnt_3m_to_6m, 
    transaction_dom_rem_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_dom_rem_trans_avg_sum_1m_to_total_1m,
    transaction_dom_rem_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_dom_rem_trans_avg_cnt_1m_to_total_1m,
    transaction_dom_rem_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_dom_rem_trans_avg_sum_3m_to_total_3m, 
    transaction_dom_rem_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_dom_rem_trans_avg_cnt_3m_to_total_3m, 
    transaction_dom_rem_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_dom_rem_trans_avg_sum_3m_to_total_6m, 
    transaction_dom_rem_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_dom_rem_trans_avg_cnt_3m_to_total_6m, 
    transaction_dom_rem_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_dom_rem_trans_avg_sum_6m_to_total_6m, 
    transaction_dom_rem_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_dom_rem_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_1 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_49 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_cafe_trans_cnt_1m / NULLIF (transaction_cafe_trans_cnt_3m, 0) AS transaction_cafe_trans_cnt_1m_to_3m,
    transaction_cafe_trans_sum_1m / NULLIF (transaction_cafe_trans_sum_3m, 0) AS transaction_cafe_trans_sum_1m_to_3m,
    transaction_cafe_trans_cnt_3m / NULLIF (transaction_cafe_trans_cnt_6m, 0) AS transaction_cafe_trans_cnt_3m_to_6m,
    transaction_cafe_trans_sum_3m / NULLIF (transaction_cafe_trans_sum_6m, 0) AS transaction_cafe_trans_sum_3m_to_6m,
    transaction_cafe_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_cafe_trans_cnt_1m_to_total_1m, 
    transaction_cafe_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_cafe_trans_sum_1m_to_total_1m, 
    transaction_cafe_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_cafe_trans_cnt_3m_to_total_3m, 
    transaction_cafe_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_cafe_trans_sum_3m_to_total_3m,
    transaction_cafe_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cafe_trans_cnt_3m_to_total_6m, 
    transaction_cafe_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cafe_trans_sum_3m_to_total_6m, 
    transaction_cafe_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cafe_trans_cnt_6m_to_total_6m, 
    transaction_cafe_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cafe_trans_sum_6m_to_total_6m, 
    transaction_cafe_trans_avg_sum_1m / NULLIF (transaction_cafe_trans_avg_sum_3m, 0) AS transaction_cafe_trans_avg_sum_1m_to_3m, 
    transaction_cafe_trans_avg_cnt_1m / NULLIF (transaction_cafe_trans_avg_cnt_3m, 0) AS transaction_cafe_trans_avg_cnt_1m_to_3m, 
    transaction_cafe_trans_avg_sum_3m / NULLIF (transaction_cafe_trans_avg_sum_6m, 0) AS transaction_cafe_trans_avg_sum_3m_to_6m, 
    transaction_cafe_trans_avg_cnt_3m / NULLIF (transaction_cafe_trans_avg_cnt_6m, 0) AS transaction_cafe_trans_avg_cnt_3m_to_6m, 
    transaction_cafe_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_cafe_trans_avg_sum_1m_to_total_1m,
    transaction_cafe_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_cafe_trans_avg_cnt_1m_to_total_1m,
    transaction_cafe_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_cafe_trans_avg_sum_3m_to_total_3m, 
    transaction_cafe_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_cafe_trans_avg_cnt_3m_to_total_3m, 
    transaction_cafe_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cafe_trans_avg_sum_3m_to_total_6m, 
    transaction_cafe_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cafe_trans_avg_cnt_3m_to_total_6m, 
    transaction_cafe_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cafe_trans_avg_sum_6m_to_total_6m, 
    transaction_cafe_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cafe_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_2 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_50 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_rent_auto_trans_cnt_1m / NULLIF (transaction_rent_auto_trans_cnt_3m, 0) AS transaction_rent_auto_trans_cnt_1m_to_3m,
    transaction_rent_auto_trans_sum_1m / NULLIF (transaction_rent_auto_trans_sum_3m, 0) AS transaction_rent_auto_trans_sum_1m_to_3m,
    transaction_rent_auto_trans_cnt_3m / NULLIF (transaction_rent_auto_trans_cnt_6m, 0) AS transaction_rent_auto_trans_cnt_3m_to_6m,
    transaction_rent_auto_trans_sum_3m / NULLIF (transaction_rent_auto_trans_sum_6m, 0) AS transaction_rent_auto_trans_sum_3m_to_6m,
    transaction_rent_auto_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_rent_auto_trans_cnt_1m_to_total_1m, 
    transaction_rent_auto_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_rent_auto_trans_sum_1m_to_total_1m, 
    transaction_rent_auto_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_rent_auto_trans_cnt_3m_to_total_3m, 
    transaction_rent_auto_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_rent_auto_trans_sum_3m_to_total_3m,
    transaction_rent_auto_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_rent_auto_trans_cnt_3m_to_total_6m, 
    transaction_rent_auto_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_rent_auto_trans_sum_3m_to_total_6m, 
    transaction_rent_auto_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_rent_auto_trans_cnt_6m_to_total_6m, 
    transaction_rent_auto_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_rent_auto_trans_sum_6m_to_total_6m, 
    transaction_rent_auto_trans_avg_sum_1m / NULLIF (transaction_rent_auto_trans_avg_sum_3m, 0) AS transaction_rent_auto_trans_avg_sum_1m_to_3m, 
    transaction_rent_auto_trans_avg_cnt_1m / NULLIF (transaction_rent_auto_trans_avg_cnt_3m, 0) AS transaction_rent_auto_trans_avg_cnt_1m_to_3m, 
    transaction_rent_auto_trans_avg_sum_3m / NULLIF (transaction_rent_auto_trans_avg_sum_6m, 0) AS transaction_rent_auto_trans_avg_sum_3m_to_6m, 
    transaction_rent_auto_trans_avg_cnt_3m / NULLIF (transaction_rent_auto_trans_avg_cnt_6m, 0) AS transaction_rent_auto_trans_avg_cnt_3m_to_6m, 
    transaction_rent_auto_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_rent_auto_trans_avg_sum_1m_to_total_1m,
    transaction_rent_auto_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_rent_auto_trans_avg_cnt_1m_to_total_1m,
    transaction_rent_auto_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_rent_auto_trans_avg_sum_3m_to_total_3m, 
    transaction_rent_auto_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_rent_auto_trans_avg_cnt_3m_to_total_3m, 
    transaction_rent_auto_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_rent_auto_trans_avg_sum_3m_to_total_6m, 
    transaction_rent_auto_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_rent_auto_trans_avg_cnt_3m_to_total_6m, 
    transaction_rent_auto_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_rent_auto_trans_avg_sum_6m_to_total_6m, 
    transaction_rent_auto_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_rent_auto_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_3 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_51 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_transport_trans_cnt_1m / NULLIF (transaction_transport_trans_cnt_3m, 0) AS transaction_transport_trans_cnt_1m_to_3m,
    transaction_transport_trans_sum_1m / NULLIF (transaction_transport_trans_sum_3m, 0) AS transaction_transport_trans_sum_1m_to_3m,
    transaction_transport_trans_cnt_3m / NULLIF (transaction_transport_trans_cnt_6m, 0) AS transaction_transport_trans_cnt_3m_to_6m,
    transaction_transport_trans_sum_3m / NULLIF (transaction_transport_trans_sum_6m, 0) AS transaction_transport_trans_sum_3m_to_6m,
    transaction_transport_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_transport_trans_cnt_1m_to_total_1m, 
    transaction_transport_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_transport_trans_sum_1m_to_total_1m, 
    transaction_transport_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_transport_trans_cnt_3m_to_total_3m, 
    transaction_transport_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_transport_trans_sum_3m_to_total_3m,
    transaction_transport_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_transport_trans_cnt_3m_to_total_6m, 
    transaction_transport_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_transport_trans_sum_3m_to_total_6m, 
    transaction_transport_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_transport_trans_cnt_6m_to_total_6m, 
    transaction_transport_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_transport_trans_sum_6m_to_total_6m, 
    transaction_transport_trans_avg_sum_1m / NULLIF (transaction_transport_trans_avg_sum_3m, 0) AS transaction_transport_trans_avg_sum_1m_to_3m, 
    transaction_transport_trans_avg_cnt_1m / NULLIF (transaction_transport_trans_avg_cnt_3m, 0) AS transaction_transport_trans_avg_cnt_1m_to_3m, 
    transaction_transport_trans_avg_sum_3m / NULLIF (transaction_transport_trans_avg_sum_6m, 0) AS transaction_transport_trans_avg_sum_3m_to_6m, 
    transaction_transport_trans_avg_cnt_3m / NULLIF (transaction_transport_trans_avg_cnt_6m, 0) AS transaction_transport_trans_avg_cnt_3m_to_6m, 
    transaction_transport_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_transport_trans_avg_sum_1m_to_total_1m,
    transaction_transport_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_transport_trans_avg_cnt_1m_to_total_1m,
    transaction_transport_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_transport_trans_avg_sum_3m_to_total_3m, 
    transaction_transport_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_transport_trans_avg_cnt_3m_to_total_3m, 
    transaction_transport_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_transport_trans_avg_sum_3m_to_total_6m, 
    transaction_transport_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_transport_trans_avg_cnt_3m_to_total_6m, 
    transaction_transport_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_transport_trans_avg_sum_6m_to_total_6m, 
    transaction_transport_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_transport_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_4 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_52 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_travel_trans_cnt_1m / NULLIF (transaction_travel_trans_cnt_3m, 0) AS transaction_travel_trans_cnt_1m_to_3m,
    transaction_travel_trans_sum_1m / NULLIF (transaction_travel_trans_sum_3m, 0) AS transaction_travel_trans_sum_1m_to_3m,
    transaction_travel_trans_cnt_3m / NULLIF (transaction_travel_trans_cnt_6m, 0) AS transaction_travel_trans_cnt_3m_to_6m,
    transaction_travel_trans_sum_3m / NULLIF (transaction_travel_trans_sum_6m, 0) AS transaction_travel_trans_sum_3m_to_6m,
    transaction_travel_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_travel_trans_cnt_1m_to_total_1m, 
    transaction_travel_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_travel_trans_sum_1m_to_total_1m, 
    transaction_travel_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_travel_trans_cnt_3m_to_total_3m, 
    transaction_travel_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_travel_trans_sum_3m_to_total_3m,
    transaction_travel_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_travel_trans_cnt_3m_to_total_6m, 
    transaction_travel_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_travel_trans_sum_3m_to_total_6m, 
    transaction_travel_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_travel_trans_cnt_6m_to_total_6m, 
    transaction_travel_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_travel_trans_sum_6m_to_total_6m, 
    transaction_travel_trans_avg_sum_1m / NULLIF (transaction_travel_trans_avg_sum_3m, 0) AS transaction_travel_trans_avg_sum_1m_to_3m, 
    transaction_travel_trans_avg_cnt_1m / NULLIF (transaction_travel_trans_avg_cnt_3m, 0) AS transaction_travel_trans_avg_cnt_1m_to_3m, 
    transaction_travel_trans_avg_sum_3m / NULLIF (transaction_travel_trans_avg_sum_6m, 0) AS transaction_travel_trans_avg_sum_3m_to_6m, 
    transaction_travel_trans_avg_cnt_3m / NULLIF (transaction_travel_trans_avg_cnt_6m, 0) AS transaction_travel_trans_avg_cnt_3m_to_6m, 
    transaction_travel_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_travel_trans_avg_sum_1m_to_total_1m,
    transaction_travel_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_travel_trans_avg_cnt_1m_to_total_1m,
    transaction_travel_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_travel_trans_avg_sum_3m_to_total_3m, 
    transaction_travel_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_travel_trans_avg_cnt_3m_to_total_3m, 
    transaction_travel_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_travel_trans_avg_sum_3m_to_total_6m, 
    transaction_travel_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_travel_trans_avg_cnt_3m_to_total_6m, 
    transaction_travel_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_travel_trans_avg_sum_6m_to_total_6m, 
    transaction_travel_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_travel_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_5 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_53 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_medicine_trans_cnt_1m / NULLIF (transaction_medicine_trans_cnt_3m, 0) AS transaction_medicine_trans_cnt_1m_to_3m,
    transaction_medicine_trans_sum_1m / NULLIF (transaction_medicine_trans_sum_3m, 0) AS transaction_medicine_trans_sum_1m_to_3m,
    transaction_medicine_trans_cnt_3m / NULLIF (transaction_medicine_trans_cnt_6m, 0) AS transaction_medicine_trans_cnt_3m_to_6m,
    transaction_medicine_trans_sum_3m / NULLIF (transaction_medicine_trans_sum_6m, 0) AS transaction_medicine_trans_sum_3m_to_6m,
    transaction_medicine_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_medicine_trans_cnt_1m_to_total_1m, 
    transaction_medicine_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_medicine_trans_sum_1m_to_total_1m, 
    transaction_medicine_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_medicine_trans_cnt_3m_to_total_3m, 
    transaction_medicine_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_medicine_trans_sum_3m_to_total_3m,
    transaction_medicine_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_medicine_trans_cnt_3m_to_total_6m, 
    transaction_medicine_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_medicine_trans_sum_3m_to_total_6m, 
    transaction_medicine_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_medicine_trans_cnt_6m_to_total_6m, 
    transaction_medicine_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_medicine_trans_sum_6m_to_total_6m, 
    transaction_medicine_trans_avg_sum_1m / NULLIF (transaction_medicine_trans_avg_sum_3m, 0) AS transaction_medicine_trans_avg_sum_1m_to_3m, 
    transaction_medicine_trans_avg_cnt_1m / NULLIF (transaction_medicine_trans_avg_cnt_3m, 0) AS transaction_medicine_trans_avg_cnt_1m_to_3m, 
    transaction_medicine_trans_avg_sum_3m / NULLIF (transaction_medicine_trans_avg_sum_6m, 0) AS transaction_medicine_trans_avg_sum_3m_to_6m, 
    transaction_medicine_trans_avg_cnt_3m / NULLIF (transaction_medicine_trans_avg_cnt_6m, 0) AS transaction_medicine_trans_avg_cnt_3m_to_6m, 
    transaction_medicine_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_medicine_trans_avg_sum_1m_to_total_1m,
    transaction_medicine_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_medicine_trans_avg_cnt_1m_to_total_1m,
    transaction_medicine_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_medicine_trans_avg_sum_3m_to_total_3m, 
    transaction_medicine_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_medicine_trans_avg_cnt_3m_to_total_3m, 
    transaction_medicine_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_medicine_trans_avg_sum_3m_to_total_6m, 
    transaction_medicine_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_medicine_trans_avg_cnt_3m_to_total_6m, 
    transaction_medicine_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_medicine_trans_avg_sum_6m_to_total_6m, 
    transaction_medicine_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_medicine_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_6 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_54 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_online_shops_trans_cnt_1m / NULLIF (transaction_online_shops_trans_cnt_3m, 0) AS transaction_online_shops_trans_cnt_1m_to_3m,
    transaction_online_shops_trans_sum_1m / NULLIF (transaction_online_shops_trans_sum_3m, 0) AS transaction_online_shops_trans_sum_1m_to_3m,
    transaction_online_shops_trans_cnt_3m / NULLIF (transaction_online_shops_trans_cnt_6m, 0) AS transaction_online_shops_trans_cnt_3m_to_6m,
    transaction_online_shops_trans_sum_3m / NULLIF (transaction_online_shops_trans_sum_6m, 0) AS transaction_online_shops_trans_sum_3m_to_6m,
    transaction_online_shops_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_online_shops_trans_cnt_1m_to_total_1m, 
    transaction_online_shops_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_online_shops_trans_sum_1m_to_total_1m, 
    transaction_online_shops_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_online_shops_trans_cnt_3m_to_total_3m, 
    transaction_online_shops_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_online_shops_trans_sum_3m_to_total_3m,
    transaction_online_shops_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_online_shops_trans_cnt_3m_to_total_6m, 
    transaction_online_shops_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_online_shops_trans_sum_3m_to_total_6m, 
    transaction_online_shops_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_online_shops_trans_cnt_6m_to_total_6m, 
    transaction_online_shops_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_online_shops_trans_sum_6m_to_total_6m, 
    transaction_online_shops_trans_avg_sum_1m / NULLIF (transaction_online_shops_trans_avg_sum_3m, 0) AS transaction_online_shops_trans_avg_sum_1m_to_3m, 
    transaction_online_shops_trans_avg_cnt_1m / NULLIF (transaction_online_shops_trans_avg_cnt_3m, 0) AS transaction_online_shops_trans_avg_cnt_1m_to_3m, 
    transaction_online_shops_trans_avg_sum_3m / NULLIF (transaction_online_shops_trans_avg_sum_6m, 0) AS transaction_online_shops_trans_avg_sum_3m_to_6m, 
    transaction_online_shops_trans_avg_cnt_3m / NULLIF (transaction_online_shops_trans_avg_cnt_6m, 0) AS transaction_online_shops_trans_avg_cnt_3m_to_6m, 
    transaction_online_shops_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_online_shops_trans_avg_sum_1m_to_total_1m,
    transaction_online_shops_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_online_shops_trans_avg_cnt_1m_to_total_1m,
    transaction_online_shops_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_online_shops_trans_avg_sum_3m_to_total_3m, 
    transaction_online_shops_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_online_shops_trans_avg_cnt_3m_to_total_3m, 
    transaction_online_shops_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_online_shops_trans_avg_sum_3m_to_total_6m, 
    transaction_online_shops_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_online_shops_trans_avg_cnt_3m_to_total_6m, 
    transaction_online_shops_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_online_shops_trans_avg_sum_6m_to_total_6m, 
    transaction_online_shops_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_online_shops_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_7 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_55 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_music_trans_cnt_1m / NULLIF (transaction_music_trans_cnt_3m, 0) AS transaction_music_trans_cnt_1m_to_3m,
    transaction_music_trans_sum_1m / NULLIF (transaction_music_trans_sum_3m, 0) AS transaction_music_trans_sum_1m_to_3m,
    transaction_music_trans_cnt_3m / NULLIF (transaction_music_trans_cnt_6m, 0) AS transaction_music_trans_cnt_3m_to_6m,
    transaction_music_trans_sum_3m / NULLIF (transaction_music_trans_sum_6m, 0) AS transaction_music_trans_sum_3m_to_6m,
    transaction_music_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_music_trans_cnt_1m_to_total_1m, 
    transaction_music_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_music_trans_sum_1m_to_total_1m, 
    transaction_music_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_music_trans_cnt_3m_to_total_3m, 
    transaction_music_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_music_trans_sum_3m_to_total_3m,
    transaction_music_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_music_trans_cnt_3m_to_total_6m, 
    transaction_music_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_music_trans_sum_3m_to_total_6m, 
    transaction_music_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_music_trans_cnt_6m_to_total_6m, 
    transaction_music_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_music_trans_sum_6m_to_total_6m, 
    transaction_music_trans_avg_sum_1m / NULLIF (transaction_music_trans_avg_sum_3m, 0) AS transaction_music_trans_avg_sum_1m_to_3m, 
    transaction_music_trans_avg_cnt_1m / NULLIF (transaction_music_trans_avg_cnt_3m, 0) AS transaction_music_trans_avg_cnt_1m_to_3m, 
    transaction_music_trans_avg_sum_3m / NULLIF (transaction_music_trans_avg_sum_6m, 0) AS transaction_music_trans_avg_sum_3m_to_6m, 
    transaction_music_trans_avg_cnt_3m / NULLIF (transaction_music_trans_avg_cnt_6m, 0) AS transaction_music_trans_avg_cnt_3m_to_6m, 
    transaction_music_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_music_trans_avg_sum_1m_to_total_1m,
    transaction_music_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_music_trans_avg_cnt_1m_to_total_1m,
    transaction_music_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_music_trans_avg_sum_3m_to_total_3m, 
    transaction_music_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_music_trans_avg_cnt_3m_to_total_3m, 
    transaction_music_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_music_trans_avg_sum_3m_to_total_6m, 
    transaction_music_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_music_trans_avg_cnt_3m_to_total_6m, 
    transaction_music_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_music_trans_avg_sum_6m_to_total_6m, 
    transaction_music_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_music_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_8 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_56 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_lombards_trans_cnt_1m / NULLIF (transaction_lombards_trans_cnt_3m, 0) AS transaction_lombards_trans_cnt_1m_to_3m,
    transaction_lombards_trans_sum_1m / NULLIF (transaction_lombards_trans_sum_3m, 0) AS transaction_lombards_trans_sum_1m_to_3m,
    transaction_lombards_trans_cnt_3m / NULLIF (transaction_lombards_trans_cnt_6m, 0) AS transaction_lombards_trans_cnt_3m_to_6m,
    transaction_lombards_trans_sum_3m / NULLIF (transaction_lombards_trans_sum_6m, 0) AS transaction_lombards_trans_sum_3m_to_6m,
    transaction_lombards_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_lombards_trans_cnt_1m_to_total_1m, 
    transaction_lombards_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_lombards_trans_sum_1m_to_total_1m, 
    transaction_lombards_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_lombards_trans_cnt_3m_to_total_3m, 
    transaction_lombards_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_lombards_trans_sum_3m_to_total_3m,
    transaction_lombards_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_lombards_trans_cnt_3m_to_total_6m, 
    transaction_lombards_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_lombards_trans_sum_3m_to_total_6m, 
    transaction_lombards_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_lombards_trans_cnt_6m_to_total_6m, 
    transaction_lombards_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_lombards_trans_sum_6m_to_total_6m, 
    transaction_lombards_trans_avg_sum_1m / NULLIF (transaction_lombards_trans_avg_sum_3m, 0) AS transaction_lombards_trans_avg_sum_1m_to_3m, 
    transaction_lombards_trans_avg_cnt_1m / NULLIF (transaction_lombards_trans_avg_cnt_3m, 0) AS transaction_lombards_trans_avg_cnt_1m_to_3m, 
    transaction_lombards_trans_avg_sum_3m / NULLIF (transaction_lombards_trans_avg_sum_6m, 0) AS transaction_lombards_trans_avg_sum_3m_to_6m, 
    transaction_lombards_trans_avg_cnt_3m / NULLIF (transaction_lombards_trans_avg_cnt_6m, 0) AS transaction_lombards_trans_avg_cnt_3m_to_6m, 
    transaction_lombards_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_lombards_trans_avg_sum_1m_to_total_1m,
    transaction_lombards_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_lombards_trans_avg_cnt_1m_to_total_1m,
    transaction_lombards_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_lombards_trans_avg_sum_3m_to_total_3m, 
    transaction_lombards_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_lombards_trans_avg_cnt_3m_to_total_3m, 
    transaction_lombards_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_lombards_trans_avg_sum_3m_to_total_6m, 
    transaction_lombards_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_lombards_trans_avg_cnt_3m_to_total_6m, 
    transaction_lombards_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_lombards_trans_avg_sum_6m_to_total_6m, 
    transaction_lombards_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_lombards_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_9 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_57 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_zoo_trans_cnt_1m / NULLIF (transaction_zoo_trans_cnt_3m, 0) AS transaction_zoo_trans_cnt_1m_to_3m,
    transaction_zoo_trans_sum_1m / NULLIF (transaction_zoo_trans_sum_3m, 0) AS transaction_zoo_trans_sum_1m_to_3m,
    transaction_zoo_trans_cnt_3m / NULLIF (transaction_zoo_trans_cnt_6m, 0) AS transaction_zoo_trans_cnt_3m_to_6m,
    transaction_zoo_trans_sum_3m / NULLIF (transaction_zoo_trans_sum_6m, 0) AS transaction_zoo_trans_sum_3m_to_6m,
    transaction_zoo_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_zoo_trans_cnt_1m_to_total_1m, 
    transaction_zoo_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_zoo_trans_sum_1m_to_total_1m, 
    transaction_zoo_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_zoo_trans_cnt_3m_to_total_3m, 
    transaction_zoo_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_zoo_trans_sum_3m_to_total_3m,
    transaction_zoo_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_zoo_trans_cnt_3m_to_total_6m, 
    transaction_zoo_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_zoo_trans_sum_3m_to_total_6m, 
    transaction_zoo_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_zoo_trans_cnt_6m_to_total_6m, 
    transaction_zoo_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_zoo_trans_sum_6m_to_total_6m, 
    transaction_zoo_trans_avg_sum_1m / NULLIF (transaction_zoo_trans_avg_sum_3m, 0) AS transaction_zoo_trans_avg_sum_1m_to_3m, 
    transaction_zoo_trans_avg_cnt_1m / NULLIF (transaction_zoo_trans_avg_cnt_3m, 0) AS transaction_zoo_trans_avg_cnt_1m_to_3m, 
    transaction_zoo_trans_avg_sum_3m / NULLIF (transaction_zoo_trans_avg_sum_6m, 0) AS transaction_zoo_trans_avg_sum_3m_to_6m, 
    transaction_zoo_trans_avg_cnt_3m / NULLIF (transaction_zoo_trans_avg_cnt_6m, 0) AS transaction_zoo_trans_avg_cnt_3m_to_6m, 
    transaction_zoo_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_zoo_trans_avg_sum_1m_to_total_1m,
    transaction_zoo_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_zoo_trans_avg_cnt_1m_to_total_1m,
    transaction_zoo_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_zoo_trans_avg_sum_3m_to_total_3m, 
    transaction_zoo_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_zoo_trans_avg_cnt_3m_to_total_3m, 
    transaction_zoo_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_zoo_trans_avg_sum_3m_to_total_6m, 
    transaction_zoo_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_zoo_trans_avg_cnt_3m_to_total_6m, 
    transaction_zoo_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_zoo_trans_avg_sum_6m_to_total_6m, 
    transaction_zoo_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_zoo_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_10 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_58 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_air_tickets_trans_cnt_1m / NULLIF (transaction_air_tickets_trans_cnt_3m, 0) AS transaction_air_tickets_trans_cnt_1m_to_3m,
    transaction_air_tickets_trans_sum_1m / NULLIF (transaction_air_tickets_trans_sum_3m, 0) AS transaction_air_tickets_trans_sum_1m_to_3m,
    transaction_air_tickets_trans_cnt_3m / NULLIF (transaction_air_tickets_trans_cnt_6m, 0) AS transaction_air_tickets_trans_cnt_3m_to_6m,
    transaction_air_tickets_trans_sum_3m / NULLIF (transaction_air_tickets_trans_sum_6m, 0) AS transaction_air_tickets_trans_sum_3m_to_6m,
    transaction_air_tickets_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_air_tickets_trans_cnt_1m_to_total_1m, 
    transaction_air_tickets_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_air_tickets_trans_sum_1m_to_total_1m, 
    transaction_air_tickets_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_air_tickets_trans_cnt_3m_to_total_3m, 
    transaction_air_tickets_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_air_tickets_trans_sum_3m_to_total_3m,
    transaction_air_tickets_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_air_tickets_trans_cnt_3m_to_total_6m, 
    transaction_air_tickets_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_air_tickets_trans_sum_3m_to_total_6m, 
    transaction_air_tickets_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_air_tickets_trans_cnt_6m_to_total_6m, 
    transaction_air_tickets_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_air_tickets_trans_sum_6m_to_total_6m, 
    transaction_air_tickets_trans_avg_sum_1m / NULLIF (transaction_air_tickets_trans_avg_sum_3m, 0) AS transaction_air_tickets_trans_avg_sum_1m_to_3m, 
    transaction_air_tickets_trans_avg_cnt_1m / NULLIF (transaction_air_tickets_trans_avg_cnt_3m, 0) AS transaction_air_tickets_trans_avg_cnt_1m_to_3m, 
    transaction_air_tickets_trans_avg_sum_3m / NULLIF (transaction_air_tickets_trans_avg_sum_6m, 0) AS transaction_air_tickets_trans_avg_sum_3m_to_6m, 
    transaction_air_tickets_trans_avg_cnt_3m / NULLIF (transaction_air_tickets_trans_avg_cnt_6m, 0) AS transaction_air_tickets_trans_avg_cnt_3m_to_6m, 
    transaction_air_tickets_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_air_tickets_trans_avg_sum_1m_to_total_1m,
    transaction_air_tickets_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_air_tickets_trans_avg_cnt_1m_to_total_1m,
    transaction_air_tickets_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_air_tickets_trans_avg_sum_3m_to_total_3m, 
    transaction_air_tickets_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_air_tickets_trans_avg_cnt_3m_to_total_3m, 
    transaction_air_tickets_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_air_tickets_trans_avg_sum_3m_to_total_6m, 
    transaction_air_tickets_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_air_tickets_trans_avg_cnt_3m_to_total_6m, 
    transaction_air_tickets_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_air_tickets_trans_avg_sum_6m_to_total_6m, 
    transaction_air_tickets_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_air_tickets_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_11 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_59 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_hotels_trans_cnt_1m / NULLIF (transaction_hotels_trans_cnt_3m, 0) AS transaction_hotels_trans_cnt_1m_to_3m,
    transaction_hotels_trans_sum_1m / NULLIF (transaction_hotels_trans_sum_3m, 0) AS transaction_hotels_trans_sum_1m_to_3m,
    transaction_hotels_trans_cnt_3m / NULLIF (transaction_hotels_trans_cnt_6m, 0) AS transaction_hotels_trans_cnt_3m_to_6m,
    transaction_hotels_trans_sum_3m / NULLIF (transaction_hotels_trans_sum_6m, 0) AS transaction_hotels_trans_sum_3m_to_6m,
    transaction_hotels_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_hotels_trans_cnt_1m_to_total_1m, 
    transaction_hotels_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_hotels_trans_sum_1m_to_total_1m, 
    transaction_hotels_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_hotels_trans_cnt_3m_to_total_3m, 
    transaction_hotels_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_hotels_trans_sum_3m_to_total_3m,
    transaction_hotels_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_hotels_trans_cnt_3m_to_total_6m, 
    transaction_hotels_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_hotels_trans_sum_3m_to_total_6m, 
    transaction_hotels_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_hotels_trans_cnt_6m_to_total_6m, 
    transaction_hotels_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_hotels_trans_sum_6m_to_total_6m, 
    transaction_hotels_trans_avg_sum_1m / NULLIF (transaction_hotels_trans_avg_sum_3m, 0) AS transaction_hotels_trans_avg_sum_1m_to_3m, 
    transaction_hotels_trans_avg_cnt_1m / NULLIF (transaction_hotels_trans_avg_cnt_3m, 0) AS transaction_hotels_trans_avg_cnt_1m_to_3m, 
    transaction_hotels_trans_avg_sum_3m / NULLIF (transaction_hotels_trans_avg_sum_6m, 0) AS transaction_hotels_trans_avg_sum_3m_to_6m, 
    transaction_hotels_trans_avg_cnt_3m / NULLIF (transaction_hotels_trans_avg_cnt_6m, 0) AS transaction_hotels_trans_avg_cnt_3m_to_6m, 
    transaction_hotels_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_hotels_trans_avg_sum_1m_to_total_1m,
    transaction_hotels_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_hotels_trans_avg_cnt_1m_to_total_1m,
    transaction_hotels_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_hotels_trans_avg_sum_3m_to_total_3m, 
    transaction_hotels_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_hotels_trans_avg_cnt_3m_to_total_3m, 
    transaction_hotels_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_hotels_trans_avg_sum_3m_to_total_6m, 
    transaction_hotels_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_hotels_trans_avg_cnt_3m_to_total_6m, 
    transaction_hotels_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_hotels_trans_avg_sum_6m_to_total_6m, 
    transaction_hotels_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_hotels_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_12 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_60 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_courier_trans_cnt_1m / NULLIF (transaction_courier_trans_cnt_3m, 0) AS transaction_courier_trans_cnt_1m_to_3m,
    transaction_courier_trans_sum_1m / NULLIF (transaction_courier_trans_sum_3m, 0) AS transaction_courier_trans_sum_1m_to_3m,
    transaction_courier_trans_cnt_3m / NULLIF (transaction_courier_trans_cnt_6m, 0) AS transaction_courier_trans_cnt_3m_to_6m,
    transaction_courier_trans_sum_3m / NULLIF (transaction_courier_trans_sum_6m, 0) AS transaction_courier_trans_sum_3m_to_6m,
    transaction_courier_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_courier_trans_cnt_1m_to_total_1m, 
    transaction_courier_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_courier_trans_sum_1m_to_total_1m, 
    transaction_courier_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_courier_trans_cnt_3m_to_total_3m, 
    transaction_courier_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_courier_trans_sum_3m_to_total_3m,
    transaction_courier_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_courier_trans_cnt_3m_to_total_6m, 
    transaction_courier_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_courier_trans_sum_3m_to_total_6m, 
    transaction_courier_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_courier_trans_cnt_6m_to_total_6m, 
    transaction_courier_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_courier_trans_sum_6m_to_total_6m, 
    transaction_courier_trans_avg_sum_1m / NULLIF (transaction_courier_trans_avg_sum_3m, 0) AS transaction_courier_trans_avg_sum_1m_to_3m, 
    transaction_courier_trans_avg_cnt_1m / NULLIF (transaction_courier_trans_avg_cnt_3m, 0) AS transaction_courier_trans_avg_cnt_1m_to_3m, 
    transaction_courier_trans_avg_sum_3m / NULLIF (transaction_courier_trans_avg_sum_6m, 0) AS transaction_courier_trans_avg_sum_3m_to_6m, 
    transaction_courier_trans_avg_cnt_3m / NULLIF (transaction_courier_trans_avg_cnt_6m, 0) AS transaction_courier_trans_avg_cnt_3m_to_6m, 
    transaction_courier_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_courier_trans_avg_sum_1m_to_total_1m,
    transaction_courier_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_courier_trans_avg_cnt_1m_to_total_1m,
    transaction_courier_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_courier_trans_avg_sum_3m_to_total_3m, 
    transaction_courier_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_courier_trans_avg_cnt_3m_to_total_3m, 
    transaction_courier_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_courier_trans_avg_sum_3m_to_total_6m, 
    transaction_courier_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_courier_trans_avg_cnt_3m_to_total_6m, 
    transaction_courier_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_courier_trans_avg_sum_6m_to_total_6m, 
    transaction_courier_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_courier_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_13 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_61 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_souvenirs_trans_cnt_1m / NULLIF (transaction_souvenirs_trans_cnt_3m, 0) AS transaction_souvenirs_trans_cnt_1m_to_3m,
    transaction_souvenirs_trans_sum_1m / NULLIF (transaction_souvenirs_trans_sum_3m, 0) AS transaction_souvenirs_trans_sum_1m_to_3m,
    transaction_souvenirs_trans_cnt_3m / NULLIF (transaction_souvenirs_trans_cnt_6m, 0) AS transaction_souvenirs_trans_cnt_3m_to_6m,
    transaction_souvenirs_trans_sum_3m / NULLIF (transaction_souvenirs_trans_sum_6m, 0) AS transaction_souvenirs_trans_sum_3m_to_6m,
    transaction_souvenirs_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_souvenirs_trans_cnt_1m_to_total_1m, 
    transaction_souvenirs_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_souvenirs_trans_sum_1m_to_total_1m, 
    transaction_souvenirs_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_souvenirs_trans_cnt_3m_to_total_3m, 
    transaction_souvenirs_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_souvenirs_trans_sum_3m_to_total_3m,
    transaction_souvenirs_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_souvenirs_trans_cnt_3m_to_total_6m, 
    transaction_souvenirs_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_souvenirs_trans_sum_3m_to_total_6m, 
    transaction_souvenirs_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_souvenirs_trans_cnt_6m_to_total_6m, 
    transaction_souvenirs_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_souvenirs_trans_sum_6m_to_total_6m, 
    transaction_souvenirs_trans_avg_sum_1m / NULLIF (transaction_souvenirs_trans_avg_sum_3m, 0) AS transaction_souvenirs_trans_avg_sum_1m_to_3m, 
    transaction_souvenirs_trans_avg_cnt_1m / NULLIF (transaction_souvenirs_trans_avg_cnt_3m, 0) AS transaction_souvenirs_trans_avg_cnt_1m_to_3m, 
    transaction_souvenirs_trans_avg_sum_3m / NULLIF (transaction_souvenirs_trans_avg_sum_6m, 0) AS transaction_souvenirs_trans_avg_sum_3m_to_6m, 
    transaction_souvenirs_trans_avg_cnt_3m / NULLIF (transaction_souvenirs_trans_avg_cnt_6m, 0) AS transaction_souvenirs_trans_avg_cnt_3m_to_6m, 
    transaction_souvenirs_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_souvenirs_trans_avg_sum_1m_to_total_1m,
    transaction_souvenirs_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_souvenirs_trans_avg_cnt_1m_to_total_1m,
    transaction_souvenirs_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_souvenirs_trans_avg_sum_3m_to_total_3m, 
    transaction_souvenirs_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_souvenirs_trans_avg_cnt_3m_to_total_3m, 
    transaction_souvenirs_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_souvenirs_trans_avg_sum_3m_to_total_6m, 
    transaction_souvenirs_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_souvenirs_trans_avg_cnt_3m_to_total_6m, 
    transaction_souvenirs_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_souvenirs_trans_avg_sum_6m_to_total_6m, 
    transaction_souvenirs_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_souvenirs_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_14 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_62 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_card_transfer_trans_cnt_1m / NULLIF (transaction_card_transfer_trans_cnt_3m, 0) AS transaction_card_transfer_trans_cnt_1m_to_3m,
    transaction_card_transfer_trans_sum_1m / NULLIF (transaction_card_transfer_trans_sum_3m, 0) AS transaction_card_transfer_trans_sum_1m_to_3m,
    transaction_card_transfer_trans_cnt_3m / NULLIF (transaction_card_transfer_trans_cnt_6m, 0) AS transaction_card_transfer_trans_cnt_3m_to_6m,
    transaction_card_transfer_trans_sum_3m / NULLIF (transaction_card_transfer_trans_sum_6m, 0) AS transaction_card_transfer_trans_sum_3m_to_6m,
    transaction_card_transfer_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_card_transfer_trans_cnt_1m_to_total_1m, 
    transaction_card_transfer_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_card_transfer_trans_sum_1m_to_total_1m, 
    transaction_card_transfer_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_card_transfer_trans_cnt_3m_to_total_3m, 
    transaction_card_transfer_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_card_transfer_trans_sum_3m_to_total_3m,
    transaction_card_transfer_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_card_transfer_trans_cnt_3m_to_total_6m, 
    transaction_card_transfer_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_card_transfer_trans_sum_3m_to_total_6m, 
    transaction_card_transfer_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_card_transfer_trans_cnt_6m_to_total_6m, 
    transaction_card_transfer_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_card_transfer_trans_sum_6m_to_total_6m, 
    transaction_card_transfer_trans_avg_sum_1m / NULLIF (transaction_card_transfer_trans_avg_sum_3m, 0) AS transaction_card_transfer_trans_avg_sum_1m_to_3m, 
    transaction_card_transfer_trans_avg_cnt_1m / NULLIF (transaction_card_transfer_trans_avg_cnt_3m, 0) AS transaction_card_transfer_trans_avg_cnt_1m_to_3m, 
    transaction_card_transfer_trans_avg_sum_3m / NULLIF (transaction_card_transfer_trans_avg_sum_6m, 0) AS transaction_card_transfer_trans_avg_sum_3m_to_6m, 
    transaction_card_transfer_trans_avg_cnt_3m / NULLIF (transaction_card_transfer_trans_avg_cnt_6m, 0) AS transaction_card_transfer_trans_avg_cnt_3m_to_6m, 
    transaction_card_transfer_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_card_transfer_trans_avg_sum_1m_to_total_1m,
    transaction_card_transfer_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_card_transfer_trans_avg_cnt_1m_to_total_1m,
    transaction_card_transfer_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_card_transfer_trans_avg_sum_3m_to_total_3m, 
    transaction_card_transfer_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_card_transfer_trans_avg_cnt_3m_to_total_3m, 
    transaction_card_transfer_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_card_transfer_trans_avg_sum_3m_to_total_6m, 
    transaction_card_transfer_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_card_transfer_trans_avg_cnt_3m_to_total_6m, 
    transaction_card_transfer_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_card_transfer_trans_avg_sum_6m_to_total_6m, 
    transaction_card_transfer_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_card_transfer_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_15 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_63 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_fun_trans_cnt_1m / NULLIF (transaction_fun_trans_cnt_3m, 0) AS transaction_fun_trans_cnt_1m_to_3m,
    transaction_fun_trans_sum_1m / NULLIF (transaction_fun_trans_sum_3m, 0) AS transaction_fun_trans_sum_1m_to_3m,
    transaction_fun_trans_cnt_3m / NULLIF (transaction_fun_trans_cnt_6m, 0) AS transaction_fun_trans_cnt_3m_to_6m,
    transaction_fun_trans_sum_3m / NULLIF (transaction_fun_trans_sum_6m, 0) AS transaction_fun_trans_sum_3m_to_6m,
    transaction_fun_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_fun_trans_cnt_1m_to_total_1m, 
    transaction_fun_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_fun_trans_sum_1m_to_total_1m, 
    transaction_fun_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_fun_trans_cnt_3m_to_total_3m, 
    transaction_fun_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_fun_trans_sum_3m_to_total_3m,
    transaction_fun_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fun_trans_cnt_3m_to_total_6m, 
    transaction_fun_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fun_trans_sum_3m_to_total_6m, 
    transaction_fun_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fun_trans_cnt_6m_to_total_6m, 
    transaction_fun_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fun_trans_sum_6m_to_total_6m, 
    transaction_fun_trans_avg_sum_1m / NULLIF (transaction_fun_trans_avg_sum_3m, 0) AS transaction_fun_trans_avg_sum_1m_to_3m, 
    transaction_fun_trans_avg_cnt_1m / NULLIF (transaction_fun_trans_avg_cnt_3m, 0) AS transaction_fun_trans_avg_cnt_1m_to_3m, 
    transaction_fun_trans_avg_sum_3m / NULLIF (transaction_fun_trans_avg_sum_6m, 0) AS transaction_fun_trans_avg_sum_3m_to_6m, 
    transaction_fun_trans_avg_cnt_3m / NULLIF (transaction_fun_trans_avg_cnt_6m, 0) AS transaction_fun_trans_avg_cnt_3m_to_6m, 
    transaction_fun_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_fun_trans_avg_sum_1m_to_total_1m,
    transaction_fun_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_fun_trans_avg_cnt_1m_to_total_1m,
    transaction_fun_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_fun_trans_avg_sum_3m_to_total_3m, 
    transaction_fun_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_fun_trans_avg_cnt_3m_to_total_3m, 
    transaction_fun_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fun_trans_avg_sum_3m_to_total_6m, 
    transaction_fun_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fun_trans_avg_cnt_3m_to_total_6m, 
    transaction_fun_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fun_trans_avg_sum_6m_to_total_6m, 
    transaction_fun_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fun_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_16 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_64 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_taxes_fines_trans_cnt_1m / NULLIF (transaction_taxes_fines_trans_cnt_3m, 0) AS transaction_taxes_fines_trans_cnt_1m_to_3m,
    transaction_taxes_fines_trans_sum_1m / NULLIF (transaction_taxes_fines_trans_sum_3m, 0) AS transaction_taxes_fines_trans_sum_1m_to_3m,
    transaction_taxes_fines_trans_cnt_3m / NULLIF (transaction_taxes_fines_trans_cnt_6m, 0) AS transaction_taxes_fines_trans_cnt_3m_to_6m,
    transaction_taxes_fines_trans_sum_3m / NULLIF (transaction_taxes_fines_trans_sum_6m, 0) AS transaction_taxes_fines_trans_sum_3m_to_6m,
    transaction_taxes_fines_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_taxes_fines_trans_cnt_1m_to_total_1m, 
    transaction_taxes_fines_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_taxes_fines_trans_sum_1m_to_total_1m, 
    transaction_taxes_fines_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_taxes_fines_trans_cnt_3m_to_total_3m, 
    transaction_taxes_fines_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_taxes_fines_trans_sum_3m_to_total_3m,
    transaction_taxes_fines_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_taxes_fines_trans_cnt_3m_to_total_6m, 
    transaction_taxes_fines_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_taxes_fines_trans_sum_3m_to_total_6m, 
    transaction_taxes_fines_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_taxes_fines_trans_cnt_6m_to_total_6m, 
    transaction_taxes_fines_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_taxes_fines_trans_sum_6m_to_total_6m, 
    transaction_taxes_fines_trans_avg_sum_1m / NULLIF (transaction_taxes_fines_trans_avg_sum_3m, 0) AS transaction_taxes_fines_trans_avg_sum_1m_to_3m, 
    transaction_taxes_fines_trans_avg_cnt_1m / NULLIF (transaction_taxes_fines_trans_avg_cnt_3m, 0) AS transaction_taxes_fines_trans_avg_cnt_1m_to_3m, 
    transaction_taxes_fines_trans_avg_sum_3m / NULLIF (transaction_taxes_fines_trans_avg_sum_6m, 0) AS transaction_taxes_fines_trans_avg_sum_3m_to_6m, 
    transaction_taxes_fines_trans_avg_cnt_3m / NULLIF (transaction_taxes_fines_trans_avg_cnt_6m, 0) AS transaction_taxes_fines_trans_avg_cnt_3m_to_6m, 
    transaction_taxes_fines_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_taxes_fines_trans_avg_sum_1m_to_total_1m,
    transaction_taxes_fines_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_taxes_fines_trans_avg_cnt_1m_to_total_1m,
    transaction_taxes_fines_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_taxes_fines_trans_avg_sum_3m_to_total_3m, 
    transaction_taxes_fines_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_taxes_fines_trans_avg_cnt_3m_to_total_3m, 
    transaction_taxes_fines_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_taxes_fines_trans_avg_sum_3m_to_total_6m, 
    transaction_taxes_fines_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_taxes_fines_trans_avg_cnt_3m_to_total_6m, 
    transaction_taxes_fines_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_taxes_fines_trans_avg_sum_6m_to_total_6m, 
    transaction_taxes_fines_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_taxes_fines_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_17 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_65 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_supermarkets_trans_cnt_1m / NULLIF (transaction_supermarkets_trans_cnt_3m, 0) AS transaction_supermarkets_trans_cnt_1m_to_3m,
    transaction_supermarkets_trans_sum_1m / NULLIF (transaction_supermarkets_trans_sum_3m, 0) AS transaction_supermarkets_trans_sum_1m_to_3m,
    transaction_supermarkets_trans_cnt_3m / NULLIF (transaction_supermarkets_trans_cnt_6m, 0) AS transaction_supermarkets_trans_cnt_3m_to_6m,
    transaction_supermarkets_trans_sum_3m / NULLIF (transaction_supermarkets_trans_sum_6m, 0) AS transaction_supermarkets_trans_sum_3m_to_6m,
    transaction_supermarkets_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_supermarkets_trans_cnt_1m_to_total_1m, 
    transaction_supermarkets_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_supermarkets_trans_sum_1m_to_total_1m, 
    transaction_supermarkets_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_supermarkets_trans_cnt_3m_to_total_3m, 
    transaction_supermarkets_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_supermarkets_trans_sum_3m_to_total_3m,
    transaction_supermarkets_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_supermarkets_trans_cnt_3m_to_total_6m, 
    transaction_supermarkets_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_supermarkets_trans_sum_3m_to_total_6m, 
    transaction_supermarkets_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_supermarkets_trans_cnt_6m_to_total_6m, 
    transaction_supermarkets_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_supermarkets_trans_sum_6m_to_total_6m, 
    transaction_supermarkets_trans_cnt_12m / NULLIF (transaction_total_trans_cnt_12m, 0) AS transaction_supermarkets_trans_cnt_12m_to_total_12m,
    transaction_supermarkets_trans_avg_sum_1m / NULLIF (transaction_supermarkets_trans_avg_sum_3m, 0) AS transaction_supermarkets_trans_avg_sum_1m_to_3m, 
    transaction_supermarkets_trans_avg_cnt_1m / NULLIF (transaction_supermarkets_trans_avg_cnt_3m, 0) AS transaction_supermarkets_trans_avg_cnt_1m_to_3m, 
    transaction_supermarkets_trans_avg_sum_3m / NULLIF (transaction_supermarkets_trans_avg_sum_6m, 0) AS transaction_supermarkets_trans_avg_sum_3m_to_6m, 
    transaction_supermarkets_trans_avg_cnt_3m / NULLIF (transaction_supermarkets_trans_avg_cnt_6m, 0) AS transaction_supermarkets_trans_avg_cnt_3m_to_6m, 
    transaction_supermarkets_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_supermarkets_trans_avg_sum_1m_to_total_1m,
    transaction_supermarkets_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_supermarkets_trans_avg_cnt_1m_to_total_1m,
    transaction_supermarkets_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_supermarkets_trans_avg_sum_3m_to_total_3m, 
    transaction_supermarkets_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_supermarkets_trans_avg_cnt_3m_to_total_3m, 
    transaction_supermarkets_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_supermarkets_trans_avg_sum_3m_to_total_6m, 
    transaction_supermarkets_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_supermarkets_trans_avg_cnt_3m_to_total_6m, 
    transaction_supermarkets_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_supermarkets_trans_avg_sum_6m_to_total_6m, 
    transaction_supermarkets_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_supermarkets_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_18 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_66 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_sport_trans_cnt_1m / NULLIF (transaction_sport_trans_cnt_3m, 0) AS transaction_sport_trans_cnt_1m_to_3m,
    transaction_sport_trans_sum_1m / NULLIF (transaction_sport_trans_sum_3m, 0) AS transaction_sport_trans_sum_1m_to_3m,
    transaction_sport_trans_cnt_3m / NULLIF (transaction_sport_trans_cnt_6m, 0) AS transaction_sport_trans_cnt_3m_to_6m,
    transaction_sport_trans_sum_3m / NULLIF (transaction_sport_trans_sum_6m, 0) AS transaction_sport_trans_sum_3m_to_6m,
    transaction_sport_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_sport_trans_cnt_1m_to_total_1m, 
    transaction_sport_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_sport_trans_sum_1m_to_total_1m, 
    transaction_sport_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_sport_trans_cnt_3m_to_total_3m, 
    transaction_sport_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_sport_trans_sum_3m_to_total_3m,
    transaction_sport_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_sport_trans_cnt_3m_to_total_6m, 
    transaction_sport_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_sport_trans_sum_3m_to_total_6m, 
    transaction_sport_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_sport_trans_cnt_6m_to_total_6m, 
    transaction_sport_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_sport_trans_sum_6m_to_total_6m, 
    transaction_sport_trans_avg_sum_1m / NULLIF (transaction_sport_trans_avg_sum_3m, 0) AS transaction_sport_trans_avg_sum_1m_to_3m, 
    transaction_sport_trans_avg_cnt_1m / NULLIF (transaction_sport_trans_avg_cnt_3m, 0) AS transaction_sport_trans_avg_cnt_1m_to_3m, 
    transaction_sport_trans_avg_sum_3m / NULLIF (transaction_sport_trans_avg_sum_6m, 0) AS transaction_sport_trans_avg_sum_3m_to_6m, 
    transaction_sport_trans_avg_cnt_3m / NULLIF (transaction_sport_trans_avg_cnt_6m, 0) AS transaction_sport_trans_avg_cnt_3m_to_6m, 
    transaction_sport_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_sport_trans_avg_sum_1m_to_total_1m,
    transaction_sport_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_sport_trans_avg_cnt_1m_to_total_1m,
    transaction_sport_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_sport_trans_avg_sum_3m_to_total_3m, 
    transaction_sport_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_sport_trans_avg_cnt_3m_to_total_3m, 
    transaction_sport_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_sport_trans_avg_sum_3m_to_total_6m, 
    transaction_sport_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_sport_trans_avg_cnt_3m_to_total_6m, 
    transaction_sport_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_sport_trans_avg_sum_6m_to_total_6m, 
    transaction_sport_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_sport_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_19 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_67 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_sber_trans_cnt_1m / NULLIF (transaction_sber_trans_cnt_3m, 0) AS transaction_sber_trans_cnt_1m_to_3m,
    transaction_sber_trans_sum_1m / NULLIF (transaction_sber_trans_sum_3m, 0) AS transaction_sber_trans_sum_1m_to_3m,
    transaction_sber_trans_cnt_3m / NULLIF (transaction_sber_trans_cnt_6m, 0) AS transaction_sber_trans_cnt_3m_to_6m,
    transaction_sber_trans_sum_3m / NULLIF (transaction_sber_trans_sum_6m, 0) AS transaction_sber_trans_sum_3m_to_6m,
    transaction_sber_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_sber_trans_cnt_1m_to_total_1m, 
    transaction_sber_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_sber_trans_sum_1m_to_total_1m, 
    transaction_sber_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_sber_trans_cnt_3m_to_total_3m, 
    transaction_sber_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_sber_trans_sum_3m_to_total_3m,
    transaction_sber_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_sber_trans_cnt_3m_to_total_6m, 
    transaction_sber_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_sber_trans_sum_3m_to_total_6m, 
    transaction_sber_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_sber_trans_cnt_6m_to_total_6m, 
    transaction_sber_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_sber_trans_sum_6m_to_total_6m, 
    transaction_sber_trans_avg_sum_1m / NULLIF (transaction_sber_trans_avg_sum_3m, 0) AS transaction_sber_trans_avg_sum_1m_to_3m, 
    transaction_sber_trans_avg_cnt_1m / NULLIF (transaction_sber_trans_avg_cnt_3m, 0) AS transaction_sber_trans_avg_cnt_1m_to_3m, 
    transaction_sber_trans_avg_sum_3m / NULLIF (transaction_sber_trans_avg_sum_6m, 0) AS transaction_sber_trans_avg_sum_3m_to_6m, 
    transaction_sber_trans_avg_cnt_3m / NULLIF (transaction_sber_trans_avg_cnt_6m, 0) AS transaction_sber_trans_avg_cnt_3m_to_6m, 
    transaction_sber_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_sber_trans_avg_sum_1m_to_total_1m,
    transaction_sber_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_sber_trans_avg_cnt_1m_to_total_1m,
    transaction_sber_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_sber_trans_avg_sum_3m_to_total_3m, 
    transaction_sber_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_sber_trans_avg_cnt_3m_to_total_3m, 
    transaction_sber_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_sber_trans_avg_sum_3m_to_total_6m, 
    transaction_sber_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_sber_trans_avg_cnt_3m_to_total_6m, 
    transaction_sber_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_sber_trans_avg_sum_6m_to_total_6m, 
    transaction_sber_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_sber_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_20 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_68 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_gosuslugi_trans_cnt_1m / NULLIF (transaction_gosuslugi_trans_cnt_3m, 0) AS transaction_gosuslugi_trans_cnt_1m_to_3m,
    transaction_gosuslugi_trans_sum_1m / NULLIF (transaction_gosuslugi_trans_sum_3m, 0) AS transaction_gosuslugi_trans_sum_1m_to_3m,
    transaction_gosuslugi_trans_cnt_3m / NULLIF (transaction_gosuslugi_trans_cnt_6m, 0) AS transaction_gosuslugi_trans_cnt_3m_to_6m,
    transaction_gosuslugi_trans_sum_3m / NULLIF (transaction_gosuslugi_trans_sum_6m, 0) AS transaction_gosuslugi_trans_sum_3m_to_6m,
    transaction_gosuslugi_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_gosuslugi_trans_cnt_1m_to_total_1m, 
    transaction_gosuslugi_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_gosuslugi_trans_sum_1m_to_total_1m, 
    transaction_gosuslugi_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_gosuslugi_trans_cnt_3m_to_total_3m, 
    transaction_gosuslugi_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_gosuslugi_trans_sum_3m_to_total_3m,
    transaction_gosuslugi_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_gosuslugi_trans_cnt_3m_to_total_6m, 
    transaction_gosuslugi_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_gosuslugi_trans_sum_3m_to_total_6m, 
    transaction_gosuslugi_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_gosuslugi_trans_cnt_6m_to_total_6m, 
    transaction_gosuslugi_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_gosuslugi_trans_sum_6m_to_total_6m, 
    transaction_gosuslugi_trans_avg_sum_1m / NULLIF (transaction_gosuslugi_trans_avg_sum_3m, 0) AS transaction_gosuslugi_trans_avg_sum_1m_to_3m, 
    transaction_gosuslugi_trans_avg_cnt_1m / NULLIF (transaction_gosuslugi_trans_avg_cnt_3m, 0) AS transaction_gosuslugi_trans_avg_cnt_1m_to_3m, 
    transaction_gosuslugi_trans_avg_sum_3m / NULLIF (transaction_gosuslugi_trans_avg_sum_6m, 0) AS transaction_gosuslugi_trans_avg_sum_3m_to_6m, 
    transaction_gosuslugi_trans_avg_cnt_3m / NULLIF (transaction_gosuslugi_trans_avg_cnt_6m, 0) AS transaction_gosuslugi_trans_avg_cnt_3m_to_6m, 
    transaction_gosuslugi_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_gosuslugi_trans_avg_sum_1m_to_total_1m,
    transaction_gosuslugi_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_gosuslugi_trans_avg_cnt_1m_to_total_1m,
    transaction_gosuslugi_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_gosuslugi_trans_avg_sum_3m_to_total_3m, 
    transaction_gosuslugi_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_gosuslugi_trans_avg_cnt_3m_to_total_3m, 
    transaction_gosuslugi_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_gosuslugi_trans_avg_sum_3m_to_total_6m, 
    transaction_gosuslugi_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_gosuslugi_trans_avg_cnt_3m_to_total_6m, 
    transaction_gosuslugi_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_gosuslugi_trans_avg_sum_6m_to_total_6m, 
    transaction_gosuslugi_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_gosuslugi_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_21 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_69 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_art_trans_cnt_1m / NULLIF (transaction_art_trans_cnt_3m, 0) AS transaction_art_trans_cnt_1m_to_3m,
    transaction_art_trans_sum_1m / NULLIF (transaction_art_trans_sum_3m, 0) AS transaction_art_trans_sum_1m_to_3m,
    transaction_art_trans_cnt_3m / NULLIF (transaction_art_trans_cnt_6m, 0) AS transaction_art_trans_cnt_3m_to_6m,
    transaction_art_trans_sum_3m / NULLIF (transaction_art_trans_sum_6m, 0) AS transaction_art_trans_sum_3m_to_6m,
    transaction_art_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_art_trans_cnt_1m_to_total_1m, 
    transaction_art_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_art_trans_sum_1m_to_total_1m, 
    transaction_art_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_art_trans_cnt_3m_to_total_3m, 
    transaction_art_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_art_trans_sum_3m_to_total_3m,
    transaction_art_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_art_trans_cnt_3m_to_total_6m, 
    transaction_art_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_art_trans_sum_3m_to_total_6m, 
    transaction_art_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_art_trans_cnt_6m_to_total_6m, 
    transaction_art_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_art_trans_sum_6m_to_total_6m, 
    transaction_art_trans_avg_sum_1m / NULLIF (transaction_art_trans_avg_sum_3m, 0) AS transaction_art_trans_avg_sum_1m_to_3m, 
    transaction_art_trans_avg_cnt_1m / NULLIF (transaction_art_trans_avg_cnt_3m, 0) AS transaction_art_trans_avg_cnt_1m_to_3m, 
    transaction_art_trans_avg_sum_3m / NULLIF (transaction_art_trans_avg_sum_6m, 0) AS transaction_art_trans_avg_sum_3m_to_6m, 
    transaction_art_trans_avg_cnt_3m / NULLIF (transaction_art_trans_avg_cnt_6m, 0) AS transaction_art_trans_avg_cnt_3m_to_6m, 
    transaction_art_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_art_trans_avg_sum_1m_to_total_1m,
    transaction_art_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_art_trans_avg_cnt_1m_to_total_1m,
    transaction_art_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_art_trans_avg_sum_3m_to_total_3m, 
    transaction_art_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_art_trans_avg_cnt_3m_to_total_3m, 
    transaction_art_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_art_trans_avg_sum_3m_to_total_6m, 
    transaction_art_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_art_trans_avg_cnt_3m_to_total_6m, 
    transaction_art_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_art_trans_avg_sum_6m_to_total_6m, 
    transaction_art_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_art_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_22 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_70 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_pharmacies_trans_cnt_1m / NULLIF (transaction_pharmacies_trans_cnt_3m, 0) AS transaction_pharmacies_trans_cnt_1m_to_3m,
    transaction_pharmacies_trans_sum_1m / NULLIF (transaction_pharmacies_trans_sum_3m, 0) AS transaction_pharmacies_trans_sum_1m_to_3m,
    transaction_pharmacies_trans_cnt_3m / NULLIF (transaction_pharmacies_trans_cnt_6m, 0) AS transaction_pharmacies_trans_cnt_3m_to_6m,
    transaction_pharmacies_trans_sum_3m / NULLIF (transaction_pharmacies_trans_sum_6m, 0) AS transaction_pharmacies_trans_sum_3m_to_6m,
    transaction_pharmacies_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_pharmacies_trans_cnt_1m_to_total_1m, 
    transaction_pharmacies_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_pharmacies_trans_sum_1m_to_total_1m, 
    transaction_pharmacies_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_pharmacies_trans_cnt_3m_to_total_3m, 
    transaction_pharmacies_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_pharmacies_trans_sum_3m_to_total_3m,
    transaction_pharmacies_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_pharmacies_trans_cnt_3m_to_total_6m, 
    transaction_pharmacies_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_pharmacies_trans_sum_3m_to_total_6m, 
    transaction_pharmacies_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_pharmacies_trans_cnt_6m_to_total_6m, 
    transaction_pharmacies_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_pharmacies_trans_sum_6m_to_total_6m, 
    transaction_pharmacies_trans_avg_sum_1m / NULLIF (transaction_pharmacies_trans_avg_sum_3m, 0) AS transaction_pharmacies_trans_avg_sum_1m_to_3m, 
    transaction_pharmacies_trans_avg_cnt_1m / NULLIF (transaction_pharmacies_trans_avg_cnt_3m, 0) AS transaction_pharmacies_trans_avg_cnt_1m_to_3m, 
    transaction_pharmacies_trans_avg_sum_3m / NULLIF (transaction_pharmacies_trans_avg_sum_6m, 0) AS transaction_pharmacies_trans_avg_sum_3m_to_6m, 
    transaction_pharmacies_trans_avg_cnt_3m / NULLIF (transaction_pharmacies_trans_avg_cnt_6m, 0) AS transaction_pharmacies_trans_avg_cnt_3m_to_6m, 
    transaction_pharmacies_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_pharmacies_trans_avg_sum_1m_to_total_1m,
    transaction_pharmacies_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_pharmacies_trans_avg_cnt_1m_to_total_1m,
    transaction_pharmacies_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_pharmacies_trans_avg_sum_3m_to_total_3m, 
    transaction_pharmacies_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_pharmacies_trans_avg_cnt_3m_to_total_3m, 
    transaction_pharmacies_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_pharmacies_trans_avg_sum_3m_to_total_6m, 
    transaction_pharmacies_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_pharmacies_trans_avg_cnt_3m_to_total_6m, 
    transaction_pharmacies_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_pharmacies_trans_avg_sum_6m_to_total_6m, 
    transaction_pharmacies_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_pharmacies_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_23 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_71 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_flowers_trans_cnt_1m / NULLIF (transaction_flowers_trans_cnt_3m, 0) AS transaction_flowers_trans_cnt_1m_to_3m,
    transaction_flowers_trans_sum_1m / NULLIF (transaction_flowers_trans_sum_3m, 0) AS transaction_flowers_trans_sum_1m_to_3m,
    transaction_flowers_trans_cnt_3m / NULLIF (transaction_flowers_trans_cnt_6m, 0) AS transaction_flowers_trans_cnt_3m_to_6m,
    transaction_flowers_trans_sum_3m / NULLIF (transaction_flowers_trans_sum_6m, 0) AS transaction_flowers_trans_sum_3m_to_6m,
    transaction_flowers_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_flowers_trans_cnt_1m_to_total_1m, 
    transaction_flowers_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_flowers_trans_sum_1m_to_total_1m, 
    transaction_flowers_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_flowers_trans_cnt_3m_to_total_3m, 
    transaction_flowers_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_flowers_trans_sum_3m_to_total_3m,
    transaction_flowers_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_flowers_trans_cnt_3m_to_total_6m, 
    transaction_flowers_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_flowers_trans_sum_3m_to_total_6m, 
    transaction_flowers_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_flowers_trans_cnt_6m_to_total_6m, 
    transaction_flowers_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_flowers_trans_sum_6m_to_total_6m, 
    transaction_flowers_trans_avg_sum_1m / NULLIF (transaction_flowers_trans_avg_sum_3m, 0) AS transaction_flowers_trans_avg_sum_1m_to_3m, 
    transaction_flowers_trans_avg_cnt_1m / NULLIF (transaction_flowers_trans_avg_cnt_3m, 0) AS transaction_flowers_trans_avg_cnt_1m_to_3m, 
    transaction_flowers_trans_avg_sum_3m / NULLIF (transaction_flowers_trans_avg_sum_6m, 0) AS transaction_flowers_trans_avg_sum_3m_to_6m, 
    transaction_flowers_trans_avg_cnt_3m / NULLIF (transaction_flowers_trans_avg_cnt_6m, 0) AS transaction_flowers_trans_avg_cnt_3m_to_6m, 
    transaction_flowers_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_flowers_trans_avg_sum_1m_to_total_1m,
    transaction_flowers_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_flowers_trans_avg_cnt_1m_to_total_1m,
    transaction_flowers_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_flowers_trans_avg_sum_3m_to_total_3m, 
    transaction_flowers_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_flowers_trans_avg_cnt_3m_to_total_3m, 
    transaction_flowers_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_flowers_trans_avg_sum_3m_to_total_6m, 
    transaction_flowers_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_flowers_trans_avg_cnt_3m_to_total_6m, 
    transaction_flowers_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_flowers_trans_avg_sum_6m_to_total_6m, 
    transaction_flowers_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_flowers_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_24 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_72 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_train_trans_cnt_1m / NULLIF (transaction_train_trans_cnt_3m, 0) AS transaction_train_trans_cnt_1m_to_3m,
    transaction_train_trans_sum_1m / NULLIF (transaction_train_trans_sum_3m, 0) AS transaction_train_trans_sum_1m_to_3m,
    transaction_train_trans_cnt_3m / NULLIF (transaction_train_trans_cnt_6m, 0) AS transaction_train_trans_cnt_3m_to_6m,
    transaction_train_trans_sum_3m / NULLIF (transaction_train_trans_sum_6m, 0) AS transaction_train_trans_sum_3m_to_6m,
    transaction_train_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_train_trans_cnt_1m_to_total_1m, 
    transaction_train_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_train_trans_sum_1m_to_total_1m, 
    transaction_train_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_train_trans_cnt_3m_to_total_3m, 
    transaction_train_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_train_trans_sum_3m_to_total_3m,
    transaction_train_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_train_trans_cnt_3m_to_total_6m, 
    transaction_train_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_train_trans_sum_3m_to_total_6m, 
    transaction_train_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_train_trans_cnt_6m_to_total_6m, 
    transaction_train_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_train_trans_sum_6m_to_total_6m, 
    transaction_train_trans_avg_sum_1m / NULLIF (transaction_train_trans_avg_sum_3m, 0) AS transaction_train_trans_avg_sum_1m_to_3m, 
    transaction_train_trans_avg_cnt_1m / NULLIF (transaction_train_trans_avg_cnt_3m, 0) AS transaction_train_trans_avg_cnt_1m_to_3m, 
    transaction_train_trans_avg_sum_3m / NULLIF (transaction_train_trans_avg_sum_6m, 0) AS transaction_train_trans_avg_sum_3m_to_6m, 
    transaction_train_trans_avg_cnt_3m / NULLIF (transaction_train_trans_avg_cnt_6m, 0) AS transaction_train_trans_avg_cnt_3m_to_6m, 
    transaction_train_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_train_trans_avg_sum_1m_to_total_1m,
    transaction_train_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_train_trans_avg_cnt_1m_to_total_1m,
    transaction_train_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_train_trans_avg_sum_3m_to_total_3m, 
    transaction_train_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_train_trans_avg_cnt_3m_to_total_3m, 
    transaction_train_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_train_trans_avg_sum_3m_to_total_6m, 
    transaction_train_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_train_trans_avg_cnt_3m_to_total_6m, 
    transaction_train_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_train_trans_avg_sum_6m_to_total_6m, 
    transaction_train_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_train_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_25 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_73 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_gambling_trans_cnt_1m / NULLIF (transaction_gambling_trans_cnt_3m, 0) AS transaction_gambling_trans_cnt_1m_to_3m,
    transaction_gambling_trans_sum_1m / NULLIF (transaction_gambling_trans_sum_3m, 0) AS transaction_gambling_trans_sum_1m_to_3m,
    transaction_gambling_trans_cnt_3m / NULLIF (transaction_gambling_trans_cnt_6m, 0) AS transaction_gambling_trans_cnt_3m_to_6m,
    transaction_gambling_trans_sum_3m / NULLIF (transaction_gambling_trans_sum_6m, 0) AS transaction_gambling_trans_sum_3m_to_6m,
    transaction_gambling_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_gambling_trans_cnt_1m_to_total_1m, 
    transaction_gambling_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_gambling_trans_sum_1m_to_total_1m, 
    transaction_gambling_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_gambling_trans_cnt_3m_to_total_3m, 
    transaction_gambling_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_gambling_trans_sum_3m_to_total_3m,
    transaction_gambling_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_gambling_trans_cnt_3m_to_total_6m, 
    transaction_gambling_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_gambling_trans_sum_3m_to_total_6m, 
    transaction_gambling_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_gambling_trans_cnt_6m_to_total_6m, 
    transaction_gambling_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_gambling_trans_sum_6m_to_total_6m, 
    transaction_gambling_trans_avg_sum_1m / NULLIF (transaction_gambling_trans_avg_sum_3m, 0) AS transaction_gambling_trans_avg_sum_1m_to_3m, 
    transaction_gambling_trans_avg_cnt_1m / NULLIF (transaction_gambling_trans_avg_cnt_3m, 0) AS transaction_gambling_trans_avg_cnt_1m_to_3m, 
    transaction_gambling_trans_avg_sum_3m / NULLIF (transaction_gambling_trans_avg_sum_6m, 0) AS transaction_gambling_trans_avg_sum_3m_to_6m, 
    transaction_gambling_trans_avg_cnt_3m / NULLIF (transaction_gambling_trans_avg_cnt_6m, 0) AS transaction_gambling_trans_avg_cnt_3m_to_6m, 
    transaction_gambling_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_gambling_trans_avg_sum_1m_to_total_1m,
    transaction_gambling_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_gambling_trans_avg_cnt_1m_to_total_1m,
    transaction_gambling_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_gambling_trans_avg_sum_3m_to_total_3m, 
    transaction_gambling_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_gambling_trans_avg_cnt_3m_to_total_3m, 
    transaction_gambling_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_gambling_trans_avg_sum_3m_to_total_6m, 
    transaction_gambling_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_gambling_trans_avg_cnt_3m_to_total_6m, 
    transaction_gambling_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_gambling_trans_avg_sum_6m_to_total_6m, 
    transaction_gambling_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_gambling_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_26 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_74 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_digital_goods_trans_cnt_1m / NULLIF (transaction_digital_goods_trans_cnt_3m, 0) AS transaction_digital_goods_trans_cnt_1m_to_3m,
    transaction_digital_goods_trans_sum_1m / NULLIF (transaction_digital_goods_trans_sum_3m, 0) AS transaction_digital_goods_trans_sum_1m_to_3m,
    transaction_digital_goods_trans_cnt_3m / NULLIF (transaction_digital_goods_trans_cnt_6m, 0) AS transaction_digital_goods_trans_cnt_3m_to_6m,
    transaction_digital_goods_trans_sum_3m / NULLIF (transaction_digital_goods_trans_sum_6m, 0) AS transaction_digital_goods_trans_sum_3m_to_6m,
    transaction_digital_goods_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_digital_goods_trans_cnt_1m_to_total_1m, 
    transaction_digital_goods_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_digital_goods_trans_sum_1m_to_total_1m, 
    transaction_digital_goods_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_digital_goods_trans_cnt_3m_to_total_3m, 
    transaction_digital_goods_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_digital_goods_trans_sum_3m_to_total_3m,
    transaction_digital_goods_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_digital_goods_trans_cnt_3m_to_total_6m, 
    transaction_digital_goods_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_digital_goods_trans_sum_3m_to_total_6m, 
    transaction_digital_goods_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_digital_goods_trans_cnt_6m_to_total_6m, 
    transaction_digital_goods_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_digital_goods_trans_sum_6m_to_total_6m, 
    transaction_digital_goods_trans_avg_sum_1m / NULLIF (transaction_digital_goods_trans_avg_sum_3m, 0) AS transaction_digital_goods_trans_avg_sum_1m_to_3m, 
    transaction_digital_goods_trans_avg_cnt_1m / NULLIF (transaction_digital_goods_trans_avg_cnt_3m, 0) AS transaction_digital_goods_trans_avg_cnt_1m_to_3m, 
    transaction_digital_goods_trans_avg_sum_3m / NULLIF (transaction_digital_goods_trans_avg_sum_6m, 0) AS transaction_digital_goods_trans_avg_sum_3m_to_6m, 
    transaction_digital_goods_trans_avg_cnt_3m / NULLIF (transaction_digital_goods_trans_avg_cnt_6m, 0) AS transaction_digital_goods_trans_avg_cnt_3m_to_6m, 
    transaction_digital_goods_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_digital_goods_trans_avg_sum_1m_to_total_1m,
    transaction_digital_goods_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_digital_goods_trans_avg_cnt_1m_to_total_1m,
    transaction_digital_goods_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_digital_goods_trans_avg_sum_3m_to_total_3m, 
    transaction_digital_goods_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_digital_goods_trans_avg_cnt_3m_to_total_3m, 
    transaction_digital_goods_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_digital_goods_trans_avg_sum_3m_to_total_6m, 
    transaction_digital_goods_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_digital_goods_trans_avg_cnt_3m_to_total_6m, 
    transaction_digital_goods_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_digital_goods_trans_avg_sum_6m_to_total_6m, 
    transaction_digital_goods_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_digital_goods_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_27 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_75 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_books_trans_cnt_1m / NULLIF (transaction_books_trans_cnt_3m, 0) AS transaction_books_trans_cnt_1m_to_3m,
    transaction_books_trans_sum_1m / NULLIF (transaction_books_trans_sum_3m, 0) AS transaction_books_trans_sum_1m_to_3m,
    transaction_books_trans_cnt_3m / NULLIF (transaction_books_trans_cnt_6m, 0) AS transaction_books_trans_cnt_3m_to_6m,
    transaction_books_trans_sum_3m / NULLIF (transaction_books_trans_sum_6m, 0) AS transaction_books_trans_sum_3m_to_6m,
    transaction_books_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_books_trans_cnt_1m_to_total_1m, 
    transaction_books_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_books_trans_sum_1m_to_total_1m, 
    transaction_books_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_books_trans_cnt_3m_to_total_3m, 
    transaction_books_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_books_trans_sum_3m_to_total_3m,
    transaction_books_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_books_trans_cnt_3m_to_total_6m, 
    transaction_books_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_books_trans_sum_3m_to_total_6m, 
    transaction_books_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_books_trans_cnt_6m_to_total_6m, 
    transaction_books_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_books_trans_sum_6m_to_total_6m, 
    transaction_books_trans_avg_sum_1m / NULLIF (transaction_books_trans_avg_sum_3m, 0) AS transaction_books_trans_avg_sum_1m_to_3m, 
    transaction_books_trans_avg_cnt_1m / NULLIF (transaction_books_trans_avg_cnt_3m, 0) AS transaction_books_trans_avg_cnt_1m_to_3m, 
    transaction_books_trans_avg_sum_3m / NULLIF (transaction_books_trans_avg_sum_6m, 0) AS transaction_books_trans_avg_sum_3m_to_6m, 
    transaction_books_trans_avg_cnt_3m / NULLIF (transaction_books_trans_avg_cnt_6m, 0) AS transaction_books_trans_avg_cnt_3m_to_6m, 
    transaction_books_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_books_trans_avg_sum_1m_to_total_1m,
    transaction_books_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_books_trans_avg_cnt_1m_to_total_1m,
    transaction_books_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_books_trans_avg_sum_3m_to_total_3m, 
    transaction_books_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_books_trans_avg_cnt_3m_to_total_3m, 
    transaction_books_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_books_trans_avg_sum_3m_to_total_6m, 
    transaction_books_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_books_trans_avg_cnt_3m_to_total_6m, 
    transaction_books_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_books_trans_avg_sum_6m_to_total_6m, 
    transaction_books_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_books_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_28 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_76 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_fuel_trans_cnt_1m / NULLIF (transaction_fuel_trans_cnt_3m, 0) AS transaction_fuel_trans_cnt_1m_to_3m,
    transaction_fuel_trans_sum_1m / NULLIF (transaction_fuel_trans_sum_3m, 0) AS transaction_fuel_trans_sum_1m_to_3m,
    transaction_fuel_trans_cnt_3m / NULLIF (transaction_fuel_trans_cnt_6m, 0) AS transaction_fuel_trans_cnt_3m_to_6m,
    transaction_fuel_trans_sum_3m / NULLIF (transaction_fuel_trans_sum_6m, 0) AS transaction_fuel_trans_sum_3m_to_6m,
    transaction_fuel_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_fuel_trans_cnt_1m_to_total_1m, 
    transaction_fuel_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_fuel_trans_sum_1m_to_total_1m, 
    transaction_fuel_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_fuel_trans_cnt_3m_to_total_3m, 
    transaction_fuel_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_fuel_trans_sum_3m_to_total_3m,
    transaction_fuel_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fuel_trans_cnt_3m_to_total_6m, 
    transaction_fuel_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fuel_trans_sum_3m_to_total_6m, 
    transaction_fuel_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fuel_trans_cnt_6m_to_total_6m, 
    transaction_fuel_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fuel_trans_sum_6m_to_total_6m, 
    transaction_fuel_trans_avg_sum_1m / NULLIF (transaction_fuel_trans_avg_sum_3m, 0) AS transaction_fuel_trans_avg_sum_1m_to_3m, 
    transaction_fuel_trans_avg_cnt_1m / NULLIF (transaction_fuel_trans_avg_cnt_3m, 0) AS transaction_fuel_trans_avg_cnt_1m_to_3m, 
    transaction_fuel_trans_avg_sum_3m / NULLIF (transaction_fuel_trans_avg_sum_6m, 0) AS transaction_fuel_trans_avg_sum_3m_to_6m, 
    transaction_fuel_trans_avg_cnt_3m / NULLIF (transaction_fuel_trans_avg_cnt_6m, 0) AS transaction_fuel_trans_avg_cnt_3m_to_6m, 
    transaction_fuel_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_fuel_trans_avg_sum_1m_to_total_1m,
    transaction_fuel_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_fuel_trans_avg_cnt_1m_to_total_1m,
    transaction_fuel_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_fuel_trans_avg_sum_3m_to_total_3m, 
    transaction_fuel_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_fuel_trans_avg_cnt_3m_to_total_3m, 
    transaction_fuel_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fuel_trans_avg_sum_3m_to_total_6m, 
    transaction_fuel_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fuel_trans_avg_cnt_3m_to_total_6m, 
    transaction_fuel_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fuel_trans_avg_sum_6m_to_total_6m, 
    transaction_fuel_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fuel_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_29 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_77 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_yandex_trans_cnt_1m / NULLIF (transaction_yandex_trans_cnt_3m, 0) AS transaction_yandex_trans_cnt_1m_to_3m,
    transaction_yandex_trans_sum_1m / NULLIF (transaction_yandex_trans_sum_3m, 0) AS transaction_yandex_trans_sum_1m_to_3m,
    transaction_yandex_trans_cnt_3m / NULLIF (transaction_yandex_trans_cnt_6m, 0) AS transaction_yandex_trans_cnt_3m_to_6m,
    transaction_yandex_trans_sum_3m / NULLIF (transaction_yandex_trans_sum_6m, 0) AS transaction_yandex_trans_sum_3m_to_6m,
    transaction_yandex_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_yandex_trans_cnt_1m_to_total_1m, 
    transaction_yandex_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_yandex_trans_sum_1m_to_total_1m, 
    transaction_yandex_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_yandex_trans_cnt_3m_to_total_3m, 
    transaction_yandex_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_yandex_trans_sum_3m_to_total_3m,
    transaction_yandex_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_yandex_trans_cnt_3m_to_total_6m, 
    transaction_yandex_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_yandex_trans_sum_3m_to_total_6m, 
    transaction_yandex_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_yandex_trans_cnt_6m_to_total_6m, 
    transaction_yandex_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_yandex_trans_sum_6m_to_total_6m, 
    transaction_yandex_trans_avg_sum_1m / NULLIF (transaction_yandex_trans_avg_sum_3m, 0) AS transaction_yandex_trans_avg_sum_1m_to_3m, 
    transaction_yandex_trans_avg_cnt_1m / NULLIF (transaction_yandex_trans_avg_cnt_3m, 0) AS transaction_yandex_trans_avg_cnt_1m_to_3m, 
    transaction_yandex_trans_avg_sum_3m / NULLIF (transaction_yandex_trans_avg_sum_6m, 0) AS transaction_yandex_trans_avg_sum_3m_to_6m, 
    transaction_yandex_trans_avg_cnt_3m / NULLIF (transaction_yandex_trans_avg_cnt_6m, 0) AS transaction_yandex_trans_avg_cnt_3m_to_6m, 
    transaction_yandex_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_yandex_trans_avg_sum_1m_to_total_1m,
    transaction_yandex_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_yandex_trans_avg_cnt_1m_to_total_1m,
    transaction_yandex_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_yandex_trans_avg_sum_3m_to_total_3m, 
    transaction_yandex_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_yandex_trans_avg_cnt_3m_to_total_3m, 
    transaction_yandex_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_yandex_trans_avg_sum_3m_to_total_6m, 
    transaction_yandex_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_yandex_trans_avg_cnt_3m_to_total_6m, 
    transaction_yandex_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_yandex_trans_avg_sum_6m_to_total_6m, 
    transaction_yandex_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_yandex_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_30 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_78 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_beauty_trans_cnt_1m / NULLIF (transaction_beauty_trans_cnt_3m, 0) AS transaction_beauty_trans_cnt_1m_to_3m,
    transaction_beauty_trans_sum_1m / NULLIF (transaction_beauty_trans_sum_3m, 0) AS transaction_beauty_trans_sum_1m_to_3m,
    transaction_beauty_trans_cnt_3m / NULLIF (transaction_beauty_trans_cnt_6m, 0) AS transaction_beauty_trans_cnt_3m_to_6m,
    transaction_beauty_trans_sum_3m / NULLIF (transaction_beauty_trans_sum_6m, 0) AS transaction_beauty_trans_sum_3m_to_6m,
    transaction_beauty_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_beauty_trans_cnt_1m_to_total_1m, 
    transaction_beauty_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_beauty_trans_sum_1m_to_total_1m, 
    transaction_beauty_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_beauty_trans_cnt_3m_to_total_3m, 
    transaction_beauty_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_beauty_trans_sum_3m_to_total_3m,
    transaction_beauty_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_beauty_trans_cnt_3m_to_total_6m, 
    transaction_beauty_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_beauty_trans_sum_3m_to_total_6m, 
    transaction_beauty_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_beauty_trans_cnt_6m_to_total_6m, 
    transaction_beauty_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_beauty_trans_sum_6m_to_total_6m, 
    transaction_beauty_trans_avg_sum_1m / NULLIF (transaction_beauty_trans_avg_sum_3m, 0) AS transaction_beauty_trans_avg_sum_1m_to_3m, 
    transaction_beauty_trans_avg_cnt_1m / NULLIF (transaction_beauty_trans_avg_cnt_3m, 0) AS transaction_beauty_trans_avg_cnt_1m_to_3m, 
    transaction_beauty_trans_avg_sum_3m / NULLIF (transaction_beauty_trans_avg_sum_6m, 0) AS transaction_beauty_trans_avg_sum_3m_to_6m, 
    transaction_beauty_trans_avg_cnt_3m / NULLIF (transaction_beauty_trans_avg_cnt_6m, 0) AS transaction_beauty_trans_avg_cnt_3m_to_6m, 
    transaction_beauty_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_beauty_trans_avg_sum_1m_to_total_1m,
    transaction_beauty_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_beauty_trans_avg_cnt_1m_to_total_1m,
    transaction_beauty_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_beauty_trans_avg_sum_3m_to_total_3m, 
    transaction_beauty_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_beauty_trans_avg_cnt_3m_to_total_3m, 
    transaction_beauty_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_beauty_trans_avg_sum_3m_to_total_6m, 
    transaction_beauty_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_beauty_trans_avg_cnt_3m_to_total_6m, 
    transaction_beauty_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_beauty_trans_avg_sum_6m_to_total_6m, 
    transaction_beauty_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_beauty_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_31 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_79 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_cinema_trans_cnt_1m / NULLIF (transaction_cinema_trans_cnt_3m, 0) AS transaction_cinema_trans_cnt_1m_to_3m,
    transaction_cinema_trans_sum_1m / NULLIF (transaction_cinema_trans_sum_3m, 0) AS transaction_cinema_trans_sum_1m_to_3m,
    transaction_cinema_trans_cnt_3m / NULLIF (transaction_cinema_trans_cnt_6m, 0) AS transaction_cinema_trans_cnt_3m_to_6m,
    transaction_cinema_trans_sum_3m / NULLIF (transaction_cinema_trans_sum_6m, 0) AS transaction_cinema_trans_sum_3m_to_6m,
    transaction_cinema_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_cinema_trans_cnt_1m_to_total_1m, 
    transaction_cinema_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_cinema_trans_sum_1m_to_total_1m, 
    transaction_cinema_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_cinema_trans_cnt_3m_to_total_3m, 
    transaction_cinema_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_cinema_trans_sum_3m_to_total_3m,
    transaction_cinema_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cinema_trans_cnt_3m_to_total_6m, 
    transaction_cinema_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cinema_trans_sum_3m_to_total_6m, 
    transaction_cinema_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cinema_trans_cnt_6m_to_total_6m, 
    transaction_cinema_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cinema_trans_sum_6m_to_total_6m, 
    transaction_cinema_trans_avg_sum_1m / NULLIF (transaction_cinema_trans_avg_sum_3m, 0) AS transaction_cinema_trans_avg_sum_1m_to_3m, 
    transaction_cinema_trans_avg_cnt_1m / NULLIF (transaction_cinema_trans_avg_cnt_3m, 0) AS transaction_cinema_trans_avg_cnt_1m_to_3m, 
    transaction_cinema_trans_avg_sum_3m / NULLIF (transaction_cinema_trans_avg_sum_6m, 0) AS transaction_cinema_trans_avg_sum_3m_to_6m, 
    transaction_cinema_trans_avg_cnt_3m / NULLIF (transaction_cinema_trans_avg_cnt_6m, 0) AS transaction_cinema_trans_avg_cnt_3m_to_6m, 
    transaction_cinema_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_cinema_trans_avg_sum_1m_to_total_1m,
    transaction_cinema_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_cinema_trans_avg_cnt_1m_to_total_1m,
    transaction_cinema_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_cinema_trans_avg_sum_3m_to_total_3m, 
    transaction_cinema_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_cinema_trans_avg_cnt_3m_to_total_3m, 
    transaction_cinema_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cinema_trans_avg_sum_3m_to_total_6m, 
    transaction_cinema_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cinema_trans_avg_cnt_3m_to_total_6m, 
    transaction_cinema_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cinema_trans_avg_sum_6m_to_total_6m, 
    transaction_cinema_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cinema_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_32 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_80 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_charity_trans_cnt_1m / NULLIF (transaction_charity_trans_cnt_3m, 0) AS transaction_charity_trans_cnt_1m_to_3m,
    transaction_charity_trans_sum_1m / NULLIF (transaction_charity_trans_sum_3m, 0) AS transaction_charity_trans_sum_1m_to_3m,
    transaction_charity_trans_cnt_3m / NULLIF (transaction_charity_trans_cnt_6m, 0) AS transaction_charity_trans_cnt_3m_to_6m,
    transaction_charity_trans_sum_3m / NULLIF (transaction_charity_trans_sum_6m, 0) AS transaction_charity_trans_sum_3m_to_6m,
    transaction_charity_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_charity_trans_cnt_1m_to_total_1m, 
    transaction_charity_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_charity_trans_sum_1m_to_total_1m, 
    transaction_charity_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_charity_trans_cnt_3m_to_total_3m, 
    transaction_charity_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_charity_trans_sum_3m_to_total_3m,
    transaction_charity_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_charity_trans_cnt_3m_to_total_6m, 
    transaction_charity_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_charity_trans_sum_3m_to_total_6m, 
    transaction_charity_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_charity_trans_cnt_6m_to_total_6m, 
    transaction_charity_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_charity_trans_sum_6m_to_total_6m, 
    transaction_charity_trans_avg_sum_1m / NULLIF (transaction_charity_trans_avg_sum_3m, 0) AS transaction_charity_trans_avg_sum_1m_to_3m, 
    transaction_charity_trans_avg_cnt_1m / NULLIF (transaction_charity_trans_avg_cnt_3m, 0) AS transaction_charity_trans_avg_cnt_1m_to_3m, 
    transaction_charity_trans_avg_sum_3m / NULLIF (transaction_charity_trans_avg_sum_6m, 0) AS transaction_charity_trans_avg_sum_3m_to_6m, 
    transaction_charity_trans_avg_cnt_3m / NULLIF (transaction_charity_trans_avg_cnt_6m, 0) AS transaction_charity_trans_avg_cnt_3m_to_6m, 
    transaction_charity_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_charity_trans_avg_sum_1m_to_total_1m,
    transaction_charity_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_charity_trans_avg_cnt_1m_to_total_1m,
    transaction_charity_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_charity_trans_avg_sum_3m_to_total_3m, 
    transaction_charity_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_charity_trans_avg_cnt_3m_to_total_3m, 
    transaction_charity_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_charity_trans_avg_sum_3m_to_total_6m, 
    transaction_charity_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_charity_trans_avg_cnt_3m_to_total_6m, 
    transaction_charity_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_charity_trans_avg_sum_6m_to_total_6m, 
    transaction_charity_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_charity_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_33 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_81 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_money_transfers_trans_cnt_1m / NULLIF (transaction_money_transfers_trans_cnt_3m, 0) AS transaction_money_transfers_trans_cnt_1m_to_3m,
    transaction_money_transfers_trans_sum_1m / NULLIF (transaction_money_transfers_trans_sum_3m, 0) AS transaction_money_transfers_trans_sum_1m_to_3m,
    transaction_money_transfers_trans_cnt_3m / NULLIF (transaction_money_transfers_trans_cnt_6m, 0) AS transaction_money_transfers_trans_cnt_3m_to_6m,
    transaction_money_transfers_trans_sum_3m / NULLIF (transaction_money_transfers_trans_sum_6m, 0) AS transaction_money_transfers_trans_sum_3m_to_6m,
    transaction_money_transfers_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_money_transfers_trans_cnt_1m_to_total_1m, 
    transaction_money_transfers_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_money_transfers_trans_sum_1m_to_total_1m, 
    transaction_money_transfers_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_money_transfers_trans_cnt_3m_to_total_3m, 
    transaction_money_transfers_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_money_transfers_trans_sum_3m_to_total_3m,
    transaction_money_transfers_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_money_transfers_trans_cnt_3m_to_total_6m, 
    transaction_money_transfers_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_money_transfers_trans_sum_3m_to_total_6m, 
    transaction_money_transfers_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_money_transfers_trans_cnt_6m_to_total_6m, 
    transaction_money_transfers_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_money_transfers_trans_sum_6m_to_total_6m, 
    transaction_money_transfers_trans_avg_sum_1m / NULLIF (transaction_money_transfers_trans_avg_sum_3m, 0) AS transaction_money_transfers_trans_avg_sum_1m_to_3m, 
    transaction_money_transfers_trans_avg_cnt_1m / NULLIF (transaction_money_transfers_trans_avg_cnt_3m, 0) AS transaction_money_transfers_trans_avg_cnt_1m_to_3m, 
    transaction_money_transfers_trans_avg_sum_3m / NULLIF (transaction_money_transfers_trans_avg_sum_6m, 0) AS transaction_money_transfers_trans_avg_sum_3m_to_6m, 
    transaction_money_transfers_trans_avg_cnt_3m / NULLIF (transaction_money_transfers_trans_avg_cnt_6m, 0) AS transaction_money_transfers_trans_avg_cnt_3m_to_6m, 
    transaction_money_transfers_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_money_transfers_trans_avg_sum_1m_to_total_1m,
    transaction_money_transfers_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_money_transfers_trans_avg_cnt_1m_to_total_1m,
    transaction_money_transfers_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_money_transfers_trans_avg_sum_3m_to_total_3m, 
    transaction_money_transfers_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_money_transfers_trans_avg_cnt_3m_to_total_3m, 
    transaction_money_transfers_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_money_transfers_trans_avg_sum_3m_to_total_6m, 
    transaction_money_transfers_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_money_transfers_trans_avg_cnt_3m_to_total_6m, 
    transaction_money_transfers_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_money_transfers_trans_avg_sum_6m_to_total_6m, 
    transaction_money_transfers_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_money_transfers_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_34 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_82 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_auto_services_trans_cnt_1m / NULLIF (transaction_auto_services_trans_cnt_3m, 0) AS transaction_auto_services_trans_cnt_1m_to_3m,
    transaction_auto_services_trans_sum_1m / NULLIF (transaction_auto_services_trans_sum_3m, 0) AS transaction_auto_services_trans_sum_1m_to_3m,
    transaction_auto_services_trans_cnt_3m / NULLIF (transaction_auto_services_trans_cnt_6m, 0) AS transaction_auto_services_trans_cnt_3m_to_6m,
    transaction_auto_services_trans_sum_3m / NULLIF (transaction_auto_services_trans_sum_6m, 0) AS transaction_auto_services_trans_sum_3m_to_6m,
    transaction_auto_services_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_auto_services_trans_cnt_1m_to_total_1m, 
    transaction_auto_services_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_auto_services_trans_sum_1m_to_total_1m, 
    transaction_auto_services_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_auto_services_trans_cnt_3m_to_total_3m, 
    transaction_auto_services_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_auto_services_trans_sum_3m_to_total_3m,
    transaction_auto_services_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_auto_services_trans_cnt_3m_to_total_6m, 
    transaction_auto_services_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_auto_services_trans_sum_3m_to_total_6m, 
    transaction_auto_services_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_auto_services_trans_cnt_6m_to_total_6m, 
    transaction_auto_services_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_auto_services_trans_sum_6m_to_total_6m, 
    transaction_auto_services_trans_avg_sum_1m / NULLIF (transaction_auto_services_trans_avg_sum_3m, 0) AS transaction_auto_services_trans_avg_sum_1m_to_3m, 
    transaction_auto_services_trans_avg_cnt_1m / NULLIF (transaction_auto_services_trans_avg_cnt_3m, 0) AS transaction_auto_services_trans_avg_cnt_1m_to_3m, 
    transaction_auto_services_trans_avg_sum_3m / NULLIF (transaction_auto_services_trans_avg_sum_6m, 0) AS transaction_auto_services_trans_avg_sum_3m_to_6m, 
    transaction_auto_services_trans_avg_cnt_3m / NULLIF (transaction_auto_services_trans_avg_cnt_6m, 0) AS transaction_auto_services_trans_avg_cnt_3m_to_6m, 
    transaction_auto_services_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_auto_services_trans_avg_sum_1m_to_total_1m,
    transaction_auto_services_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_auto_services_trans_avg_cnt_1m_to_total_1m,
    transaction_auto_services_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_auto_services_trans_avg_sum_3m_to_total_3m, 
    transaction_auto_services_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_auto_services_trans_avg_cnt_3m_to_total_3m, 
    transaction_auto_services_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_auto_services_trans_avg_sum_3m_to_total_6m, 
    transaction_auto_services_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_auto_services_trans_avg_cnt_3m_to_total_6m, 
    transaction_auto_services_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_auto_services_trans_avg_sum_6m_to_total_6m, 
    transaction_auto_services_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_auto_services_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_35 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_83 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_consulting_trans_cnt_1m / NULLIF (transaction_consulting_trans_cnt_3m, 0) AS transaction_consulting_trans_cnt_1m_to_3m,
    transaction_consulting_trans_sum_1m / NULLIF (transaction_consulting_trans_sum_3m, 0) AS transaction_consulting_trans_sum_1m_to_3m,
    transaction_consulting_trans_cnt_3m / NULLIF (transaction_consulting_trans_cnt_6m, 0) AS transaction_consulting_trans_cnt_3m_to_6m,
    transaction_consulting_trans_sum_3m / NULLIF (transaction_consulting_trans_sum_6m, 0) AS transaction_consulting_trans_sum_3m_to_6m,
    transaction_consulting_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_consulting_trans_cnt_1m_to_total_1m, 
    transaction_consulting_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_consulting_trans_sum_1m_to_total_1m, 
    transaction_consulting_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_consulting_trans_cnt_3m_to_total_3m, 
    transaction_consulting_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_consulting_trans_sum_3m_to_total_3m,
    transaction_consulting_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_consulting_trans_cnt_3m_to_total_6m, 
    transaction_consulting_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_consulting_trans_sum_3m_to_total_6m, 
    transaction_consulting_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_consulting_trans_cnt_6m_to_total_6m, 
    transaction_consulting_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_consulting_trans_sum_6m_to_total_6m, 
    transaction_consulting_trans_avg_sum_1m / NULLIF (transaction_consulting_trans_avg_sum_3m, 0) AS transaction_consulting_trans_avg_sum_1m_to_3m, 
    transaction_consulting_trans_avg_cnt_1m / NULLIF (transaction_consulting_trans_avg_cnt_3m, 0) AS transaction_consulting_trans_avg_cnt_1m_to_3m, 
    transaction_consulting_trans_avg_sum_3m / NULLIF (transaction_consulting_trans_avg_sum_6m, 0) AS transaction_consulting_trans_avg_sum_3m_to_6m, 
    transaction_consulting_trans_avg_cnt_3m / NULLIF (transaction_consulting_trans_avg_cnt_6m, 0) AS transaction_consulting_trans_avg_cnt_3m_to_6m, 
    transaction_consulting_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_consulting_trans_avg_sum_1m_to_total_1m,
    transaction_consulting_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_consulting_trans_avg_cnt_1m_to_total_1m,
    transaction_consulting_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_consulting_trans_avg_sum_3m_to_total_3m, 
    transaction_consulting_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_consulting_trans_avg_cnt_3m_to_total_3m, 
    transaction_consulting_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_consulting_trans_avg_sum_3m_to_total_6m, 
    transaction_consulting_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_consulting_trans_avg_cnt_3m_to_total_6m, 
    transaction_consulting_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_consulting_trans_avg_sum_6m_to_total_6m, 
    transaction_consulting_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_consulting_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_36 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_84 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_cash_trans_cnt_1m / NULLIF (transaction_cash_trans_cnt_3m, 0) AS transaction_cash_trans_cnt_1m_to_3m,
    transaction_cash_trans_sum_1m / NULLIF (transaction_cash_trans_sum_3m, 0) AS transaction_cash_trans_sum_1m_to_3m,
    transaction_cash_trans_cnt_3m / NULLIF (transaction_cash_trans_cnt_6m, 0) AS transaction_cash_trans_cnt_3m_to_6m,
    transaction_cash_trans_sum_3m / NULLIF (transaction_cash_trans_sum_6m, 0) AS transaction_cash_trans_sum_3m_to_6m,
    transaction_cash_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_cash_trans_cnt_1m_to_total_1m, 
    transaction_cash_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_cash_trans_sum_1m_to_total_1m, 
    transaction_cash_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_cash_trans_cnt_3m_to_total_3m, 
    transaction_cash_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_cash_trans_sum_3m_to_total_3m,
    transaction_cash_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cash_trans_cnt_3m_to_total_6m, 
    transaction_cash_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cash_trans_sum_3m_to_total_6m, 
    transaction_cash_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_cash_trans_cnt_6m_to_total_6m, 
    transaction_cash_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_cash_trans_sum_6m_to_total_6m, 
    transaction_cash_trans_avg_sum_1m / NULLIF (transaction_cash_trans_avg_sum_3m, 0) AS transaction_cash_trans_avg_sum_1m_to_3m, 
    transaction_cash_trans_avg_cnt_1m / NULLIF (transaction_cash_trans_avg_cnt_3m, 0) AS transaction_cash_trans_avg_cnt_1m_to_3m, 
    transaction_cash_trans_avg_sum_3m / NULLIF (transaction_cash_trans_avg_sum_6m, 0) AS transaction_cash_trans_avg_sum_3m_to_6m, 
    transaction_cash_trans_avg_cnt_3m / NULLIF (transaction_cash_trans_avg_cnt_6m, 0) AS transaction_cash_trans_avg_cnt_3m_to_6m, 
    transaction_cash_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_cash_trans_avg_sum_1m_to_total_1m,
    transaction_cash_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_cash_trans_avg_cnt_1m_to_total_1m,
    transaction_cash_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_cash_trans_avg_sum_3m_to_total_3m, 
    transaction_cash_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_cash_trans_avg_cnt_3m_to_total_3m, 
    transaction_cash_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cash_trans_avg_sum_3m_to_total_6m, 
    transaction_cash_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cash_trans_avg_cnt_3m_to_total_6m, 
    transaction_cash_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_cash_trans_avg_sum_6m_to_total_6m, 
    transaction_cash_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_cash_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_37 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_85 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_other_trans_cnt_1m / NULLIF (transaction_other_trans_cnt_3m, 0) AS transaction_other_trans_cnt_1m_to_3m,
    transaction_other_trans_sum_1m / NULLIF (transaction_other_trans_sum_3m, 0) AS transaction_other_trans_sum_1m_to_3m,
    transaction_other_trans_cnt_3m / NULLIF (transaction_other_trans_cnt_6m, 0) AS transaction_other_trans_cnt_3m_to_6m,
    transaction_other_trans_sum_3m / NULLIF (transaction_other_trans_sum_6m, 0) AS transaction_other_trans_sum_3m_to_6m,
    transaction_other_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_other_trans_cnt_1m_to_total_1m, 
    transaction_other_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_other_trans_sum_1m_to_total_1m, 
    transaction_other_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_other_trans_cnt_3m_to_total_3m, 
    transaction_other_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_other_trans_sum_3m_to_total_3m,
    transaction_other_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_other_trans_cnt_3m_to_total_6m, 
    transaction_other_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_other_trans_sum_3m_to_total_6m, 
    transaction_other_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_other_trans_cnt_6m_to_total_6m, 
    transaction_other_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_other_trans_sum_6m_to_total_6m, 
    transaction_other_trans_avg_sum_1m / NULLIF (transaction_other_trans_avg_sum_3m, 0) AS transaction_other_trans_avg_sum_1m_to_3m, 
    transaction_other_trans_avg_cnt_1m / NULLIF (transaction_other_trans_avg_cnt_3m, 0) AS transaction_other_trans_avg_cnt_1m_to_3m, 
    transaction_other_trans_avg_sum_3m / NULLIF (transaction_other_trans_avg_sum_6m, 0) AS transaction_other_trans_avg_sum_3m_to_6m, 
    transaction_other_trans_avg_cnt_3m / NULLIF (transaction_other_trans_avg_cnt_6m, 0) AS transaction_other_trans_avg_cnt_3m_to_6m, 
    transaction_other_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_other_trans_avg_sum_1m_to_total_1m,
    transaction_other_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_other_trans_avg_cnt_1m_to_total_1m,
    transaction_other_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_other_trans_avg_sum_3m_to_total_3m, 
    transaction_other_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_other_trans_avg_cnt_3m_to_total_3m, 
    transaction_other_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_other_trans_avg_sum_3m_to_total_6m, 
    transaction_other_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_other_trans_avg_cnt_3m_to_total_6m, 
    transaction_other_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_other_trans_avg_sum_6m_to_total_6m, 
    transaction_other_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_other_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_38 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_86 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_utilities_trans_cnt_1m / NULLIF (transaction_utilities_trans_cnt_3m, 0) AS transaction_utilities_trans_cnt_1m_to_3m,
    transaction_utilities_trans_sum_1m / NULLIF (transaction_utilities_trans_sum_3m, 0) AS transaction_utilities_trans_sum_1m_to_3m,
    transaction_utilities_trans_cnt_3m / NULLIF (transaction_utilities_trans_cnt_6m, 0) AS transaction_utilities_trans_cnt_3m_to_6m,
    transaction_utilities_trans_sum_3m / NULLIF (transaction_utilities_trans_sum_6m, 0) AS transaction_utilities_trans_sum_3m_to_6m,
    transaction_utilities_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_utilities_trans_cnt_1m_to_total_1m, 
    transaction_utilities_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_utilities_trans_sum_1m_to_total_1m, 
    transaction_utilities_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_utilities_trans_cnt_3m_to_total_3m, 
    transaction_utilities_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_utilities_trans_sum_3m_to_total_3m,
    transaction_utilities_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_utilities_trans_cnt_3m_to_total_6m, 
    transaction_utilities_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_utilities_trans_sum_3m_to_total_6m, 
    transaction_utilities_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_utilities_trans_cnt_6m_to_total_6m, 
    transaction_utilities_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_utilities_trans_sum_6m_to_total_6m, 
    transaction_utilities_trans_avg_sum_1m / NULLIF (transaction_utilities_trans_avg_sum_3m, 0) AS transaction_utilities_trans_avg_sum_1m_to_3m, 
    transaction_utilities_trans_avg_cnt_1m / NULLIF (transaction_utilities_trans_avg_cnt_3m, 0) AS transaction_utilities_trans_avg_cnt_1m_to_3m, 
    transaction_utilities_trans_avg_sum_3m / NULLIF (transaction_utilities_trans_avg_sum_6m, 0) AS transaction_utilities_trans_avg_sum_3m_to_6m, 
    transaction_utilities_trans_avg_cnt_3m / NULLIF (transaction_utilities_trans_avg_cnt_6m, 0) AS transaction_utilities_trans_avg_cnt_3m_to_6m, 
    transaction_utilities_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_utilities_trans_avg_sum_1m_to_total_1m,
    transaction_utilities_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_utilities_trans_avg_cnt_1m_to_total_1m,
    transaction_utilities_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_utilities_trans_avg_sum_3m_to_total_3m, 
    transaction_utilities_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_utilities_trans_avg_cnt_3m_to_total_3m, 
    transaction_utilities_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_utilities_trans_avg_sum_3m_to_total_6m, 
    transaction_utilities_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_utilities_trans_avg_cnt_3m_to_total_6m, 
    transaction_utilities_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_utilities_trans_avg_sum_6m_to_total_6m, 
    transaction_utilities_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_utilities_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_39 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_87 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_tech_trans_cnt_1m / NULLIF (transaction_tech_trans_cnt_3m, 0) AS transaction_tech_trans_cnt_1m_to_3m,
    transaction_tech_trans_sum_1m / NULLIF (transaction_tech_trans_sum_3m, 0) AS transaction_tech_trans_sum_1m_to_3m,
    transaction_tech_trans_cnt_3m / NULLIF (transaction_tech_trans_cnt_6m, 0) AS transaction_tech_trans_cnt_3m_to_6m,
    transaction_tech_trans_sum_3m / NULLIF (transaction_tech_trans_sum_6m, 0) AS transaction_tech_trans_sum_3m_to_6m,
    transaction_tech_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_tech_trans_cnt_1m_to_total_1m, 
    transaction_tech_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_tech_trans_sum_1m_to_total_1m, 
    transaction_tech_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_tech_trans_cnt_3m_to_total_3m, 
    transaction_tech_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_tech_trans_sum_3m_to_total_3m,
    transaction_tech_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_tech_trans_cnt_3m_to_total_6m, 
    transaction_tech_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_tech_trans_sum_3m_to_total_6m, 
    transaction_tech_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_tech_trans_cnt_6m_to_total_6m, 
    transaction_tech_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_tech_trans_sum_6m_to_total_6m, 
    transaction_tech_trans_avg_sum_1m / NULLIF (transaction_tech_trans_avg_sum_3m, 0) AS transaction_tech_trans_avg_sum_1m_to_3m, 
    transaction_tech_trans_avg_cnt_1m / NULLIF (transaction_tech_trans_avg_cnt_3m, 0) AS transaction_tech_trans_avg_cnt_1m_to_3m, 
    transaction_tech_trans_avg_sum_3m / NULLIF (transaction_tech_trans_avg_sum_6m, 0) AS transaction_tech_trans_avg_sum_3m_to_6m, 
    transaction_tech_trans_avg_cnt_3m / NULLIF (transaction_tech_trans_avg_cnt_6m, 0) AS transaction_tech_trans_avg_cnt_3m_to_6m, 
    transaction_tech_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_tech_trans_avg_sum_1m_to_total_1m,
    transaction_tech_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_tech_trans_avg_cnt_1m_to_total_1m,
    transaction_tech_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_tech_trans_avg_sum_3m_to_total_3m, 
    transaction_tech_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_tech_trans_avg_cnt_3m_to_total_3m, 
    transaction_tech_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_tech_trans_avg_sum_3m_to_total_6m, 
    transaction_tech_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_tech_trans_avg_cnt_3m_to_total_6m, 
    transaction_tech_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_tech_trans_avg_sum_6m_to_total_6m, 
    transaction_tech_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_tech_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_40 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_88 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_jewelry_trans_cnt_1m / NULLIF (transaction_jewelry_trans_cnt_3m, 0) AS transaction_jewelry_trans_cnt_1m_to_3m,
    transaction_jewelry_trans_sum_1m / NULLIF (transaction_jewelry_trans_sum_3m, 0) AS transaction_jewelry_trans_sum_1m_to_3m,
    transaction_jewelry_trans_cnt_3m / NULLIF (transaction_jewelry_trans_cnt_6m, 0) AS transaction_jewelry_trans_cnt_3m_to_6m,
    transaction_jewelry_trans_sum_3m / NULLIF (transaction_jewelry_trans_sum_6m, 0) AS transaction_jewelry_trans_sum_3m_to_6m,
    transaction_jewelry_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_jewelry_trans_cnt_1m_to_total_1m, 
    transaction_jewelry_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_jewelry_trans_sum_1m_to_total_1m, 
    transaction_jewelry_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_jewelry_trans_cnt_3m_to_total_3m, 
    transaction_jewelry_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_jewelry_trans_sum_3m_to_total_3m,
    transaction_jewelry_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_jewelry_trans_cnt_3m_to_total_6m, 
    transaction_jewelry_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_jewelry_trans_sum_3m_to_total_6m, 
    transaction_jewelry_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_jewelry_trans_cnt_6m_to_total_6m, 
    transaction_jewelry_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_jewelry_trans_sum_6m_to_total_6m, 
    transaction_jewelry_trans_avg_sum_1m / NULLIF (transaction_jewelry_trans_avg_sum_3m, 0) AS transaction_jewelry_trans_avg_sum_1m_to_3m, 
    transaction_jewelry_trans_avg_cnt_1m / NULLIF (transaction_jewelry_trans_avg_cnt_3m, 0) AS transaction_jewelry_trans_avg_cnt_1m_to_3m, 
    transaction_jewelry_trans_avg_sum_3m / NULLIF (transaction_jewelry_trans_avg_sum_6m, 0) AS transaction_jewelry_trans_avg_sum_3m_to_6m, 
    transaction_jewelry_trans_avg_cnt_3m / NULLIF (transaction_jewelry_trans_avg_cnt_6m, 0) AS transaction_jewelry_trans_avg_cnt_3m_to_6m, 
    transaction_jewelry_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_jewelry_trans_avg_sum_1m_to_total_1m,
    transaction_jewelry_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_jewelry_trans_avg_cnt_1m_to_total_1m,
    transaction_jewelry_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_jewelry_trans_avg_sum_3m_to_total_3m, 
    transaction_jewelry_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_jewelry_trans_avg_cnt_3m_to_total_3m, 
    transaction_jewelry_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_jewelry_trans_avg_sum_3m_to_total_6m, 
    transaction_jewelry_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_jewelry_trans_avg_cnt_3m_to_total_6m, 
    transaction_jewelry_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_jewelry_trans_avg_sum_6m_to_total_6m, 
    transaction_jewelry_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_jewelry_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_41 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_89 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_clothes_trans_cnt_1m / NULLIF (transaction_clothes_trans_cnt_3m, 0) AS transaction_clothes_trans_cnt_1m_to_3m,
    transaction_clothes_trans_sum_1m / NULLIF (transaction_clothes_trans_sum_3m, 0) AS transaction_clothes_trans_sum_1m_to_3m,
    transaction_clothes_trans_cnt_3m / NULLIF (transaction_clothes_trans_cnt_6m, 0) AS transaction_clothes_trans_cnt_3m_to_6m,
    transaction_clothes_trans_sum_3m / NULLIF (transaction_clothes_trans_sum_6m, 0) AS transaction_clothes_trans_sum_3m_to_6m,
    transaction_clothes_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_clothes_trans_cnt_1m_to_total_1m, 
    transaction_clothes_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_clothes_trans_sum_1m_to_total_1m, 
    transaction_clothes_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_clothes_trans_cnt_3m_to_total_3m, 
    transaction_clothes_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_clothes_trans_sum_3m_to_total_3m,
    transaction_clothes_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_clothes_trans_cnt_3m_to_total_6m, 
    transaction_clothes_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_clothes_trans_sum_3m_to_total_6m, 
    transaction_clothes_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_clothes_trans_cnt_6m_to_total_6m, 
    transaction_clothes_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_clothes_trans_sum_6m_to_total_6m, 
    transaction_clothes_trans_avg_sum_1m / NULLIF (transaction_clothes_trans_avg_sum_3m, 0) AS transaction_clothes_trans_avg_sum_1m_to_3m, 
    transaction_clothes_trans_avg_cnt_1m / NULLIF (transaction_clothes_trans_avg_cnt_3m, 0) AS transaction_clothes_trans_avg_cnt_1m_to_3m, 
    transaction_clothes_trans_avg_sum_3m / NULLIF (transaction_clothes_trans_avg_sum_6m, 0) AS transaction_clothes_trans_avg_sum_3m_to_6m, 
    transaction_clothes_trans_avg_cnt_3m / NULLIF (transaction_clothes_trans_avg_cnt_6m, 0) AS transaction_clothes_trans_avg_cnt_3m_to_6m, 
    transaction_clothes_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_clothes_trans_avg_sum_1m_to_total_1m,
    transaction_clothes_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_clothes_trans_avg_cnt_1m_to_total_1m,
    transaction_clothes_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_clothes_trans_avg_sum_3m_to_total_3m, 
    transaction_clothes_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_clothes_trans_avg_cnt_3m_to_total_3m, 
    transaction_clothes_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_clothes_trans_avg_sum_3m_to_total_6m, 
    transaction_clothes_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_clothes_trans_avg_cnt_3m_to_total_6m, 
    transaction_clothes_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_clothes_trans_avg_sum_6m_to_total_6m, 
    transaction_clothes_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_clothes_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_42 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_90 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_education_trans_cnt_1m / NULLIF (transaction_education_trans_cnt_3m, 0) AS transaction_education_trans_cnt_1m_to_3m,
    transaction_education_trans_sum_1m / NULLIF (transaction_education_trans_sum_3m, 0) AS transaction_education_trans_sum_1m_to_3m,
    transaction_education_trans_cnt_3m / NULLIF (transaction_education_trans_cnt_6m, 0) AS transaction_education_trans_cnt_3m_to_6m,
    transaction_education_trans_sum_3m / NULLIF (transaction_education_trans_sum_6m, 0) AS transaction_education_trans_sum_3m_to_6m,
    transaction_education_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_education_trans_cnt_1m_to_total_1m, 
    transaction_education_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_education_trans_sum_1m_to_total_1m, 
    transaction_education_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_education_trans_cnt_3m_to_total_3m, 
    transaction_education_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_education_trans_sum_3m_to_total_3m,
    transaction_education_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_education_trans_cnt_3m_to_total_6m, 
    transaction_education_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_education_trans_sum_3m_to_total_6m, 
    transaction_education_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_education_trans_cnt_6m_to_total_6m, 
    transaction_education_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_education_trans_sum_6m_to_total_6m, 
    transaction_education_trans_avg_sum_1m / NULLIF (transaction_education_trans_avg_sum_3m, 0) AS transaction_education_trans_avg_sum_1m_to_3m, 
    transaction_education_trans_avg_cnt_1m / NULLIF (transaction_education_trans_avg_cnt_3m, 0) AS transaction_education_trans_avg_cnt_1m_to_3m, 
    transaction_education_trans_avg_sum_3m / NULLIF (transaction_education_trans_avg_sum_6m, 0) AS transaction_education_trans_avg_sum_3m_to_6m, 
    transaction_education_trans_avg_cnt_3m / NULLIF (transaction_education_trans_avg_cnt_6m, 0) AS transaction_education_trans_avg_cnt_3m_to_6m, 
    transaction_education_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_education_trans_avg_sum_1m_to_total_1m,
    transaction_education_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_education_trans_avg_cnt_1m_to_total_1m,
    transaction_education_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_education_trans_avg_sum_3m_to_total_3m, 
    transaction_education_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_education_trans_avg_cnt_3m_to_total_3m, 
    transaction_education_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_education_trans_avg_sum_3m_to_total_6m, 
    transaction_education_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_education_trans_avg_cnt_3m_to_total_6m, 
    transaction_education_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_education_trans_avg_sum_6m_to_total_6m, 
    transaction_education_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_education_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_43 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';

execute immediate '
create table '||in_table||'_TRANS_TEMP_91 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_finance_trans_cnt_1m / NULLIF (transaction_finance_trans_cnt_3m, 0) AS transaction_finance_trans_cnt_1m_to_3m,
    transaction_finance_trans_sum_1m / NULLIF (transaction_finance_trans_sum_3m, 0) AS transaction_finance_trans_sum_1m_to_3m,
    transaction_finance_trans_cnt_3m / NULLIF (transaction_finance_trans_cnt_6m, 0) AS transaction_finance_trans_cnt_3m_to_6m,
    transaction_finance_trans_sum_3m / NULLIF (transaction_finance_trans_sum_6m, 0) AS transaction_finance_trans_sum_3m_to_6m,
    transaction_finance_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_finance_trans_cnt_1m_to_total_1m, 
    transaction_finance_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_finance_trans_sum_1m_to_total_1m, 
    transaction_finance_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_finance_trans_cnt_3m_to_total_3m, 
    transaction_finance_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_finance_trans_sum_3m_to_total_3m,
    transaction_finance_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_finance_trans_cnt_3m_to_total_6m, 
    transaction_finance_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_finance_trans_sum_3m_to_total_6m, 
    transaction_finance_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_finance_trans_cnt_6m_to_total_6m, 
    transaction_finance_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_finance_trans_sum_6m_to_total_6m, 
    transaction_finance_trans_avg_sum_1m / NULLIF (transaction_finance_trans_avg_sum_3m, 0) AS transaction_finance_trans_avg_sum_1m_to_3m, 
    transaction_finance_trans_avg_cnt_1m / NULLIF (transaction_finance_trans_avg_cnt_3m, 0) AS transaction_finance_trans_avg_cnt_1m_to_3m, 
    transaction_finance_trans_avg_sum_3m / NULLIF (transaction_finance_trans_avg_sum_6m, 0) AS transaction_finance_trans_avg_sum_3m_to_6m, 
    transaction_finance_trans_avg_cnt_3m / NULLIF (transaction_finance_trans_avg_cnt_6m, 0) AS transaction_finance_trans_avg_cnt_3m_to_6m, 
    transaction_finance_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_finance_trans_avg_sum_1m_to_total_1m,
    transaction_finance_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_finance_trans_avg_cnt_1m_to_total_1m,
    transaction_finance_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_finance_trans_avg_sum_3m_to_total_3m, 
    transaction_finance_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_finance_trans_avg_cnt_3m_to_total_3m, 
    transaction_finance_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_finance_trans_avg_sum_3m_to_total_6m, 
    transaction_finance_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_finance_trans_avg_cnt_3m_to_total_6m, 
    transaction_finance_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_finance_trans_avg_sum_6m_to_total_6m, 
    transaction_finance_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_finance_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_44 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';
    
execute immediate '
create table '||in_table||'_TRANS_TEMP_93 as 
select /*+parallel (8)*/ 
    p1.client_did, 
    p1.report_date,
    transaction_fastfood_trans_cnt_1m / NULLIF (transaction_fastfood_trans_cnt_3m, 0) AS transaction_fastfood_trans_cnt_1m_to_3m,
    transaction_fastfood_trans_sum_1m / NULLIF (transaction_fastfood_trans_sum_3m, 0) AS transaction_fastfood_trans_sum_1m_to_3m,
    transaction_fastfood_trans_cnt_3m / NULLIF (transaction_fastfood_trans_cnt_6m, 0) AS transaction_fastfood_trans_cnt_3m_to_6m,
    transaction_fastfood_trans_sum_3m / NULLIF (transaction_fastfood_trans_sum_6m, 0) AS transaction_fastfood_trans_sum_3m_to_6m,
    transaction_fastfood_trans_cnt_1m / NULLIF (transaction_total_trans_cnt_1m, 0) AS transaction_fastfood_trans_cnt_1m_to_total_1m, 
    transaction_fastfood_trans_sum_1m / NULLIF (transaction_total_trans_sum_1m, 0) AS transaction_fastfood_trans_sum_1m_to_total_1m, 
    transaction_fastfood_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_3m, 0) AS transaction_fastfood_trans_cnt_3m_to_total_3m, 
    transaction_fastfood_trans_sum_3m / NULLIF (transaction_total_trans_sum_3m, 0) AS transaction_fastfood_trans_sum_3m_to_total_3m,
    transaction_fastfood_trans_cnt_3m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fastfood_trans_cnt_3m_to_total_6m, 
    transaction_fastfood_trans_sum_3m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fastfood_trans_sum_3m_to_total_6m, 
    transaction_fastfood_trans_cnt_6m / NULLIF (transaction_total_trans_cnt_6m, 0) AS transaction_fastfood_trans_cnt_6m_to_total_6m, 
    transaction_fastfood_trans_sum_6m / NULLIF (transaction_total_trans_sum_6m, 0) AS transaction_fastfood_trans_sum_6m_to_total_6m, 
    transaction_fastfood_trans_avg_sum_1m / NULLIF (transaction_fastfood_trans_avg_sum_3m, 0) AS transaction_fastfood_trans_avg_sum_1m_to_3m, 
    transaction_fastfood_trans_avg_cnt_1m / NULLIF (transaction_fastfood_trans_avg_cnt_3m, 0) AS transaction_fastfood_trans_avg_cnt_1m_to_3m, 
    transaction_fastfood_trans_avg_sum_3m / NULLIF (transaction_fastfood_trans_avg_sum_6m, 0) AS transaction_fastfood_trans_avg_sum_3m_to_6m, 
    transaction_fastfood_trans_avg_cnt_3m / NULLIF (transaction_fastfood_trans_avg_cnt_6m, 0) AS transaction_fastfood_trans_avg_cnt_3m_to_6m, 
    transaction_fastfood_trans_avg_sum_1m / NULLIF (transaction_total_trans_avg_sum_1m, 0) AS transaction_fastfood_trans_avg_sum_1m_to_total_1m,
    transaction_fastfood_trans_avg_cnt_1m / NULLIF (transaction_total_trans_avg_cnt_1m, 0) AS transaction_fastfood_trans_avg_cnt_1m_to_total_1m,
    transaction_fastfood_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_3m, 0) AS transaction_fastfood_trans_avg_sum_3m_to_total_3m, 
    transaction_fastfood_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_3m, 0) AS transaction_fastfood_trans_avg_cnt_3m_to_total_3m, 
    transaction_fastfood_trans_avg_sum_3m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fastfood_trans_avg_sum_3m_to_total_6m, 
    transaction_fastfood_trans_avg_cnt_3m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fastfood_trans_avg_cnt_3m_to_total_6m, 
    transaction_fastfood_trans_avg_sum_6m / NULLIF (transaction_total_trans_avg_sum_6m, 0) AS transaction_fastfood_trans_avg_sum_6m_to_total_6m, 
    transaction_fastfood_trans_avg_cnt_6m / NULLIF (transaction_total_trans_avg_cnt_6m, 0) AS transaction_fastfood_trans_avg_cnt_6m_to_total_6m
FROM '||in_table||'_TRANS_TEMP_92 p1 
left join '||in_table||'_TRANS_TEMP_0 p2
    on p1.client_did = p2.client_did
    and p1.report_date = p2.report_date';


execute immediate 'create index idx_'||in_table||'_48 on '||in_table||'_TRANS_TEMP_48 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_48 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_49 on '||in_table||'_TRANS_TEMP_49 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_49 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_50 on '||in_table||'_TRANS_TEMP_50 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_50 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_51 on '||in_table||'_TRANS_TEMP_51 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_51 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_52 on '||in_table||'_TRANS_TEMP_52 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_52 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_53 on '||in_table||'_TRANS_TEMP_53 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_53 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_54 on '||in_table||'_TRANS_TEMP_54 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_54 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_55 on '||in_table||'_TRANS_TEMP_55 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_55 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_56 on '||in_table||'_TRANS_TEMP_56 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_56 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_57 on '||in_table||'_TRANS_TEMP_57 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_57 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_58 on '||in_table||'_TRANS_TEMP_58 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_58 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_59 on '||in_table||'_TRANS_TEMP_59 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_59 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_60 on '||in_table||'_TRANS_TEMP_60 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_60 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_61 on '||in_table||'_TRANS_TEMP_61 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_61 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_62 on '||in_table||'_TRANS_TEMP_62 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_62 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_63 on '||in_table||'_TRANS_TEMP_63 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_63 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_64 on '||in_table||'_TRANS_TEMP_64 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_64 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_65 on '||in_table||'_TRANS_TEMP_65 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_65 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_66 on '||in_table||'_TRANS_TEMP_66 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_66 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_67 on '||in_table||'_TRANS_TEMP_67 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_67 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_68 on '||in_table||'_TRANS_TEMP_68 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_68 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_69 on '||in_table||'_TRANS_TEMP_69 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_69 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_70 on '||in_table||'_TRANS_TEMP_70 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_70 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_71 on '||in_table||'_TRANS_TEMP_71 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_71 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_72 on '||in_table||'_TRANS_TEMP_72 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_72 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_73 on '||in_table||'_TRANS_TEMP_73 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_73 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_74 on '||in_table||'_TRANS_TEMP_74 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_74 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_75 on '||in_table||'_TRANS_TEMP_75 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_75 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_76 on '||in_table||'_TRANS_TEMP_76 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_76 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_77 on '||in_table||'_TRANS_TEMP_77 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_77 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_78 on '||in_table||'_TRANS_TEMP_78 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_78 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_79 on '||in_table||'_TRANS_TEMP_79 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_79 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_80 on '||in_table||'_TRANS_TEMP_80 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_80 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_81 on '||in_table||'_TRANS_TEMP_81 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_81 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_82 on '||in_table||'_TRANS_TEMP_82 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_82 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_83 on '||in_table||'_TRANS_TEMP_83 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_83 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_84 on '||in_table||'_TRANS_TEMP_84 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_84 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_85 on '||in_table||'_TRANS_TEMP_85 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_85 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_86 on '||in_table||'_TRANS_TEMP_86 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_86 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_87 on '||in_table||'_TRANS_TEMP_87 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_87 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_88 on '||in_table||'_TRANS_TEMP_88 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_88 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_89 on '||in_table||'_TRANS_TEMP_89 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_89 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_90 on '||in_table||'_TRANS_TEMP_90 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_90 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_91 on '||in_table||'_TRANS_TEMP_91 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_91 NOPARALLEL';
execute immediate 'create index idx_'||in_table||'_93 on '||in_table||'_TRANS_TEMP_93 (client_did, report_date) PARALLEL 16';
execute immediate 'alter index idx_'||in_table||'_93 NOPARALLEL';

my_str := '
create table '||out_table_2|| ' as
select /* +parallel(16)+ */
	a.client_did,
	a.report_date,
	transaction_total_trans_cnt_1m,
	transaction_total_trans_sum_1m,
	transaction_total_trans_cnt_2m,
	transaction_total_trans_sum_2m,
	transaction_total_trans_cnt_3m,
	transaction_total_trans_sum_3m,
	transaction_total_trans_cnt_4m,
	transaction_total_trans_sum_4m,
	transaction_total_trans_cnt_6m,
	transaction_total_trans_sum_6m,
	transaction_total_trans_cnt_12m,
	transaction_total_trans_sum_12m,
	transaction_total_trans_avg_sum_1m,
	transaction_total_trans_avg_sum_2m,
	transaction_total_trans_avg_sum_3m,
	transaction_total_trans_avg_sum_4m,
	transaction_total_trans_avg_sum_6m,
	transaction_total_trans_avg_sum_12m,
	transaction_total_trans_avg_cnt_1m,
	transaction_total_trans_avg_cnt_2m,
	transaction_total_trans_avg_cnt_3m,
	transaction_total_trans_avg_cnt_4m,
	transaction_total_trans_avg_cnt_6m,
	transaction_total_trans_avg_cnt_12m,
	transaction_total_trans_cnt_24_12,
	transaction_total_trans_sum_24_12,
--	transaction_first_trans_dt,
--	transaction_last_trans_dt,
	transaction_max_trans_1m,
	transaction_max_trans_2m,
	transaction_max_trans_3m,
	transaction_max_trans_4m,
	transaction_max_trans_6m,
	transaction_max_trans_12m,
	transaction_max_trans_prev_1m,  
	transaction_max_trans_prev_3m,
	transaction_max_trans_prev_6m,
	transaction_max_trans_prev_12m,
	transaction_min_trans_1m,
	transaction_min_trans_2m,
	transaction_min_trans_3m,
	transaction_min_trans_4m,
	transaction_min_trans_6m,
	transaction_min_trans_12m,
	transaction_min_trans_prev_1m,  
	transaction_min_trans_prev_3m,
	transaction_min_trans_prev_6m,
	transaction_min_trans_prev_12m,
    --model_mcc
    transaction_ratio_cnt_trans_1m_to_1m,
	transaction_ratio_cnt_trans_3m_to_3m,
    transaction_ratio_cnt_trans_5m_to_5m,
    
    transaction_avg_trans_12m,
    transaction_avg_trans_1m,
    transaction_avg_trans_3m,
    transaction_avg_trans_prev_12m,
    transaction_avg_trans_prev_1m,
    transaction_avg_trans_prev_3m,
    transaction_days_since_first_trans,
    transaction_days_since_last_trans,
    transaction_diff_avg_trans_12m,
    transaction_diff_avg_trans_1m,
    transaction_diff_avg_trans_3m,
    transaction_diff_max_trans_12m,
    transaction_diff_max_trans_1m,
    transaction_diff_max_trans_3m,
    transaction_diff_max_trans_6m,
    transaction_diff_min_trans_12m,
    transaction_diff_min_trans_1m,
    transaction_diff_min_trans_3m,
    transaction_diff_min_trans_6m,
    transaction_diff_total_trans_sum_12m,
    transaction_diff_total_trans_sum_1m,
    transaction_diff_total_trans_sum_3m,
    transaction_diff_total_trans_sum_6m,
    transaction_ratio_avg_trans_12m,
    transaction_ratio_avg_trans_1m,
    transaction_ratio_avg_trans_3m,
    transaction_ratio_avg_trans_6m,
    transaction_ratio_max_trans_12m,
    transaction_ratio_max_trans_1m,
    transaction_ratio_max_trans_3m,
    transaction_ratio_max_trans_6m,
    transaction_ratio_min_trans_12m,
    transaction_ratio_min_trans_1m,
    transaction_ratio_min_trans_3m,
    transaction_ratio_min_trans_6m,

    transaction_fastfood_trans_cnt_1m,
	transaction_fastfood_trans_sum_1m,
	transaction_fastfood_trans_max_1m,
	transaction_fastfood_trans_min_1m,
	transaction_fastfood_trans_cnt_3m,
	transaction_fastfood_trans_sum_3m,
	transaction_fastfood_trans_max_3m,
	transaction_fastfood_trans_min_3m,
	transaction_fastfood_trans_cnt_6m,
	transaction_fastfood_trans_sum_6m,
	transaction_fastfood_trans_max_6m,
	transaction_fastfood_trans_min_6m,
	transaction_fastfood_trans_cnt_12m,
	transaction_fastfood_trans_sum_12m,
	transaction_fastfood_trans_max_12m,
	transaction_fastfood_trans_min_12m,
	transaction_fastfood_trans_avg_sum_1m,
	transaction_fastfood_trans_avg_sum_3m,
	transaction_fastfood_trans_avg_sum_6m,
	transaction_fastfood_trans_avg_sum_12m,
	transaction_fastfood_trans_avg_cnt_1m,
	transaction_fastfood_trans_avg_cnt_3m,
	transaction_fastfood_trans_avg_cnt_6m,
	transaction_fastfood_trans_avg_cnt_12m,
    transaction_fastfood_trans_cnt_1m_to_3m,
	transaction_fastfood_trans_sum_1m_to_3m,
	transaction_fastfood_trans_cnt_3m_to_6m,
	transaction_fastfood_trans_sum_3m_to_6m,
	transaction_fastfood_trans_cnt_1m_to_total_1m,
	transaction_fastfood_trans_sum_1m_to_total_1m,
	transaction_fastfood_trans_cnt_3m_to_total_3m,
	transaction_fastfood_trans_sum_3m_to_total_3m,
	transaction_fastfood_trans_cnt_3m_to_total_6m,
	transaction_fastfood_trans_sum_3m_to_total_6m,
	transaction_fastfood_trans_cnt_6m_to_total_6m,
	transaction_fastfood_trans_sum_6m_to_total_6m,
	transaction_fastfood_trans_avg_sum_1m_to_3m,
	transaction_fastfood_trans_avg_cnt_1m_to_3m,
	transaction_fastfood_trans_avg_sum_3m_to_6m,
	transaction_fastfood_trans_avg_cnt_3m_to_6m,
	transaction_fastfood_trans_avg_sum_1m_to_total_1m,
	transaction_fastfood_trans_avg_cnt_1m_to_total_1m,
	transaction_fastfood_trans_avg_sum_3m_to_total_3m,
	transaction_fastfood_trans_avg_cnt_3m_to_total_3m,
	transaction_fastfood_trans_avg_sum_3m_to_total_6m,
	transaction_fastfood_trans_avg_cnt_3m_to_total_6m,
	transaction_fastfood_trans_avg_sum_6m_to_total_6m,
	transaction_fastfood_trans_avg_cnt_6m_to_total_6m,

	transaction_cash_trans_cnt_1m,
	transaction_cash_trans_sum_1m,
	transaction_cash_trans_max_1m,
	transaction_cash_trans_min_1m,
	transaction_cash_trans_cnt_3m,
	transaction_cash_trans_sum_3m,
	transaction_cash_trans_max_3m,
	transaction_cash_trans_min_3m,
	transaction_cash_trans_cnt_6m,
	transaction_cash_trans_sum_6m,
	transaction_cash_trans_max_6m,
	transaction_cash_trans_min_6m,
	transaction_cash_trans_cnt_12m,
	transaction_cash_trans_sum_12m,
	transaction_cash_trans_max_12m,
	transaction_cash_trans_min_12m,
	transaction_cash_trans_avg_sum_1m,
	transaction_cash_trans_avg_sum_3m,
	transaction_cash_trans_avg_sum_6m,
	transaction_cash_trans_avg_sum_12m,
	transaction_cash_trans_avg_cnt_1m,
	transaction_cash_trans_avg_cnt_3m,
	transaction_cash_trans_avg_cnt_6m,
	transaction_cash_trans_avg_cnt_12m,
	transaction_cash_c_trans_cnt_1m,
	transaction_cash_c_trans_sum_1m,
	transaction_cash_c_trans_max_1m,
	transaction_cash_c_trans_min_1m,
	transaction_cash_c_trans_cnt_3m,
	transaction_cash_c_trans_sum_3m,
	transaction_cash_c_trans_max_3m,
	transaction_cash_c_trans_min_3m,
	transaction_cash_c_trans_cnt_6m,
	transaction_cash_c_trans_sum_6m,
	transaction_cash_c_trans_max_6m,
	transaction_cash_c_trans_min_6m,
	transaction_cash_c_trans_cnt_12m,
	transaction_cash_c_trans_sum_12m,
	transaction_cash_c_trans_max_12m,
	transaction_cash_c_trans_min_12m,
	transaction_cash_c_trans_avg_sum_1m,
	transaction_cash_c_trans_avg_sum_3m,
	transaction_cash_c_trans_avg_sum_6m,
	transaction_cash_c_trans_avg_sum_12m,
	transaction_cash_c_trans_avg_cnt_1m,
	transaction_cash_c_trans_avg_cnt_3m,
	transaction_cash_c_trans_avg_cnt_6m,
	transaction_cash_c_trans_avg_cnt_12m,
	transaction_card_transfer_trans_cnt_1m,
	transaction_card_transfer_trans_sum_1m,
	transaction_card_transfer_trans_max_1m,
	transaction_card_transfer_trans_min_1m,
	transaction_card_transfer_trans_cnt_3m,
	transaction_card_transfer_trans_sum_3m,
	transaction_card_transfer_trans_max_3m,
	transaction_card_transfer_trans_min_3m,
	transaction_card_transfer_trans_cnt_6m,
	transaction_card_transfer_trans_sum_6m,
	transaction_card_transfer_trans_max_6m,
	transaction_card_transfer_trans_min_6m,
	transaction_card_transfer_trans_cnt_12m,
	transaction_card_transfer_trans_sum_12m,
	transaction_card_transfer_trans_max_12m,
	transaction_card_transfer_trans_min_12m,
	transaction_card_transfer_trans_avg_sum_1m,
	transaction_card_transfer_trans_avg_sum_3m,
	transaction_card_transfer_trans_avg_sum_6m,
	transaction_card_transfer_trans_avg_sum_12m,
	transaction_card_transfer_trans_avg_cnt_1m,
	transaction_card_transfer_trans_avg_cnt_3m,
	transaction_card_transfer_trans_avg_cnt_6m,
	transaction_card_transfer_trans_avg_cnt_12m,
	transaction_card_transfer_c_trans_cnt_1m,
	transaction_card_transfer_c_trans_sum_1m,
	transaction_card_transfer_c_trans_max_1m,
	transaction_card_transfer_c_trans_min_1m,
	transaction_card_transfer_c_trans_cnt_3m,
	transaction_card_transfer_c_trans_sum_3m,
	transaction_card_transfer_c_trans_max_3m,
	transaction_card_transfer_c_trans_min_3m,
	transaction_card_transfer_c_trans_cnt_6m,
	transaction_card_transfer_c_trans_sum_6m,
	transaction_card_transfer_c_trans_max_6m,
	transaction_card_transfer_c_trans_min_6m,
	transaction_card_transfer_c_trans_cnt_12m,
	transaction_card_transfer_c_trans_sum_12m,
	transaction_card_transfer_c_trans_max_12m,
	transaction_card_transfer_c_trans_min_12m,
	transaction_card_transfer_c_trans_avg_sum_1m,
	transaction_card_transfer_c_trans_avg_sum_3m,
	transaction_card_transfer_c_trans_avg_sum_6m,
	transaction_card_transfer_c_trans_avg_sum_12m,
	transaction_card_transfer_c_trans_avg_cnt_1m,
	transaction_card_transfer_c_trans_avg_cnt_3m,
	transaction_card_transfer_c_trans_avg_cnt_6m,
	transaction_card_transfer_c_trans_avg_cnt_12m,
	transaction_money_transfers_trans_cnt_1m,
	transaction_money_transfers_trans_sum_1m,
	transaction_money_transfers_trans_max_1m,
	transaction_money_transfers_trans_min_1m,
	transaction_money_transfers_trans_cnt_3m,
	transaction_money_transfers_trans_sum_3m,
	transaction_money_transfers_trans_max_3m,
	transaction_money_transfers_trans_min_3m,
	transaction_money_transfers_trans_cnt_6m,
	transaction_money_transfers_trans_sum_6m,
	transaction_money_transfers_trans_max_6m,
	transaction_money_transfers_trans_min_6m,
	transaction_money_transfers_trans_cnt_12m,
	transaction_money_transfers_trans_sum_12m,
	transaction_money_transfers_trans_max_12m,
	transaction_money_transfers_trans_min_12m,
	transaction_money_transfers_trans_avg_sum_1m,
	transaction_money_transfers_trans_avg_sum_3m,
	transaction_money_transfers_trans_avg_sum_6m,
	transaction_money_transfers_trans_avg_sum_12m,
	transaction_money_transfers_trans_avg_cnt_1m,
	transaction_money_transfers_trans_avg_cnt_3m,
	transaction_money_transfers_trans_avg_cnt_6m,
	transaction_money_transfers_trans_avg_cnt_12m,
	transaction_money_transfers_c_trans_cnt_1m,
	transaction_money_transfers_c_trans_sum_1m,
	transaction_money_transfers_c_trans_max_1m,
	transaction_money_transfers_c_trans_min_1m,
	transaction_money_transfers_c_trans_cnt_3m,
	transaction_money_transfers_c_trans_sum_3m,
	transaction_money_transfers_c_trans_max_3m,
	transaction_money_transfers_c_trans_min_3m,
	transaction_money_transfers_c_trans_cnt_6m,
	transaction_money_transfers_c_trans_sum_6m,
	transaction_money_transfers_c_trans_max_6m,
	transaction_money_transfers_c_trans_min_6m,
	transaction_money_transfers_c_trans_cnt_12m,
	transaction_money_transfers_c_trans_sum_12m,
	transaction_money_transfers_c_trans_max_12m,
	transaction_money_transfers_c_trans_min_12m,
	transaction_money_transfers_c_trans_avg_sum_1m,
	transaction_money_transfers_c_trans_avg_sum_3m,
	transaction_money_transfers_c_trans_avg_sum_6m,
	transaction_money_transfers_c_trans_avg_sum_12m,
	transaction_money_transfers_c_trans_avg_cnt_1m,
	transaction_money_transfers_c_trans_avg_cnt_3m,
	transaction_money_transfers_c_trans_avg_cnt_6m,
	transaction_money_transfers_c_trans_avg_cnt_12m,
    transaction_money_transfers_trans_cnt_1m_to_3m,
	transaction_money_transfers_trans_sum_1m_to_3m,
	transaction_money_transfers_trans_cnt_3m_to_6m,
	transaction_money_transfers_trans_sum_3m_to_6m,
	transaction_money_transfers_trans_cnt_1m_to_total_1m,
	transaction_money_transfers_trans_sum_1m_to_total_1m,
	transaction_money_transfers_trans_cnt_3m_to_total_3m,
	transaction_money_transfers_trans_sum_3m_to_total_3m,
	transaction_money_transfers_trans_cnt_3m_to_total_6m,
	transaction_money_transfers_trans_sum_3m_to_total_6m,
	transaction_money_transfers_trans_cnt_6m_to_total_6m,
	transaction_money_transfers_trans_sum_6m_to_total_6m,
	transaction_money_transfers_trans_avg_sum_1m_to_3m,
	transaction_money_transfers_trans_avg_cnt_1m_to_3m,
	transaction_money_transfers_trans_avg_sum_3m_to_6m,
	transaction_money_transfers_trans_avg_cnt_3m_to_6m,
	transaction_money_transfers_trans_avg_sum_1m_to_total_1m,
	transaction_money_transfers_trans_avg_cnt_1m_to_total_1m,
	transaction_money_transfers_trans_avg_sum_3m_to_total_3m,
	transaction_money_transfers_trans_avg_cnt_3m_to_total_3m,
	transaction_money_transfers_trans_avg_sum_3m_to_total_6m,
	transaction_money_transfers_trans_avg_cnt_3m_to_total_6m,
	transaction_money_transfers_trans_avg_sum_6m_to_total_6m,
	transaction_money_transfers_trans_avg_cnt_6m_to_total_6m,
    transaction_cash_trans_cnt_1m_to_3m,
	transaction_cash_trans_sum_1m_to_3m,
	transaction_cash_trans_cnt_3m_to_6m,
	transaction_cash_trans_sum_3m_to_6m,
	transaction_cash_trans_cnt_1m_to_total_1m,
	transaction_cash_trans_sum_1m_to_total_1m,
	transaction_cash_trans_cnt_3m_to_total_3m,
	transaction_cash_trans_sum_3m_to_total_3m,
	transaction_cash_trans_cnt_3m_to_total_6m,
	transaction_cash_trans_sum_3m_to_total_6m,
	transaction_cash_trans_cnt_6m_to_total_6m,
	transaction_cash_trans_sum_6m_to_total_6m,
	transaction_cash_trans_avg_sum_1m_to_3m,
	transaction_cash_trans_avg_cnt_1m_to_3m,
	transaction_cash_trans_avg_sum_3m_to_6m,
	transaction_cash_trans_avg_cnt_3m_to_6m,
	transaction_cash_trans_avg_sum_1m_to_total_1m,
	transaction_cash_trans_avg_cnt_1m_to_total_1m,
	transaction_cash_trans_avg_sum_3m_to_total_3m,
	transaction_cash_trans_avg_cnt_3m_to_total_3m,
	transaction_cash_trans_avg_sum_3m_to_total_6m,
	transaction_cash_trans_avg_cnt_3m_to_total_6m,
	transaction_cash_trans_avg_sum_6m_to_total_6m,
	transaction_cash_trans_avg_cnt_6m_to_total_6m,
    transaction_card_transfer_trans_cnt_1m_to_3m,
	transaction_card_transfer_trans_sum_1m_to_3m,
	transaction_card_transfer_trans_cnt_3m_to_6m,
	transaction_card_transfer_trans_sum_3m_to_6m,
	transaction_card_transfer_trans_cnt_1m_to_total_1m,
	transaction_card_transfer_trans_sum_1m_to_total_1m,
	transaction_card_transfer_trans_cnt_3m_to_total_3m,
	transaction_card_transfer_trans_sum_3m_to_total_3m,
	transaction_card_transfer_trans_cnt_3m_to_total_6m,
	transaction_card_transfer_trans_sum_3m_to_total_6m,
	transaction_card_transfer_trans_cnt_6m_to_total_6m,
	transaction_card_transfer_trans_sum_6m_to_total_6m,
	transaction_card_transfer_trans_avg_sum_1m_to_3m,
	transaction_card_transfer_trans_avg_cnt_1m_to_3m,
	transaction_card_transfer_trans_avg_sum_3m_to_6m,
	transaction_card_transfer_trans_avg_cnt_3m_to_6m,
	transaction_card_transfer_trans_avg_sum_1m_to_total_1m,
	transaction_card_transfer_trans_avg_cnt_1m_to_total_1m,
	transaction_card_transfer_trans_avg_sum_3m_to_total_3m,
	transaction_card_transfer_trans_avg_cnt_3m_to_total_3m,
	transaction_card_transfer_trans_avg_sum_3m_to_total_6m,
	transaction_card_transfer_trans_avg_cnt_3m_to_total_6m,
	transaction_card_transfer_trans_avg_sum_6m_to_total_6m,
	transaction_card_transfer_trans_avg_cnt_6m_to_total_6m,
	';
add_str := '
	transaction_card_transfer_c_trans_cnt_1m / NULLIF(transaction_card_transfer_c_trans_cnt_3m, 0) AS transaction_card_transfer_c_trans_cnt_1m_to_3m,
	transaction_card_transfer_c_trans_sum_1m / NULLIF(transaction_card_transfer_c_trans_sum_3m, 0) AS transaction_card_transfer_c_trans_sum_1m_to_3m,
	transaction_card_transfer_c_trans_cnt_3m / NULLIF(transaction_card_transfer_c_trans_cnt_6m, 0) AS transaction_card_transfer_c_trans_cnt_3m_to_6m,
	transaction_card_transfer_c_trans_sum_3m / NULLIF(transaction_card_transfer_c_trans_sum_6m, 0) AS transaction_card_transfer_c_trans_sum_3m_to_6m,
	transaction_card_transfer_c_trans_cnt_1m / NULLIF(transaction_total_trans_cnt_1m, 0) AS transaction_card_transfer_c_trans_cnt_1m_to_total_1m,
	transaction_card_transfer_c_trans_sum_1m / NULLIF(transaction_total_trans_sum_1m, 0) AS transaction_card_transfer_c_trans_sum_1m_to_total_1m,
	transaction_card_transfer_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_3m, 0) AS transaction_card_transfer_c_trans_cnt_3m_to_total_3m,
	transaction_card_transfer_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_3m, 0) AS transaction_card_transfer_c_trans_sum_3m_to_total_3m,
	transaction_card_transfer_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_card_transfer_c_trans_cnt_3m_to_total_6m,
	transaction_card_transfer_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_card_transfer_c_trans_sum_3m_to_total_6m,
	transaction_card_transfer_c_trans_cnt_6m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_card_transfer_c_trans_cnt_6m_to_total_6m,
	transaction_card_transfer_c_trans_sum_6m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_card_transfer_c_trans_sum_6m_to_total_6m,
	transaction_card_transfer_c_trans_avg_sum_1m / NULLIF(transaction_card_transfer_c_trans_avg_sum_3m, 0) AS transaction_card_transfer_c_trans_avg_sum_1m_to_3m,
	transaction_card_transfer_c_trans_avg_cnt_1m / NULLIF(transaction_card_transfer_c_trans_avg_cnt_3m, 0) AS transaction_card_transfer_c_trans_avg_cnt_1m_to_3m,
	transaction_card_transfer_c_trans_avg_sum_3m / NULLIF(transaction_card_transfer_c_trans_avg_sum_6m, 0) AS transaction_card_transfer_c_trans_avg_sum_3m_to_6m,
	transaction_card_transfer_c_trans_avg_cnt_3m / NULLIF(transaction_card_transfer_c_trans_avg_cnt_6m, 0) AS transaction_card_transfer_c_trans_avg_cnt_3m_to_6m,
	transaction_card_transfer_c_trans_avg_sum_1m / NULLIF(transaction_total_trans_avg_sum_1m, 0) AS transaction_card_transfer_c_trans_avg_sum_1m_to_total_1m,
	transaction_card_transfer_c_trans_avg_cnt_1m / NULLIF(transaction_total_trans_avg_cnt_1m, 0) AS transaction_card_transfer_c_trans_avg_cnt_1m_to_total_1m,
	transaction_card_transfer_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_3m, 0) AS transaction_card_transfer_c_trans_avg_sum_3m_to_total_3m,
	transaction_card_transfer_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_3m, 0) AS transaction_card_transfer_c_trans_avg_cnt_3m_to_total_3m,
	transaction_card_transfer_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_card_transfer_c_trans_avg_sum_3m_to_total_6m,
	transaction_card_transfer_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_card_transfer_c_trans_avg_cnt_3m_to_total_6m,
	transaction_card_transfer_c_trans_avg_sum_6m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_card_transfer_c_trans_avg_sum_6m_to_total_6m,
	transaction_card_transfer_c_trans_avg_cnt_6m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_card_transfer_c_trans_avg_cnt_6m_to_total_6m,

	transaction_money_transfers_c_trans_cnt_1m / NULLIF(transaction_money_transfers_c_trans_cnt_3m, 0) AS transaction_money_transfers_c_trans_cnt_1m_to_3m,
	transaction_money_transfers_c_trans_sum_1m / NULLIF(transaction_money_transfers_c_trans_sum_3m, 0) AS transaction_money_transfers_c_trans_sum_1m_to_3m,
	transaction_money_transfers_c_trans_cnt_3m / NULLIF(transaction_money_transfers_c_trans_cnt_6m, 0) AS transaction_money_transfers_c_trans_cnt_3m_to_6m,
	transaction_money_transfers_c_trans_sum_3m / NULLIF(transaction_money_transfers_c_trans_sum_6m, 0) AS transaction_money_transfers_c_trans_sum_3m_to_6m,
	transaction_money_transfers_c_trans_cnt_1m / NULLIF(transaction_total_trans_cnt_1m, 0) AS transaction_money_transfers_c_trans_cnt_1m_to_total_1m,
	transaction_money_transfers_c_trans_sum_1m / NULLIF(transaction_total_trans_sum_1m, 0) AS transaction_money_transfers_c_trans_sum_1m_to_total_1m,
	transaction_money_transfers_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_3m, 0) AS transaction_money_transfers_c_trans_cnt_3m_to_total_3m,
	transaction_money_transfers_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_3m, 0) AS transaction_money_transfers_c_trans_sum_3m_to_total_3m,
	transaction_money_transfers_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_money_transfers_c_trans_cnt_3m_to_total_6m,
	transaction_money_transfers_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_money_transfers_c_trans_sum_3m_to_total_6m,
	transaction_money_transfers_c_trans_cnt_6m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_money_transfers_c_trans_cnt_6m_to_total_6m,
	transaction_money_transfers_c_trans_sum_6m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_money_transfers_c_trans_sum_6m_to_total_6m,
	transaction_money_transfers_c_trans_avg_sum_1m / NULLIF(transaction_money_transfers_c_trans_avg_sum_3m, 0) AS transaction_money_transfers_c_trans_avg_sum_1m_to_3m,
	transaction_money_transfers_c_trans_avg_cnt_1m / NULLIF(transaction_money_transfers_c_trans_avg_cnt_3m, 0) AS transaction_money_transfers_c_trans_avg_cnt_1m_to_3m,
	transaction_money_transfers_c_trans_avg_sum_3m / NULLIF(transaction_money_transfers_c_trans_avg_sum_6m, 0) AS transaction_money_transfers_c_trans_avg_sum_3m_to_6m,
	transaction_money_transfers_c_trans_avg_cnt_3m / NULLIF(transaction_money_transfers_c_trans_avg_cnt_6m, 0) AS transaction_money_transfers_c_trans_avg_cnt_3m_to_6m,
	transaction_money_transfers_c_trans_avg_sum_1m / NULLIF(transaction_total_trans_avg_sum_1m, 0) AS transaction_money_transfers_c_trans_avg_sum_1m_to_total_1m,
	transaction_money_transfers_c_trans_avg_cnt_1m / NULLIF(transaction_total_trans_avg_cnt_1m, 0) AS transaction_money_transfers_c_trans_avg_cnt_1m_to_total_1m,
	transaction_money_transfers_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_3m, 0) AS transaction_money_transfers_c_trans_avg_sum_3m_to_total_3m,
	transaction_money_transfers_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_3m, 0) AS transaction_money_transfers_c_trans_avg_cnt_3m_to_total_3m,
	transaction_money_transfers_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_money_transfers_c_trans_avg_sum_3m_to_total_6m,
	transaction_money_transfers_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_money_transfers_c_trans_avg_cnt_3m_to_total_6m,
	transaction_money_transfers_c_trans_avg_sum_6m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_money_transfers_c_trans_avg_sum_6m_to_total_6m,
	transaction_money_transfers_c_trans_avg_cnt_6m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_money_transfers_c_trans_avg_cnt_6m_to_total_6m,


	transaction_cash_c_trans_cnt_1m / NULLIF(transaction_cash_c_trans_cnt_3m, 0) AS transaction_cash_c_trans_cnt_1m_to_3m,
	transaction_cash_c_trans_sum_1m / NULLIF(transaction_cash_c_trans_sum_3m, 0) AS transaction_cash_c_trans_sum_1m_to_3m,
	transaction_cash_c_trans_cnt_3m / NULLIF(transaction_cash_c_trans_cnt_6m, 0) AS transaction_cash_c_trans_cnt_3m_to_6m,
	transaction_cash_c_trans_sum_3m / NULLIF(transaction_cash_c_trans_sum_6m, 0) AS transaction_cash_c_trans_sum_3m_to_6m,
	transaction_cash_c_trans_cnt_1m / NULLIF(transaction_total_trans_cnt_1m, 0) AS transaction_cash_c_trans_cnt_1m_to_total_1m,
	transaction_cash_c_trans_sum_1m / NULLIF(transaction_total_trans_sum_1m, 0) AS transaction_cash_c_trans_sum_1m_to_total_1m,
	transaction_cash_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_3m, 0) AS transaction_cash_c_trans_cnt_3m_to_total_3m,
	transaction_cash_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_3m, 0) AS transaction_cash_c_trans_sum_3m_to_total_3m,
	transaction_cash_c_trans_cnt_3m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_cash_c_trans_cnt_3m_to_total_6m,
	transaction_cash_c_trans_sum_3m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_cash_c_trans_sum_3m_to_total_6m,
	transaction_cash_c_trans_cnt_6m / NULLIF(transaction_total_trans_cnt_6m, 0) AS transaction_cash_c_trans_cnt_6m_to_total_6m,
	transaction_cash_c_trans_sum_6m / NULLIF(transaction_total_trans_sum_6m, 0) AS transaction_cash_c_trans_sum_6m_to_total_6m,
	transaction_cash_c_trans_avg_sum_1m / NULLIF(transaction_cash_c_trans_avg_sum_3m, 0) AS transaction_cash_c_trans_avg_sum_1m_to_3m,
	transaction_cash_c_trans_avg_cnt_1m / NULLIF(transaction_cash_c_trans_avg_cnt_3m, 0) AS transaction_cash_c_trans_avg_cnt_1m_to_3m,
	transaction_cash_c_trans_avg_sum_3m / NULLIF(transaction_cash_c_trans_avg_sum_6m, 0) AS transaction_cash_c_trans_avg_sum_3m_to_6m,
	transaction_cash_c_trans_avg_cnt_3m / NULLIF(transaction_cash_c_trans_avg_cnt_6m, 0) AS transaction_cash_c_trans_avg_cnt_3m_to_6m,
	transaction_cash_c_trans_avg_sum_1m / NULLIF(transaction_total_trans_avg_sum_1m, 0) AS transaction_cash_c_trans_avg_sum_1m_to_total_1m,
	transaction_cash_c_trans_avg_cnt_1m / NULLIF(transaction_total_trans_avg_cnt_1m, 0) AS transaction_cash_c_trans_avg_cnt_1m_to_total_1m,
	transaction_cash_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_3m, 0) AS transaction_cash_c_trans_avg_sum_3m_to_total_3m,
	transaction_cash_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_3m, 0) AS transaction_cash_c_trans_avg_cnt_3m_to_total_3m,
	transaction_cash_c_trans_avg_sum_3m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_cash_c_trans_avg_sum_3m_to_total_6m,
	transaction_cash_c_trans_avg_cnt_3m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_cash_c_trans_avg_cnt_3m_to_total_6m,
	transaction_cash_c_trans_avg_sum_6m / NULLIF(transaction_total_trans_avg_sum_6m, 0) AS transaction_cash_c_trans_avg_sum_6m_to_total_6m,
	transaction_cash_c_trans_avg_cnt_6m / NULLIF(transaction_total_trans_avg_cnt_6m, 0) AS transaction_cash_c_trans_avg_cnt_6m_to_total_6m

from '||in_table||' a
LEFT JOIN '||in_table||'_TRANS_TEMP_0 t0
    ON t0.client_did = a.client_did
    AND t0.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_15 t15
    ON t15.client_did = a.client_did
    AND t15.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_34 t34
    ON t34.client_did = a.client_did
    AND t34.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_37 t37
    ON t37.client_did = a.client_did
    AND t37.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_45 t45
    ON t45.client_did = a.client_did
    AND t45.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_46 t46
    ON t46.client_did = a.client_did
    AND t46.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_47 t47
    ON t47.client_did = a.client_did
    AND t47.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_62 t62
    ON t62.client_did = a.client_did
    AND t62.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_81 t81
    ON t81.client_did = a.client_did
    AND t81.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_84 t84
    ON t84.client_did = a.client_did
    AND t84.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_00 t00
    ON t00.client_did = a.client_did
    AND t00.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_92 t92
    ON t92.client_did = a.client_did
    AND t92.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_93 t93
    ON t93.client_did = a.client_did
    AND t93.report_date = a.report_date
';

dbms_lob.append(my_str, add_str);

execute immediate my_str;



my_str := '
create table '||out_table_3|| ' as
select /* +parallel(16)+ */
	a.client_did,
	a.report_date,

	transaction_dom_rem_trans_cnt_1m_to_3m,
	transaction_dom_rem_trans_sum_1m_to_3m,
	transaction_dom_rem_trans_cnt_3m_to_6m,
	transaction_dom_rem_trans_sum_3m_to_6m,
	transaction_dom_rem_trans_cnt_1m_to_total_1m,
	transaction_dom_rem_trans_sum_1m_to_total_1m,
	transaction_dom_rem_trans_cnt_3m_to_total_3m,
	transaction_dom_rem_trans_sum_3m_to_total_3m,
	transaction_dom_rem_trans_cnt_3m_to_total_6m,
	transaction_dom_rem_trans_sum_3m_to_total_6m,
	transaction_dom_rem_trans_cnt_6m_to_total_6m,
	transaction_dom_rem_trans_sum_6m_to_total_6m,
	transaction_dom_rem_trans_avg_sum_1m_to_3m,
	transaction_dom_rem_trans_avg_cnt_1m_to_3m,
	transaction_dom_rem_trans_avg_sum_3m_to_6m,
	transaction_dom_rem_trans_avg_cnt_3m_to_6m,
	transaction_dom_rem_trans_avg_sum_1m_to_total_1m,
	transaction_dom_rem_trans_avg_cnt_1m_to_total_1m,
	transaction_dom_rem_trans_avg_sum_3m_to_total_3m,
	transaction_dom_rem_trans_avg_cnt_3m_to_total_3m,
	transaction_dom_rem_trans_avg_sum_3m_to_total_6m,
	transaction_dom_rem_trans_avg_cnt_3m_to_total_6m,
	transaction_dom_rem_trans_avg_sum_6m_to_total_6m,
	transaction_dom_rem_trans_avg_cnt_6m_to_total_6m,

	transaction_cafe_trans_cnt_1m_to_3m,
	transaction_cafe_trans_sum_1m_to_3m,
	transaction_cafe_trans_cnt_3m_to_6m,
	transaction_cafe_trans_sum_3m_to_6m,
	transaction_cafe_trans_cnt_1m_to_total_1m,
	transaction_cafe_trans_sum_1m_to_total_1m,
	transaction_cafe_trans_cnt_3m_to_total_3m,
	transaction_cafe_trans_sum_3m_to_total_3m,
	transaction_cafe_trans_cnt_3m_to_total_6m,
	transaction_cafe_trans_sum_3m_to_total_6m,
	transaction_cafe_trans_cnt_6m_to_total_6m,
	transaction_cafe_trans_sum_6m_to_total_6m,
	transaction_cafe_trans_avg_sum_1m_to_3m,
	transaction_cafe_trans_avg_cnt_1m_to_3m,
	transaction_cafe_trans_avg_sum_3m_to_6m,
	transaction_cafe_trans_avg_cnt_3m_to_6m,
	transaction_cafe_trans_avg_sum_1m_to_total_1m,
	transaction_cafe_trans_avg_cnt_1m_to_total_1m,
	transaction_cafe_trans_avg_sum_3m_to_total_3m,
	transaction_cafe_trans_avg_cnt_3m_to_total_3m,
	transaction_cafe_trans_avg_sum_3m_to_total_6m,
	transaction_cafe_trans_avg_cnt_3m_to_total_6m,
	transaction_cafe_trans_avg_sum_6m_to_total_6m,
	transaction_cafe_trans_avg_cnt_6m_to_total_6m,

	transaction_rent_auto_trans_cnt_1m_to_3m,
	transaction_rent_auto_trans_sum_1m_to_3m,
	transaction_rent_auto_trans_cnt_3m_to_6m,
	transaction_rent_auto_trans_sum_3m_to_6m,
	transaction_rent_auto_trans_cnt_1m_to_total_1m,
	transaction_rent_auto_trans_sum_1m_to_total_1m,
	transaction_rent_auto_trans_cnt_3m_to_total_3m,
	transaction_rent_auto_trans_sum_3m_to_total_3m,
	transaction_rent_auto_trans_cnt_3m_to_total_6m,
	transaction_rent_auto_trans_sum_3m_to_total_6m,
	transaction_rent_auto_trans_cnt_6m_to_total_6m,
	transaction_rent_auto_trans_sum_6m_to_total_6m,
	transaction_rent_auto_trans_avg_sum_1m_to_3m,
	transaction_rent_auto_trans_avg_cnt_1m_to_3m,
	transaction_rent_auto_trans_avg_sum_3m_to_6m,
	transaction_rent_auto_trans_avg_cnt_3m_to_6m,
	transaction_rent_auto_trans_avg_sum_1m_to_total_1m,
	transaction_rent_auto_trans_avg_cnt_1m_to_total_1m,
	transaction_rent_auto_trans_avg_sum_3m_to_total_3m,
	transaction_rent_auto_trans_avg_cnt_3m_to_total_3m,
	transaction_rent_auto_trans_avg_sum_3m_to_total_6m,
	transaction_rent_auto_trans_avg_cnt_3m_to_total_6m,
	transaction_rent_auto_trans_avg_sum_6m_to_total_6m,
	transaction_rent_auto_trans_avg_cnt_6m_to_total_6m,

	transaction_transport_trans_cnt_1m_to_3m,
	transaction_transport_trans_sum_1m_to_3m,
	transaction_transport_trans_cnt_3m_to_6m,
	transaction_transport_trans_sum_3m_to_6m,
	transaction_transport_trans_cnt_1m_to_total_1m,
	transaction_transport_trans_sum_1m_to_total_1m,
	transaction_transport_trans_cnt_3m_to_total_3m,
	transaction_transport_trans_sum_3m_to_total_3m,
	transaction_transport_trans_cnt_3m_to_total_6m,
	transaction_transport_trans_sum_3m_to_total_6m,
	transaction_transport_trans_cnt_6m_to_total_6m,
	transaction_transport_trans_sum_6m_to_total_6m,
	transaction_transport_trans_avg_sum_1m_to_3m,
	transaction_transport_trans_avg_cnt_1m_to_3m,
	transaction_transport_trans_avg_sum_3m_to_6m,
	transaction_transport_trans_avg_cnt_3m_to_6m,
	transaction_transport_trans_avg_sum_1m_to_total_1m,
	transaction_transport_trans_avg_cnt_1m_to_total_1m,
	transaction_transport_trans_avg_sum_3m_to_total_3m,
	transaction_transport_trans_avg_cnt_3m_to_total_3m,
	transaction_transport_trans_avg_sum_3m_to_total_6m,
	transaction_transport_trans_avg_cnt_3m_to_total_6m,
	transaction_transport_trans_avg_sum_6m_to_total_6m,
	transaction_transport_trans_avg_cnt_6m_to_total_6m,

	transaction_travel_trans_cnt_1m_to_3m,
	transaction_travel_trans_sum_1m_to_3m,
	transaction_travel_trans_cnt_3m_to_6m,
	transaction_travel_trans_sum_3m_to_6m,
	transaction_travel_trans_cnt_1m_to_total_1m,
	transaction_travel_trans_sum_1m_to_total_1m,
	transaction_travel_trans_cnt_3m_to_total_3m,
	transaction_travel_trans_sum_3m_to_total_3m,
	transaction_travel_trans_cnt_3m_to_total_6m,
	transaction_travel_trans_sum_3m_to_total_6m,
	transaction_travel_trans_cnt_6m_to_total_6m,
	transaction_travel_trans_sum_6m_to_total_6m,
	transaction_travel_trans_avg_sum_1m_to_3m,
	transaction_travel_trans_avg_cnt_1m_to_3m,
	transaction_travel_trans_avg_sum_3m_to_6m,
	transaction_travel_trans_avg_cnt_3m_to_6m,
	transaction_travel_trans_avg_sum_1m_to_total_1m,
	transaction_travel_trans_avg_cnt_1m_to_total_1m,
	transaction_travel_trans_avg_sum_3m_to_total_3m,
	transaction_travel_trans_avg_cnt_3m_to_total_3m,
	transaction_travel_trans_avg_sum_3m_to_total_6m,
	transaction_travel_trans_avg_cnt_3m_to_total_6m,
	transaction_travel_trans_avg_sum_6m_to_total_6m,
	transaction_travel_trans_avg_cnt_6m_to_total_6m,

	transaction_medicine_trans_cnt_1m_to_3m,
	transaction_medicine_trans_sum_1m_to_3m,
	transaction_medicine_trans_cnt_3m_to_6m,
	transaction_medicine_trans_sum_3m_to_6m,
	transaction_medicine_trans_cnt_1m_to_total_1m,
	transaction_medicine_trans_sum_1m_to_total_1m,
	transaction_medicine_trans_cnt_3m_to_total_3m,
	transaction_medicine_trans_sum_3m_to_total_3m,
	transaction_medicine_trans_cnt_3m_to_total_6m,
	transaction_medicine_trans_sum_3m_to_total_6m,
	transaction_medicine_trans_cnt_6m_to_total_6m,
	transaction_medicine_trans_sum_6m_to_total_6m,
	transaction_medicine_trans_avg_sum_1m_to_3m,
	transaction_medicine_trans_avg_cnt_1m_to_3m,
	transaction_medicine_trans_avg_sum_3m_to_6m,
	transaction_medicine_trans_avg_cnt_3m_to_6m,
	transaction_medicine_trans_avg_sum_1m_to_total_1m,
	transaction_medicine_trans_avg_cnt_1m_to_total_1m,
	transaction_medicine_trans_avg_sum_3m_to_total_3m,
	transaction_medicine_trans_avg_cnt_3m_to_total_3m,
	transaction_medicine_trans_avg_sum_3m_to_total_6m,
	transaction_medicine_trans_avg_cnt_3m_to_total_6m,
	transaction_medicine_trans_avg_sum_6m_to_total_6m,
	transaction_medicine_trans_avg_cnt_6m_to_total_6m,
';

add_str:='
	transaction_online_shops_trans_cnt_1m_to_3m,
	transaction_online_shops_trans_sum_1m_to_3m,
	transaction_online_shops_trans_cnt_3m_to_6m,
	transaction_online_shops_trans_sum_3m_to_6m,
	transaction_online_shops_trans_cnt_1m_to_total_1m,
	transaction_online_shops_trans_sum_1m_to_total_1m,
	transaction_online_shops_trans_cnt_3m_to_total_3m,
	transaction_online_shops_trans_sum_3m_to_total_3m,
	transaction_online_shops_trans_cnt_3m_to_total_6m,
	transaction_online_shops_trans_sum_3m_to_total_6m,
	transaction_online_shops_trans_cnt_6m_to_total_6m,
	transaction_online_shops_trans_sum_6m_to_total_6m,
	transaction_online_shops_trans_avg_sum_1m_to_3m,
	transaction_online_shops_trans_avg_cnt_1m_to_3m,
	transaction_online_shops_trans_avg_sum_3m_to_6m,
	transaction_online_shops_trans_avg_cnt_3m_to_6m,
	transaction_online_shops_trans_avg_sum_1m_to_total_1m,
	transaction_online_shops_trans_avg_cnt_1m_to_total_1m,
	transaction_online_shops_trans_avg_sum_3m_to_total_3m,
	transaction_online_shops_trans_avg_cnt_3m_to_total_3m,
	transaction_online_shops_trans_avg_sum_3m_to_total_6m,
	transaction_online_shops_trans_avg_cnt_3m_to_total_6m,
	transaction_online_shops_trans_avg_sum_6m_to_total_6m,
	transaction_online_shops_trans_avg_cnt_6m_to_total_6m,

	transaction_music_trans_cnt_1m_to_3m,
	transaction_music_trans_sum_1m_to_3m,
	transaction_music_trans_cnt_3m_to_6m,
	transaction_music_trans_sum_3m_to_6m,
	transaction_music_trans_cnt_1m_to_total_1m,
	transaction_music_trans_sum_1m_to_total_1m,
	transaction_music_trans_cnt_3m_to_total_3m,
	transaction_music_trans_sum_3m_to_total_3m,
	transaction_music_trans_cnt_3m_to_total_6m,
	transaction_music_trans_sum_3m_to_total_6m,
	transaction_music_trans_cnt_6m_to_total_6m,
	transaction_music_trans_sum_6m_to_total_6m,
	transaction_music_trans_avg_sum_1m_to_3m,
	transaction_music_trans_avg_cnt_1m_to_3m,
	transaction_music_trans_avg_sum_3m_to_6m,
	transaction_music_trans_avg_cnt_3m_to_6m,
	transaction_music_trans_avg_sum_1m_to_total_1m,
	transaction_music_trans_avg_cnt_1m_to_total_1m,
	transaction_music_trans_avg_sum_3m_to_total_3m,
	transaction_music_trans_avg_cnt_3m_to_total_3m,
	transaction_music_trans_avg_sum_3m_to_total_6m,
	transaction_music_trans_avg_cnt_3m_to_total_6m,
	transaction_music_trans_avg_sum_6m_to_total_6m,
	transaction_music_trans_avg_cnt_6m_to_total_6m,

	transaction_lombards_trans_cnt_1m_to_3m,
	transaction_lombards_trans_sum_1m_to_3m,
	transaction_lombards_trans_cnt_3m_to_6m,
	transaction_lombards_trans_sum_3m_to_6m,
	transaction_lombards_trans_cnt_1m_to_total_1m,
	transaction_lombards_trans_sum_1m_to_total_1m,
	transaction_lombards_trans_cnt_3m_to_total_3m,
	transaction_lombards_trans_sum_3m_to_total_3m,
	transaction_lombards_trans_cnt_3m_to_total_6m,
	transaction_lombards_trans_sum_3m_to_total_6m,
	transaction_lombards_trans_cnt_6m_to_total_6m,
	transaction_lombards_trans_sum_6m_to_total_6m,
	transaction_lombards_trans_avg_sum_1m_to_3m,
	transaction_lombards_trans_avg_cnt_1m_to_3m,
	transaction_lombards_trans_avg_sum_3m_to_6m,
	transaction_lombards_trans_avg_cnt_3m_to_6m,
	transaction_lombards_trans_avg_sum_1m_to_total_1m,
	transaction_lombards_trans_avg_cnt_1m_to_total_1m,
	transaction_lombards_trans_avg_sum_3m_to_total_3m,
	transaction_lombards_trans_avg_cnt_3m_to_total_3m,
	transaction_lombards_trans_avg_sum_3m_to_total_6m,
	transaction_lombards_trans_avg_cnt_3m_to_total_6m,
	transaction_lombards_trans_avg_sum_6m_to_total_6m,
	transaction_lombards_trans_avg_cnt_6m_to_total_6m,

	transaction_zoo_trans_cnt_1m_to_3m,
	transaction_zoo_trans_sum_1m_to_3m,
	transaction_zoo_trans_cnt_3m_to_6m,
	transaction_zoo_trans_sum_3m_to_6m,
	transaction_zoo_trans_cnt_1m_to_total_1m,
	transaction_zoo_trans_sum_1m_to_total_1m,
	transaction_zoo_trans_cnt_3m_to_total_3m,
	transaction_zoo_trans_sum_3m_to_total_3m,
	transaction_zoo_trans_cnt_3m_to_total_6m,
	transaction_zoo_trans_sum_3m_to_total_6m,
	transaction_zoo_trans_cnt_6m_to_total_6m,
	transaction_zoo_trans_sum_6m_to_total_6m,
	transaction_zoo_trans_avg_sum_1m_to_3m,
	transaction_zoo_trans_avg_cnt_1m_to_3m,
	transaction_zoo_trans_avg_sum_3m_to_6m,
	transaction_zoo_trans_avg_cnt_3m_to_6m,
	transaction_zoo_trans_avg_sum_1m_to_total_1m,
	transaction_zoo_trans_avg_cnt_1m_to_total_1m,
	transaction_zoo_trans_avg_sum_3m_to_total_3m,
	transaction_zoo_trans_avg_cnt_3m_to_total_3m,
	transaction_zoo_trans_avg_sum_3m_to_total_6m,
	transaction_zoo_trans_avg_cnt_3m_to_total_6m,
	transaction_zoo_trans_avg_sum_6m_to_total_6m,
	transaction_zoo_trans_avg_cnt_6m_to_total_6m,

	transaction_air_tickets_trans_cnt_1m_to_3m,
	transaction_air_tickets_trans_sum_1m_to_3m,
	transaction_air_tickets_trans_cnt_3m_to_6m,
	transaction_air_tickets_trans_sum_3m_to_6m,
	transaction_air_tickets_trans_cnt_1m_to_total_1m,
	transaction_air_tickets_trans_sum_1m_to_total_1m,
	transaction_air_tickets_trans_cnt_3m_to_total_3m,
	transaction_air_tickets_trans_sum_3m_to_total_3m,
	transaction_air_tickets_trans_cnt_3m_to_total_6m,
	transaction_air_tickets_trans_sum_3m_to_total_6m,
	transaction_air_tickets_trans_cnt_6m_to_total_6m,
	transaction_air_tickets_trans_sum_6m_to_total_6m,
	transaction_air_tickets_trans_avg_sum_1m_to_3m,
	transaction_air_tickets_trans_avg_cnt_1m_to_3m,
	transaction_air_tickets_trans_avg_sum_3m_to_6m,
	transaction_air_tickets_trans_avg_cnt_3m_to_6m,
	transaction_air_tickets_trans_avg_sum_1m_to_total_1m,
	transaction_air_tickets_trans_avg_cnt_1m_to_total_1m,
	transaction_air_tickets_trans_avg_sum_3m_to_total_3m,
	transaction_air_tickets_trans_avg_cnt_3m_to_total_3m,
	transaction_air_tickets_trans_avg_sum_3m_to_total_6m,
	transaction_air_tickets_trans_avg_cnt_3m_to_total_6m,
	transaction_air_tickets_trans_avg_sum_6m_to_total_6m,
	transaction_air_tickets_trans_avg_cnt_6m_to_total_6m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_hotels_trans_cnt_1m_to_3m,
	transaction_hotels_trans_sum_1m_to_3m,
	transaction_hotels_trans_cnt_3m_to_6m,
	transaction_hotels_trans_sum_3m_to_6m,
	transaction_hotels_trans_cnt_1m_to_total_1m,
	transaction_hotels_trans_sum_1m_to_total_1m,
	transaction_hotels_trans_cnt_3m_to_total_3m,
	transaction_hotels_trans_sum_3m_to_total_3m,
	transaction_hotels_trans_cnt_3m_to_total_6m,
	transaction_hotels_trans_sum_3m_to_total_6m,
	transaction_hotels_trans_cnt_6m_to_total_6m,
	transaction_hotels_trans_sum_6m_to_total_6m,
	transaction_hotels_trans_avg_sum_1m_to_3m,
	transaction_hotels_trans_avg_cnt_1m_to_3m,
	transaction_hotels_trans_avg_sum_3m_to_6m,
	transaction_hotels_trans_avg_cnt_3m_to_6m,
	transaction_hotels_trans_avg_sum_1m_to_total_1m,
	transaction_hotels_trans_avg_cnt_1m_to_total_1m,
	transaction_hotels_trans_avg_sum_3m_to_total_3m,
	transaction_hotels_trans_avg_cnt_3m_to_total_3m,
	transaction_hotels_trans_avg_sum_3m_to_total_6m,
	transaction_hotels_trans_avg_cnt_3m_to_total_6m,
	transaction_hotels_trans_avg_sum_6m_to_total_6m,
	transaction_hotels_trans_avg_cnt_6m_to_total_6m,

	transaction_courier_trans_cnt_1m_to_3m,
	transaction_courier_trans_sum_1m_to_3m,
	transaction_courier_trans_cnt_3m_to_6m,
	transaction_courier_trans_sum_3m_to_6m,
	transaction_courier_trans_cnt_1m_to_total_1m,
	transaction_courier_trans_sum_1m_to_total_1m,
	transaction_courier_trans_cnt_3m_to_total_3m,
	transaction_courier_trans_sum_3m_to_total_3m,
	transaction_courier_trans_cnt_3m_to_total_6m,
	transaction_courier_trans_sum_3m_to_total_6m,
	transaction_courier_trans_cnt_6m_to_total_6m,
	transaction_courier_trans_sum_6m_to_total_6m,
	transaction_courier_trans_avg_sum_1m_to_3m,
	transaction_courier_trans_avg_cnt_1m_to_3m,
	transaction_courier_trans_avg_sum_3m_to_6m,
	transaction_courier_trans_avg_cnt_3m_to_6m,
	transaction_courier_trans_avg_sum_1m_to_total_1m,
	transaction_courier_trans_avg_cnt_1m_to_total_1m,
	transaction_courier_trans_avg_sum_3m_to_total_3m,
	transaction_courier_trans_avg_cnt_3m_to_total_3m,
	transaction_courier_trans_avg_sum_3m_to_total_6m,
	transaction_courier_trans_avg_cnt_3m_to_total_6m,
	transaction_courier_trans_avg_sum_6m_to_total_6m,
	transaction_courier_trans_avg_cnt_6m_to_total_6m,

	transaction_souvenirs_trans_cnt_1m_to_3m,
	transaction_souvenirs_trans_sum_1m_to_3m,
	transaction_souvenirs_trans_cnt_3m_to_6m,
	transaction_souvenirs_trans_sum_3m_to_6m,
	transaction_souvenirs_trans_cnt_1m_to_total_1m,
	transaction_souvenirs_trans_sum_1m_to_total_1m,
	transaction_souvenirs_trans_cnt_3m_to_total_3m,
	transaction_souvenirs_trans_sum_3m_to_total_3m,
	transaction_souvenirs_trans_cnt_3m_to_total_6m,
	transaction_souvenirs_trans_sum_3m_to_total_6m,
	transaction_souvenirs_trans_cnt_6m_to_total_6m,
	transaction_souvenirs_trans_sum_6m_to_total_6m,
	transaction_souvenirs_trans_avg_sum_1m_to_3m,
	transaction_souvenirs_trans_avg_cnt_1m_to_3m,
	transaction_souvenirs_trans_avg_sum_3m_to_6m,
	transaction_souvenirs_trans_avg_cnt_3m_to_6m,
	transaction_souvenirs_trans_avg_sum_1m_to_total_1m,
	transaction_souvenirs_trans_avg_cnt_1m_to_total_1m,
	transaction_souvenirs_trans_avg_sum_3m_to_total_3m,
	transaction_souvenirs_trans_avg_cnt_3m_to_total_3m,
	transaction_souvenirs_trans_avg_sum_3m_to_total_6m,
	transaction_souvenirs_trans_avg_cnt_3m_to_total_6m,
	transaction_souvenirs_trans_avg_sum_6m_to_total_6m,
	transaction_souvenirs_trans_avg_cnt_6m_to_total_6m,

	transaction_fun_trans_cnt_1m_to_3m,
	transaction_fun_trans_sum_1m_to_3m,
	transaction_fun_trans_cnt_3m_to_6m,
	transaction_fun_trans_sum_3m_to_6m,
	transaction_fun_trans_cnt_1m_to_total_1m,
	transaction_fun_trans_sum_1m_to_total_1m,
	transaction_fun_trans_cnt_3m_to_total_3m,
	transaction_fun_trans_sum_3m_to_total_3m,
	transaction_fun_trans_cnt_3m_to_total_6m,
	transaction_fun_trans_sum_3m_to_total_6m,
	transaction_fun_trans_cnt_6m_to_total_6m,
	transaction_fun_trans_sum_6m_to_total_6m,
	transaction_fun_trans_avg_sum_1m_to_3m,
	transaction_fun_trans_avg_cnt_1m_to_3m,
	transaction_fun_trans_avg_sum_3m_to_6m,
	transaction_fun_trans_avg_cnt_3m_to_6m,
	transaction_fun_trans_avg_sum_1m_to_total_1m,
	transaction_fun_trans_avg_cnt_1m_to_total_1m,
	transaction_fun_trans_avg_sum_3m_to_total_3m,
	transaction_fun_trans_avg_cnt_3m_to_total_3m,
	transaction_fun_trans_avg_sum_3m_to_total_6m,
	transaction_fun_trans_avg_cnt_3m_to_total_6m,
	transaction_fun_trans_avg_sum_6m_to_total_6m,
	transaction_fun_trans_avg_cnt_6m_to_total_6m,

	transaction_taxes_fines_trans_cnt_1m_to_3m,
	transaction_taxes_fines_trans_sum_1m_to_3m,
	transaction_taxes_fines_trans_cnt_3m_to_6m,
	transaction_taxes_fines_trans_sum_3m_to_6m,
	transaction_taxes_fines_trans_cnt_1m_to_total_1m,
	transaction_taxes_fines_trans_sum_1m_to_total_1m,
	transaction_taxes_fines_trans_cnt_3m_to_total_3m,
	transaction_taxes_fines_trans_sum_3m_to_total_3m,
	transaction_taxes_fines_trans_cnt_3m_to_total_6m,
	transaction_taxes_fines_trans_sum_3m_to_total_6m,
	transaction_taxes_fines_trans_cnt_6m_to_total_6m,
	transaction_taxes_fines_trans_sum_6m_to_total_6m,
	transaction_taxes_fines_trans_avg_sum_1m_to_3m,
	transaction_taxes_fines_trans_avg_cnt_1m_to_3m,
	transaction_taxes_fines_trans_avg_sum_3m_to_6m,
	transaction_taxes_fines_trans_avg_cnt_3m_to_6m,
	transaction_taxes_fines_trans_avg_sum_1m_to_total_1m,
	transaction_taxes_fines_trans_avg_cnt_1m_to_total_1m,
	transaction_taxes_fines_trans_avg_sum_3m_to_total_3m,
	transaction_taxes_fines_trans_avg_cnt_3m_to_total_3m,
	transaction_taxes_fines_trans_avg_sum_3m_to_total_6m,
	transaction_taxes_fines_trans_avg_cnt_3m_to_total_6m,
	transaction_taxes_fines_trans_avg_sum_6m_to_total_6m,
	transaction_taxes_fines_trans_avg_cnt_6m_to_total_6m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_supermarkets_trans_cnt_1m_to_3m,
	transaction_supermarkets_trans_sum_1m_to_3m,
	transaction_supermarkets_trans_cnt_3m_to_6m,
	transaction_supermarkets_trans_sum_3m_to_6m,
	transaction_supermarkets_trans_cnt_1m_to_total_1m,
	transaction_supermarkets_trans_sum_1m_to_total_1m,
	transaction_supermarkets_trans_cnt_3m_to_total_3m,
	transaction_supermarkets_trans_sum_3m_to_total_3m,
	transaction_supermarkets_trans_cnt_3m_to_total_6m,
	transaction_supermarkets_trans_sum_3m_to_total_6m,
	transaction_supermarkets_trans_cnt_6m_to_total_6m,
	transaction_supermarkets_trans_sum_6m_to_total_6m,
	transaction_supermarkets_trans_avg_sum_1m_to_3m,
	transaction_supermarkets_trans_avg_cnt_1m_to_3m,
	transaction_supermarkets_trans_avg_sum_3m_to_6m,
	transaction_supermarkets_trans_avg_cnt_3m_to_6m,
	transaction_supermarkets_trans_avg_sum_1m_to_total_1m,
	transaction_supermarkets_trans_avg_cnt_1m_to_total_1m,
	transaction_supermarkets_trans_avg_sum_3m_to_total_3m,
	transaction_supermarkets_trans_avg_cnt_3m_to_total_3m,
	transaction_supermarkets_trans_avg_sum_3m_to_total_6m,
	transaction_supermarkets_trans_avg_cnt_3m_to_total_6m,
	transaction_supermarkets_trans_avg_sum_6m_to_total_6m,
	transaction_supermarkets_trans_avg_cnt_6m_to_total_6m,

	transaction_sport_trans_cnt_1m_to_3m,
	transaction_sport_trans_sum_1m_to_3m,
	transaction_sport_trans_cnt_3m_to_6m,
	transaction_sport_trans_sum_3m_to_6m,
	transaction_sport_trans_cnt_1m_to_total_1m,
	transaction_sport_trans_sum_1m_to_total_1m,
	transaction_sport_trans_cnt_3m_to_total_3m,
	transaction_sport_trans_sum_3m_to_total_3m,
	transaction_sport_trans_cnt_3m_to_total_6m,
	transaction_sport_trans_sum_3m_to_total_6m,
	transaction_sport_trans_cnt_6m_to_total_6m,
	transaction_sport_trans_sum_6m_to_total_6m,
	transaction_sport_trans_avg_sum_1m_to_3m,
	transaction_sport_trans_avg_cnt_1m_to_3m,
	transaction_sport_trans_avg_sum_3m_to_6m,
	transaction_sport_trans_avg_cnt_3m_to_6m,
	transaction_sport_trans_avg_sum_1m_to_total_1m,
	transaction_sport_trans_avg_cnt_1m_to_total_1m,
	transaction_sport_trans_avg_sum_3m_to_total_3m,
	transaction_sport_trans_avg_cnt_3m_to_total_3m,
	transaction_sport_trans_avg_sum_3m_to_total_6m,
	transaction_sport_trans_avg_cnt_3m_to_total_6m,
	transaction_sport_trans_avg_sum_6m_to_total_6m,
	transaction_sport_trans_avg_cnt_6m_to_total_6m,

	transaction_sber_trans_cnt_1m_to_3m,
	transaction_sber_trans_sum_1m_to_3m,
	transaction_sber_trans_cnt_3m_to_6m,
	transaction_sber_trans_sum_3m_to_6m,
	transaction_sber_trans_cnt_1m_to_total_1m,
	transaction_sber_trans_sum_1m_to_total_1m,
	transaction_sber_trans_cnt_3m_to_total_3m,
	transaction_sber_trans_sum_3m_to_total_3m,
	transaction_sber_trans_cnt_3m_to_total_6m,
	transaction_sber_trans_sum_3m_to_total_6m,
	transaction_sber_trans_cnt_6m_to_total_6m,
	transaction_sber_trans_sum_6m_to_total_6m,
	transaction_sber_trans_avg_sum_1m_to_3m,
	transaction_sber_trans_avg_cnt_1m_to_3m,
	transaction_sber_trans_avg_sum_3m_to_6m,
	transaction_sber_trans_avg_cnt_3m_to_6m,
	transaction_sber_trans_avg_sum_1m_to_total_1m,
	transaction_sber_trans_avg_cnt_1m_to_total_1m,
	transaction_sber_trans_avg_sum_3m_to_total_3m,
	transaction_sber_trans_avg_cnt_3m_to_total_3m,
	transaction_sber_trans_avg_sum_3m_to_total_6m,
	transaction_sber_trans_avg_cnt_3m_to_total_6m,
	transaction_sber_trans_avg_sum_6m_to_total_6m,
	transaction_sber_trans_avg_cnt_6m_to_total_6m,

	transaction_gosuslugi_trans_cnt_1m_to_3m,
	transaction_gosuslugi_trans_sum_1m_to_3m,
	transaction_gosuslugi_trans_cnt_3m_to_6m,
	transaction_gosuslugi_trans_sum_3m_to_6m,
	transaction_gosuslugi_trans_cnt_1m_to_total_1m,
	transaction_gosuslugi_trans_sum_1m_to_total_1m,
	transaction_gosuslugi_trans_cnt_3m_to_total_3m,
	transaction_gosuslugi_trans_sum_3m_to_total_3m,
	transaction_gosuslugi_trans_cnt_3m_to_total_6m,
	transaction_gosuslugi_trans_sum_3m_to_total_6m,
	transaction_gosuslugi_trans_cnt_6m_to_total_6m,
	transaction_gosuslugi_trans_sum_6m_to_total_6m,
	transaction_gosuslugi_trans_avg_sum_1m_to_3m,
	transaction_gosuslugi_trans_avg_cnt_1m_to_3m,
	transaction_gosuslugi_trans_avg_sum_3m_to_6m,
	transaction_gosuslugi_trans_avg_cnt_3m_to_6m,
	transaction_gosuslugi_trans_avg_sum_1m_to_total_1m,
	transaction_gosuslugi_trans_avg_cnt_1m_to_total_1m,
	transaction_gosuslugi_trans_avg_sum_3m_to_total_3m,
	transaction_gosuslugi_trans_avg_cnt_3m_to_total_3m,
	transaction_gosuslugi_trans_avg_sum_3m_to_total_6m,
	transaction_gosuslugi_trans_avg_cnt_3m_to_total_6m,
	transaction_gosuslugi_trans_avg_sum_6m_to_total_6m,
	transaction_gosuslugi_trans_avg_cnt_6m_to_total_6m,

	transaction_art_trans_cnt_1m_to_3m,
	transaction_art_trans_sum_1m_to_3m,
	transaction_art_trans_cnt_3m_to_6m,
	transaction_art_trans_sum_3m_to_6m,
	transaction_art_trans_cnt_1m_to_total_1m,
	transaction_art_trans_sum_1m_to_total_1m,
	transaction_art_trans_cnt_3m_to_total_3m,
	transaction_art_trans_sum_3m_to_total_3m,
	transaction_art_trans_cnt_3m_to_total_6m,
	transaction_art_trans_sum_3m_to_total_6m,
	transaction_art_trans_cnt_6m_to_total_6m,
	transaction_art_trans_sum_6m_to_total_6m,
	transaction_art_trans_avg_sum_1m_to_3m,
	transaction_art_trans_avg_cnt_1m_to_3m,
	transaction_art_trans_avg_sum_3m_to_6m,
	transaction_art_trans_avg_cnt_3m_to_6m,
	transaction_art_trans_avg_sum_1m_to_total_1m,
	transaction_art_trans_avg_cnt_1m_to_total_1m,
	transaction_art_trans_avg_sum_3m_to_total_3m,
	transaction_art_trans_avg_cnt_3m_to_total_3m,
	transaction_art_trans_avg_sum_3m_to_total_6m,
	transaction_art_trans_avg_cnt_3m_to_total_6m,
	transaction_art_trans_avg_sum_6m_to_total_6m,
	transaction_art_trans_avg_cnt_6m_to_total_6m,

	transaction_pharmacies_trans_cnt_1m_to_3m,
	transaction_pharmacies_trans_sum_1m_to_3m,
	transaction_pharmacies_trans_cnt_3m_to_6m,
	transaction_pharmacies_trans_sum_3m_to_6m,
	transaction_pharmacies_trans_cnt_1m_to_total_1m,
	transaction_pharmacies_trans_sum_1m_to_total_1m,
	transaction_pharmacies_trans_cnt_3m_to_total_3m,
	transaction_pharmacies_trans_sum_3m_to_total_3m,
	transaction_pharmacies_trans_cnt_3m_to_total_6m,
	transaction_pharmacies_trans_sum_3m_to_total_6m,
	transaction_pharmacies_trans_cnt_6m_to_total_6m,
	transaction_pharmacies_trans_sum_6m_to_total_6m,
	transaction_pharmacies_trans_avg_sum_1m_to_3m,
	transaction_pharmacies_trans_avg_cnt_1m_to_3m,
	transaction_pharmacies_trans_avg_sum_3m_to_6m,
	transaction_pharmacies_trans_avg_cnt_3m_to_6m,
	transaction_pharmacies_trans_avg_sum_1m_to_total_1m,
	transaction_pharmacies_trans_avg_cnt_1m_to_total_1m,
	transaction_pharmacies_trans_avg_sum_3m_to_total_3m,
	transaction_pharmacies_trans_avg_cnt_3m_to_total_3m,
	transaction_pharmacies_trans_avg_sum_3m_to_total_6m,
	transaction_pharmacies_trans_avg_cnt_3m_to_total_6m,
	transaction_pharmacies_trans_avg_sum_6m_to_total_6m,
	transaction_pharmacies_trans_avg_cnt_6m_to_total_6m,

	transaction_flowers_trans_cnt_1m_to_3m,
	transaction_flowers_trans_sum_1m_to_3m,
	transaction_flowers_trans_cnt_3m_to_6m,
	transaction_flowers_trans_sum_3m_to_6m,
	transaction_flowers_trans_cnt_1m_to_total_1m,
	transaction_flowers_trans_sum_1m_to_total_1m,
	transaction_flowers_trans_cnt_3m_to_total_3m,
	transaction_flowers_trans_sum_3m_to_total_3m,
	transaction_flowers_trans_cnt_3m_to_total_6m,
	transaction_flowers_trans_sum_3m_to_total_6m,
	transaction_flowers_trans_cnt_6m_to_total_6m,
	transaction_flowers_trans_sum_6m_to_total_6m,
	transaction_flowers_trans_avg_sum_1m_to_3m,
	transaction_flowers_trans_avg_cnt_1m_to_3m,
	transaction_flowers_trans_avg_sum_3m_to_6m,
	transaction_flowers_trans_avg_cnt_3m_to_6m,
	transaction_flowers_trans_avg_sum_1m_to_total_1m,
	transaction_flowers_trans_avg_cnt_1m_to_total_1m,
	transaction_flowers_trans_avg_sum_3m_to_total_3m,
	transaction_flowers_trans_avg_cnt_3m_to_total_3m,
	transaction_flowers_trans_avg_sum_3m_to_total_6m,
	transaction_flowers_trans_avg_cnt_3m_to_total_6m,
	transaction_flowers_trans_avg_sum_6m_to_total_6m,
	transaction_flowers_trans_avg_cnt_6m_to_total_6m,

	transaction_train_trans_cnt_1m_to_3m,
	transaction_train_trans_sum_1m_to_3m,
	transaction_train_trans_cnt_3m_to_6m,
	transaction_train_trans_sum_3m_to_6m,
	transaction_train_trans_cnt_1m_to_total_1m,
	transaction_train_trans_sum_1m_to_total_1m,
	transaction_train_trans_cnt_3m_to_total_3m,
	transaction_train_trans_sum_3m_to_total_3m,
	transaction_train_trans_cnt_3m_to_total_6m,
	transaction_train_trans_sum_3m_to_total_6m,
	transaction_train_trans_cnt_6m_to_total_6m,
	transaction_train_trans_sum_6m_to_total_6m,
	transaction_train_trans_avg_sum_1m_to_3m,
	transaction_train_trans_avg_cnt_1m_to_3m,
	transaction_train_trans_avg_sum_3m_to_6m,
	transaction_train_trans_avg_cnt_3m_to_6m,
	transaction_train_trans_avg_sum_1m_to_total_1m,
	transaction_train_trans_avg_cnt_1m_to_total_1m,
	transaction_train_trans_avg_sum_3m_to_total_3m,
	transaction_train_trans_avg_cnt_3m_to_total_3m,
	transaction_train_trans_avg_sum_3m_to_total_6m,
	transaction_train_trans_avg_cnt_3m_to_total_6m,
	transaction_train_trans_avg_sum_6m_to_total_6m,
	transaction_train_trans_avg_cnt_6m_to_total_6m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_gambling_trans_cnt_1m_to_3m,
	transaction_gambling_trans_sum_1m_to_3m,
	transaction_gambling_trans_cnt_3m_to_6m,
	transaction_gambling_trans_sum_3m_to_6m,
	transaction_gambling_trans_cnt_1m_to_total_1m,
	transaction_gambling_trans_sum_1m_to_total_1m,
	transaction_gambling_trans_cnt_3m_to_total_3m,
	transaction_gambling_trans_sum_3m_to_total_3m,
	transaction_gambling_trans_cnt_3m_to_total_6m,
	transaction_gambling_trans_sum_3m_to_total_6m,
	transaction_gambling_trans_cnt_6m_to_total_6m,
	transaction_gambling_trans_sum_6m_to_total_6m,
	transaction_gambling_trans_avg_sum_1m_to_3m,
	transaction_gambling_trans_avg_cnt_1m_to_3m,
	transaction_gambling_trans_avg_sum_3m_to_6m,
	transaction_gambling_trans_avg_cnt_3m_to_6m,
	transaction_gambling_trans_avg_sum_1m_to_total_1m,
	transaction_gambling_trans_avg_cnt_1m_to_total_1m,
	transaction_gambling_trans_avg_sum_3m_to_total_3m,
	transaction_gambling_trans_avg_cnt_3m_to_total_3m,
	transaction_gambling_trans_avg_sum_3m_to_total_6m,
	transaction_gambling_trans_avg_cnt_3m_to_total_6m,
	transaction_gambling_trans_avg_sum_6m_to_total_6m,
	transaction_gambling_trans_avg_cnt_6m_to_total_6m,

	transaction_digital_goods_trans_cnt_1m_to_3m,
	transaction_digital_goods_trans_sum_1m_to_3m,
	transaction_digital_goods_trans_cnt_3m_to_6m,
	transaction_digital_goods_trans_sum_3m_to_6m,
	transaction_digital_goods_trans_cnt_1m_to_total_1m,
	transaction_digital_goods_trans_sum_1m_to_total_1m,
	transaction_digital_goods_trans_cnt_3m_to_total_3m,
	transaction_digital_goods_trans_sum_3m_to_total_3m,
	transaction_digital_goods_trans_cnt_3m_to_total_6m,
	transaction_digital_goods_trans_sum_3m_to_total_6m,
	transaction_digital_goods_trans_cnt_6m_to_total_6m,
	transaction_digital_goods_trans_sum_6m_to_total_6m,
	transaction_digital_goods_trans_avg_sum_1m_to_3m,
	transaction_digital_goods_trans_avg_cnt_1m_to_3m,
	transaction_digital_goods_trans_avg_sum_3m_to_6m,
	transaction_digital_goods_trans_avg_cnt_3m_to_6m,
	transaction_digital_goods_trans_avg_sum_1m_to_total_1m,
	transaction_digital_goods_trans_avg_cnt_1m_to_total_1m,
	transaction_digital_goods_trans_avg_sum_3m_to_total_3m,
	transaction_digital_goods_trans_avg_cnt_3m_to_total_3m,
	transaction_digital_goods_trans_avg_sum_3m_to_total_6m,
	transaction_digital_goods_trans_avg_cnt_3m_to_total_6m,
	transaction_digital_goods_trans_avg_sum_6m_to_total_6m,
	transaction_digital_goods_trans_avg_cnt_6m_to_total_6m,

	transaction_books_trans_cnt_1m_to_3m,
	transaction_books_trans_sum_1m_to_3m,
	transaction_books_trans_cnt_3m_to_6m,
	transaction_books_trans_sum_3m_to_6m,
	transaction_books_trans_cnt_1m_to_total_1m,
	transaction_books_trans_sum_1m_to_total_1m,
	transaction_books_trans_cnt_3m_to_total_3m,
	transaction_books_trans_sum_3m_to_total_3m,
	transaction_books_trans_cnt_3m_to_total_6m,
	transaction_books_trans_sum_3m_to_total_6m,
	transaction_books_trans_cnt_6m_to_total_6m,
	transaction_books_trans_sum_6m_to_total_6m,
	transaction_books_trans_avg_sum_1m_to_3m,
	transaction_books_trans_avg_cnt_1m_to_3m,
	transaction_books_trans_avg_sum_3m_to_6m,
	transaction_books_trans_avg_cnt_3m_to_6m,
	transaction_books_trans_avg_sum_1m_to_total_1m,
	transaction_books_trans_avg_cnt_1m_to_total_1m,
	transaction_books_trans_avg_sum_3m_to_total_3m,
	transaction_books_trans_avg_cnt_3m_to_total_3m,
	transaction_books_trans_avg_sum_3m_to_total_6m,
	transaction_books_trans_avg_cnt_3m_to_total_6m,
	transaction_books_trans_avg_sum_6m_to_total_6m,
	transaction_books_trans_avg_cnt_6m_to_total_6m,

	transaction_fuel_trans_cnt_1m_to_3m,
	transaction_fuel_trans_sum_1m_to_3m,
	transaction_fuel_trans_cnt_3m_to_6m,
	transaction_fuel_trans_sum_3m_to_6m,
	transaction_fuel_trans_cnt_1m_to_total_1m,
	transaction_fuel_trans_sum_1m_to_total_1m,
	transaction_fuel_trans_cnt_3m_to_total_3m,
	transaction_fuel_trans_sum_3m_to_total_3m,
	transaction_fuel_trans_cnt_3m_to_total_6m,
	transaction_fuel_trans_sum_3m_to_total_6m,
	transaction_fuel_trans_cnt_6m_to_total_6m,
	transaction_fuel_trans_sum_6m_to_total_6m,
	transaction_fuel_trans_avg_sum_1m_to_3m,
	transaction_fuel_trans_avg_cnt_1m_to_3m,
	transaction_fuel_trans_avg_sum_3m_to_6m,
	transaction_fuel_trans_avg_cnt_3m_to_6m,
	transaction_fuel_trans_avg_sum_1m_to_total_1m,
	transaction_fuel_trans_avg_cnt_1m_to_total_1m,
	transaction_fuel_trans_avg_sum_3m_to_total_3m,
	transaction_fuel_trans_avg_cnt_3m_to_total_3m,
	transaction_fuel_trans_avg_sum_3m_to_total_6m,
	transaction_fuel_trans_avg_cnt_3m_to_total_6m,
	transaction_fuel_trans_avg_sum_6m_to_total_6m,
	transaction_fuel_trans_avg_cnt_6m_to_total_6m,

	transaction_yandex_trans_cnt_1m_to_3m,
	transaction_yandex_trans_sum_1m_to_3m,
	transaction_yandex_trans_cnt_3m_to_6m,
	transaction_yandex_trans_sum_3m_to_6m,
	transaction_yandex_trans_cnt_1m_to_total_1m,
	transaction_yandex_trans_sum_1m_to_total_1m,
	transaction_yandex_trans_cnt_3m_to_total_3m,
	transaction_yandex_trans_sum_3m_to_total_3m,
	transaction_yandex_trans_cnt_3m_to_total_6m,
	transaction_yandex_trans_sum_3m_to_total_6m,
	transaction_yandex_trans_cnt_6m_to_total_6m,
	transaction_yandex_trans_sum_6m_to_total_6m,
	transaction_yandex_trans_avg_sum_1m_to_3m,
	transaction_yandex_trans_avg_cnt_1m_to_3m,
	transaction_yandex_trans_avg_sum_3m_to_6m,
	transaction_yandex_trans_avg_cnt_3m_to_6m,
	transaction_yandex_trans_avg_sum_1m_to_total_1m,
	transaction_yandex_trans_avg_cnt_1m_to_total_1m,
	transaction_yandex_trans_avg_sum_3m_to_total_3m,
	transaction_yandex_trans_avg_cnt_3m_to_total_3m,
	transaction_yandex_trans_avg_sum_3m_to_total_6m,
	transaction_yandex_trans_avg_cnt_3m_to_total_6m,
	transaction_yandex_trans_avg_sum_6m_to_total_6m,
	transaction_yandex_trans_avg_cnt_6m_to_total_6m,

	transaction_beauty_trans_cnt_1m_to_3m,
	transaction_beauty_trans_sum_1m_to_3m,
	transaction_beauty_trans_cnt_3m_to_6m,
	transaction_beauty_trans_sum_3m_to_6m,
	transaction_beauty_trans_cnt_1m_to_total_1m,
	transaction_beauty_trans_sum_1m_to_total_1m,
	transaction_beauty_trans_cnt_3m_to_total_3m,
	transaction_beauty_trans_sum_3m_to_total_3m,
	transaction_beauty_trans_cnt_3m_to_total_6m,
	transaction_beauty_trans_sum_3m_to_total_6m,
	transaction_beauty_trans_cnt_6m_to_total_6m,
	transaction_beauty_trans_sum_6m_to_total_6m,
	transaction_beauty_trans_avg_sum_1m_to_3m,
	transaction_beauty_trans_avg_cnt_1m_to_3m,
	transaction_beauty_trans_avg_sum_3m_to_6m,
	transaction_beauty_trans_avg_cnt_3m_to_6m,
	transaction_beauty_trans_avg_sum_1m_to_total_1m,
	transaction_beauty_trans_avg_cnt_1m_to_total_1m,
	transaction_beauty_trans_avg_sum_3m_to_total_3m,
	transaction_beauty_trans_avg_cnt_3m_to_total_3m,
	transaction_beauty_trans_avg_sum_3m_to_total_6m,
	transaction_beauty_trans_avg_cnt_3m_to_total_6m,
	transaction_beauty_trans_avg_sum_6m_to_total_6m,
	transaction_beauty_trans_avg_cnt_6m_to_total_6m,

	transaction_cinema_trans_cnt_1m_to_3m,
	transaction_cinema_trans_sum_1m_to_3m,
	transaction_cinema_trans_cnt_3m_to_6m,
	transaction_cinema_trans_sum_3m_to_6m,
	transaction_cinema_trans_cnt_1m_to_total_1m,
	transaction_cinema_trans_sum_1m_to_total_1m,
	transaction_cinema_trans_cnt_3m_to_total_3m,
	transaction_cinema_trans_sum_3m_to_total_3m,
	transaction_cinema_trans_cnt_3m_to_total_6m,
	transaction_cinema_trans_sum_3m_to_total_6m,
	transaction_cinema_trans_cnt_6m_to_total_6m,
	transaction_cinema_trans_sum_6m_to_total_6m,
	transaction_cinema_trans_avg_sum_1m_to_3m,
	transaction_cinema_trans_avg_cnt_1m_to_3m,
	transaction_cinema_trans_avg_sum_3m_to_6m,
	transaction_cinema_trans_avg_cnt_3m_to_6m,
	transaction_cinema_trans_avg_sum_1m_to_total_1m,
	transaction_cinema_trans_avg_cnt_1m_to_total_1m,
	transaction_cinema_trans_avg_sum_3m_to_total_3m,
	transaction_cinema_trans_avg_cnt_3m_to_total_3m,
	transaction_cinema_trans_avg_sum_3m_to_total_6m,
	transaction_cinema_trans_avg_cnt_3m_to_total_6m,
	transaction_cinema_trans_avg_sum_6m_to_total_6m,
	transaction_cinema_trans_avg_cnt_6m_to_total_6m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_charity_trans_cnt_1m_to_3m,
	transaction_charity_trans_sum_1m_to_3m,
	transaction_charity_trans_cnt_3m_to_6m,
	transaction_charity_trans_sum_3m_to_6m,
	transaction_charity_trans_cnt_1m_to_total_1m,
	transaction_charity_trans_sum_1m_to_total_1m,
	transaction_charity_trans_cnt_3m_to_total_3m,
	transaction_charity_trans_sum_3m_to_total_3m,
	transaction_charity_trans_cnt_3m_to_total_6m,
	transaction_charity_trans_sum_3m_to_total_6m,
	transaction_charity_trans_cnt_6m_to_total_6m,
	transaction_charity_trans_sum_6m_to_total_6m,
	transaction_charity_trans_avg_sum_1m_to_3m,
	transaction_charity_trans_avg_cnt_1m_to_3m,
	transaction_charity_trans_avg_sum_3m_to_6m,
	transaction_charity_trans_avg_cnt_3m_to_6m,
	transaction_charity_trans_avg_sum_1m_to_total_1m,
	transaction_charity_trans_avg_cnt_1m_to_total_1m,
	transaction_charity_trans_avg_sum_3m_to_total_3m,
	transaction_charity_trans_avg_cnt_3m_to_total_3m,
	transaction_charity_trans_avg_sum_3m_to_total_6m,
	transaction_charity_trans_avg_cnt_3m_to_total_6m,
	transaction_charity_trans_avg_sum_6m_to_total_6m,
	transaction_charity_trans_avg_cnt_6m_to_total_6m,

	transaction_auto_services_trans_cnt_1m_to_3m,
	transaction_auto_services_trans_sum_1m_to_3m,
	transaction_auto_services_trans_cnt_3m_to_6m,
	transaction_auto_services_trans_sum_3m_to_6m,
	transaction_auto_services_trans_cnt_1m_to_total_1m,
	transaction_auto_services_trans_sum_1m_to_total_1m,
	transaction_auto_services_trans_cnt_3m_to_total_3m,
	transaction_auto_services_trans_sum_3m_to_total_3m,
	transaction_auto_services_trans_cnt_3m_to_total_6m,
	transaction_auto_services_trans_sum_3m_to_total_6m,
	transaction_auto_services_trans_cnt_6m_to_total_6m,
	transaction_auto_services_trans_sum_6m_to_total_6m,
	transaction_auto_services_trans_avg_sum_1m_to_3m,
	transaction_auto_services_trans_avg_cnt_1m_to_3m,
	transaction_auto_services_trans_avg_sum_3m_to_6m,
	transaction_auto_services_trans_avg_cnt_3m_to_6m,
	transaction_auto_services_trans_avg_sum_1m_to_total_1m,
	transaction_auto_services_trans_avg_cnt_1m_to_total_1m,
	transaction_auto_services_trans_avg_sum_3m_to_total_3m,
	transaction_auto_services_trans_avg_cnt_3m_to_total_3m,
	transaction_auto_services_trans_avg_sum_3m_to_total_6m,
	transaction_auto_services_trans_avg_cnt_3m_to_total_6m,
	transaction_auto_services_trans_avg_sum_6m_to_total_6m,
	transaction_auto_services_trans_avg_cnt_6m_to_total_6m,

	transaction_consulting_trans_cnt_1m_to_3m,
	transaction_consulting_trans_sum_1m_to_3m,
	transaction_consulting_trans_cnt_3m_to_6m,
	transaction_consulting_trans_sum_3m_to_6m,
	transaction_consulting_trans_cnt_1m_to_total_1m,
	transaction_consulting_trans_sum_1m_to_total_1m,
	transaction_consulting_trans_cnt_3m_to_total_3m,
	transaction_consulting_trans_sum_3m_to_total_3m,
	transaction_consulting_trans_cnt_3m_to_total_6m,
	transaction_consulting_trans_sum_3m_to_total_6m,
	transaction_consulting_trans_cnt_6m_to_total_6m,
	transaction_consulting_trans_sum_6m_to_total_6m,
	transaction_consulting_trans_avg_sum_1m_to_3m,
	transaction_consulting_trans_avg_cnt_1m_to_3m,
	transaction_consulting_trans_avg_sum_3m_to_6m,
	transaction_consulting_trans_avg_cnt_3m_to_6m,
	transaction_consulting_trans_avg_sum_1m_to_total_1m,
	transaction_consulting_trans_avg_cnt_1m_to_total_1m,
	transaction_consulting_trans_avg_sum_3m_to_total_3m,
	transaction_consulting_trans_avg_cnt_3m_to_total_3m,
	transaction_consulting_trans_avg_sum_3m_to_total_6m,
	transaction_consulting_trans_avg_cnt_3m_to_total_6m,
	transaction_consulting_trans_avg_sum_6m_to_total_6m,
	transaction_consulting_trans_avg_cnt_6m_to_total_6m,

	transaction_other_trans_cnt_1m_to_3m,
	transaction_other_trans_sum_1m_to_3m,
	transaction_other_trans_cnt_3m_to_6m,
	transaction_other_trans_sum_3m_to_6m,
	transaction_other_trans_cnt_1m_to_total_1m,
	transaction_other_trans_sum_1m_to_total_1m,
	transaction_other_trans_cnt_3m_to_total_3m,
	transaction_other_trans_sum_3m_to_total_3m,
	transaction_other_trans_cnt_3m_to_total_6m,
	transaction_other_trans_sum_3m_to_total_6m,
	transaction_other_trans_cnt_6m_to_total_6m,
	transaction_other_trans_sum_6m_to_total_6m,
	transaction_other_trans_avg_sum_1m_to_3m,
	transaction_other_trans_avg_cnt_1m_to_3m,
	transaction_other_trans_avg_sum_3m_to_6m,
	transaction_other_trans_avg_cnt_3m_to_6m,
	transaction_other_trans_avg_sum_1m_to_total_1m,
	transaction_other_trans_avg_cnt_1m_to_total_1m,
	transaction_other_trans_avg_sum_3m_to_total_3m,
	transaction_other_trans_avg_cnt_3m_to_total_3m,
	transaction_other_trans_avg_sum_3m_to_total_6m,
	transaction_other_trans_avg_cnt_3m_to_total_6m,
	transaction_other_trans_avg_sum_6m_to_total_6m,
	transaction_other_trans_avg_cnt_6m_to_total_6m,

	transaction_utilities_trans_cnt_1m_to_3m,
	transaction_utilities_trans_sum_1m_to_3m,
	transaction_utilities_trans_cnt_3m_to_6m,
	transaction_utilities_trans_sum_3m_to_6m,
	transaction_utilities_trans_cnt_1m_to_total_1m,
	transaction_utilities_trans_sum_1m_to_total_1m,
	transaction_utilities_trans_cnt_3m_to_total_3m,
	transaction_utilities_trans_sum_3m_to_total_3m,
	transaction_utilities_trans_cnt_3m_to_total_6m,
	transaction_utilities_trans_sum_3m_to_total_6m,
	transaction_utilities_trans_cnt_6m_to_total_6m,
	transaction_utilities_trans_sum_6m_to_total_6m,
	transaction_utilities_trans_avg_sum_1m_to_3m,
	transaction_utilities_trans_avg_cnt_1m_to_3m,
	transaction_utilities_trans_avg_sum_3m_to_6m,
	transaction_utilities_trans_avg_cnt_3m_to_6m,
	transaction_utilities_trans_avg_sum_1m_to_total_1m,
	transaction_utilities_trans_avg_cnt_1m_to_total_1m,
	transaction_utilities_trans_avg_sum_3m_to_total_3m,
	transaction_utilities_trans_avg_cnt_3m_to_total_3m,
	transaction_utilities_trans_avg_sum_3m_to_total_6m,
	transaction_utilities_trans_avg_cnt_3m_to_total_6m,
	transaction_utilities_trans_avg_sum_6m_to_total_6m,
	transaction_utilities_trans_avg_cnt_6m_to_total_6m,
';
dbms_lob.append(my_str, add_str);
add_str:='
	transaction_tech_trans_cnt_1m_to_3m,
	transaction_tech_trans_sum_1m_to_3m,
	transaction_tech_trans_cnt_3m_to_6m,
	transaction_tech_trans_sum_3m_to_6m,
	transaction_tech_trans_cnt_1m_to_total_1m,
	transaction_tech_trans_sum_1m_to_total_1m,
	transaction_tech_trans_cnt_3m_to_total_3m,
	transaction_tech_trans_sum_3m_to_total_3m,
	transaction_tech_trans_cnt_3m_to_total_6m,
	transaction_tech_trans_sum_3m_to_total_6m,
	transaction_tech_trans_cnt_6m_to_total_6m,
	transaction_tech_trans_sum_6m_to_total_6m,
	transaction_tech_trans_avg_sum_1m_to_3m,
	transaction_tech_trans_avg_cnt_1m_to_3m,
	transaction_tech_trans_avg_sum_3m_to_6m,
	transaction_tech_trans_avg_cnt_3m_to_6m,
	transaction_tech_trans_avg_sum_1m_to_total_1m,
	transaction_tech_trans_avg_cnt_1m_to_total_1m,
	transaction_tech_trans_avg_sum_3m_to_total_3m,
	transaction_tech_trans_avg_cnt_3m_to_total_3m,
	transaction_tech_trans_avg_sum_3m_to_total_6m,
	transaction_tech_trans_avg_cnt_3m_to_total_6m,
	transaction_tech_trans_avg_sum_6m_to_total_6m,
	transaction_tech_trans_avg_cnt_6m_to_total_6m,

	transaction_jewelry_trans_cnt_1m_to_3m,
	transaction_jewelry_trans_sum_1m_to_3m,
	transaction_jewelry_trans_cnt_3m_to_6m,
	transaction_jewelry_trans_sum_3m_to_6m,
	transaction_jewelry_trans_cnt_1m_to_total_1m,
	transaction_jewelry_trans_sum_1m_to_total_1m,
	transaction_jewelry_trans_cnt_3m_to_total_3m,
	transaction_jewelry_trans_sum_3m_to_total_3m,
	transaction_jewelry_trans_cnt_3m_to_total_6m,
	transaction_jewelry_trans_sum_3m_to_total_6m,
	transaction_jewelry_trans_cnt_6m_to_total_6m,
	transaction_jewelry_trans_sum_6m_to_total_6m,
	transaction_jewelry_trans_avg_sum_1m_to_3m,
	transaction_jewelry_trans_avg_cnt_1m_to_3m,
	transaction_jewelry_trans_avg_sum_3m_to_6m,
	transaction_jewelry_trans_avg_cnt_3m_to_6m,
	transaction_jewelry_trans_avg_sum_1m_to_total_1m,
	transaction_jewelry_trans_avg_cnt_1m_to_total_1m,
	transaction_jewelry_trans_avg_sum_3m_to_total_3m,
	transaction_jewelry_trans_avg_cnt_3m_to_total_3m,
	transaction_jewelry_trans_avg_sum_3m_to_total_6m,
	transaction_jewelry_trans_avg_cnt_3m_to_total_6m,
	transaction_jewelry_trans_avg_sum_6m_to_total_6m,
	transaction_jewelry_trans_avg_cnt_6m_to_total_6m,

	transaction_clothes_trans_cnt_1m_to_3m,
	transaction_clothes_trans_sum_1m_to_3m,
	transaction_clothes_trans_cnt_3m_to_6m,
	transaction_clothes_trans_sum_3m_to_6m,
	transaction_clothes_trans_cnt_1m_to_total_1m,
	transaction_clothes_trans_sum_1m_to_total_1m,
	transaction_clothes_trans_cnt_3m_to_total_3m,
	transaction_clothes_trans_sum_3m_to_total_3m,
	transaction_clothes_trans_cnt_3m_to_total_6m,
	transaction_clothes_trans_sum_3m_to_total_6m,
	transaction_clothes_trans_cnt_6m_to_total_6m,
	transaction_clothes_trans_sum_6m_to_total_6m,
	transaction_clothes_trans_avg_sum_1m_to_3m,
	transaction_clothes_trans_avg_cnt_1m_to_3m,
	transaction_clothes_trans_avg_sum_3m_to_6m,
	transaction_clothes_trans_avg_cnt_3m_to_6m,
	transaction_clothes_trans_avg_sum_1m_to_total_1m,
	transaction_clothes_trans_avg_cnt_1m_to_total_1m,
	transaction_clothes_trans_avg_sum_3m_to_total_3m,
	transaction_clothes_trans_avg_cnt_3m_to_total_3m,
	transaction_clothes_trans_avg_sum_3m_to_total_6m,
	transaction_clothes_trans_avg_cnt_3m_to_total_6m,
	transaction_clothes_trans_avg_sum_6m_to_total_6m,
	transaction_clothes_trans_avg_cnt_6m_to_total_6m,

	transaction_education_trans_cnt_1m_to_3m,
	transaction_education_trans_sum_1m_to_3m,
	transaction_education_trans_cnt_3m_to_6m,
	transaction_education_trans_sum_3m_to_6m,
	transaction_education_trans_cnt_1m_to_total_1m,
	transaction_education_trans_sum_1m_to_total_1m,
	transaction_education_trans_cnt_3m_to_total_3m,
	transaction_education_trans_sum_3m_to_total_3m,
	transaction_education_trans_cnt_3m_to_total_6m,
	transaction_education_trans_sum_3m_to_total_6m,
	transaction_education_trans_cnt_6m_to_total_6m,
	transaction_education_trans_sum_6m_to_total_6m,
	transaction_education_trans_avg_sum_1m_to_3m,
	transaction_education_trans_avg_cnt_1m_to_3m,
	transaction_education_trans_avg_sum_3m_to_6m,
	transaction_education_trans_avg_cnt_3m_to_6m,
	transaction_education_trans_avg_sum_1m_to_total_1m,
	transaction_education_trans_avg_cnt_1m_to_total_1m,
	transaction_education_trans_avg_sum_3m_to_total_3m,
	transaction_education_trans_avg_cnt_3m_to_total_3m,
	transaction_education_trans_avg_sum_3m_to_total_6m,
	transaction_education_trans_avg_cnt_3m_to_total_6m,
	transaction_education_trans_avg_sum_6m_to_total_6m,
	transaction_education_trans_avg_cnt_6m_to_total_6m,

	transaction_finance_trans_cnt_1m_to_3m,
	transaction_finance_trans_sum_1m_to_3m,
	transaction_finance_trans_cnt_3m_to_6m,
	transaction_finance_trans_sum_3m_to_6m,
	transaction_finance_trans_cnt_1m_to_total_1m,
	transaction_finance_trans_sum_1m_to_total_1m,
	transaction_finance_trans_cnt_3m_to_total_3m,
	transaction_finance_trans_sum_3m_to_total_3m,
	transaction_finance_trans_cnt_3m_to_total_6m,
	transaction_finance_trans_sum_3m_to_total_6m,
	transaction_finance_trans_cnt_6m_to_total_6m,
	transaction_finance_trans_sum_6m_to_total_6m,
	transaction_finance_trans_avg_sum_1m_to_3m,
	transaction_finance_trans_avg_cnt_1m_to_3m,
	transaction_finance_trans_avg_sum_3m_to_6m,
	transaction_finance_trans_avg_cnt_3m_to_6m,
	transaction_finance_trans_avg_sum_1m_to_total_1m,
	transaction_finance_trans_avg_cnt_1m_to_total_1m,
	transaction_finance_trans_avg_sum_3m_to_total_3m,
	transaction_finance_trans_avg_cnt_3m_to_total_3m,
	transaction_finance_trans_avg_sum_3m_to_total_6m,
	transaction_finance_trans_avg_cnt_3m_to_total_6m,
	transaction_finance_trans_avg_sum_6m_to_total_6m,
	transaction_finance_trans_avg_cnt_6m_to_total_6m,
    
	-- model_mcc
	transaction_supermarkets_trans_cnt_12m_to_total_12m

from '||in_table||' a
LEFT JOIN '||in_table||'_TRANS_TEMP_48 t48
    ON t48.client_did = a.client_did
    AND t48.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_49 t49
    ON t49.client_did = a.client_did
    AND t49.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_50 t50
    ON t50.client_did = a.client_did
    AND t50.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_51 t51
    ON t51.client_did = a.client_did
    AND t51.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_52 t52
    ON t52.client_did = a.client_did
    AND t52.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_53 t53
    ON t53.client_did = a.client_did
    AND t53.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_54 t54
    ON t54.client_did = a.client_did
    AND t54.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_55 t55
    ON t55.client_did = a.client_did
    AND t55.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_56 t56
    ON t56.client_did = a.client_did
    AND t56.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_57 t57
    ON t57.client_did = a.client_did
    AND t57.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_58 t58
    ON t58.client_did = a.client_did
    AND t58.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_59 t59
    ON t59.client_did = a.client_did
    AND t59.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_60 t60
    ON t60.client_did = a.client_did
    AND t60.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_61 t61
    ON t61.client_did = a.client_did
    AND t61.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_62 t62
    ON t62.client_did = a.client_did
    AND t62.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_63 t63
    ON t63.client_did = a.client_did
    AND t63.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_64 t64
    ON t64.client_did = a.client_did
    AND t64.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_65 t65
    ON t65.client_did = a.client_did
    AND t65.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_66 t66
    ON t66.client_did = a.client_did
    AND t66.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_67 t67
    ON t67.client_did = a.client_did
    AND t67.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_68 t68
    ON t68.client_did = a.client_did
    AND t68.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_69 t69
    ON t69.client_did = a.client_did
    AND t69.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_70 t70
    ON t70.client_did = a.client_did
    AND t70.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_71 t71
    ON t71.client_did = a.client_did
    AND t71.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_72 t72
    ON t72.client_did = a.client_did
    AND t72.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_73 t73
    ON t73.client_did = a.client_did
    AND t73.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_74 t74
    ON t74.client_did = a.client_did
    AND t74.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_75 t75
    ON t75.client_did = a.client_did
    AND t75.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_76 t76
    ON t76.client_did = a.client_did
    AND t76.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_77 t77
    ON t77.client_did = a.client_did
    AND t77.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_78 t78
    ON t78.client_did = a.client_did
    AND t78.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_79 t79
    ON t79.client_did = a.client_did
    AND t79.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_80 t80
    ON t80.client_did = a.client_did
    AND t80.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_81 t81
    ON t81.client_did = a.client_did
    AND t81.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_82 t82
    ON t82.client_did = a.client_did
    AND t82.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_83 t83
    ON t83.client_did = a.client_did
    AND t83.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_84 t84
    ON t84.client_did = a.client_did
    AND t84.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_85 t85
    ON t85.client_did = a.client_did
    AND t85.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_86 t86
    ON t86.client_did = a.client_did
    AND t86.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_87 t87
    ON t87.client_did = a.client_did
    AND t87.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_88 t88
    ON t88.client_did = a.client_did
    AND t88.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_89 t89
    ON t89.client_did = a.client_did
    AND t89.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_90 t90
    ON t90.client_did = a.client_did
    AND t90.report_date = a.report_date
LEFT JOIN '||in_table||'_TRANS_TEMP_91 t91
    ON t91.client_did = a.client_did
    AND t91.report_date = a.report_date
';

dbms_lob.append(my_str, add_str);

execute immediate my_str;

execute immediate 'create index idx_ema_'||out_table_1||' on '||out_table_1||' (client_did, report_date) PARALLEL 8';

execute immediate 'create index idx_ema_'||out_table_2||' on '||out_table_2||' (client_did, report_date) PARALLEL 8';

execute immediate 'create index idx_ema_'||out_table_3||' on '||out_table_3||' (client_did, report_date) PARALLEL 8';

execute immediate 'grant select on '||out_table_1||' to public';  
execute immediate 'grant select on '||out_table_2||' to public'; 
execute immediate 'grant select on '||out_table_3||' to public'; 


drop_table_if_exists(upper(concat(in_table, '_trans_p1')));
drop_table_if_exists(upper(concat(in_table, '_trans_p2')));

drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_00')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_0')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_1')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_2')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_3')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_4')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_5')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_6')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_7')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_8')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_9')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_10')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_11')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_12')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_13')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_14')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_15')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_16')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_17')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_18')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_19')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_20')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_21')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_22')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_23')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_24')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_25')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_26')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_27')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_28')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_29')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_30')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_31')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_32')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_33')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_34')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_35')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_36')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_37')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_38')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_39')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_40')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_41')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_42')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_43')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_44')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_45')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_46')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_47')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_48')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_49')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_50')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_51')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_52')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_53')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_54')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_55')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_56')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_57')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_58')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_59')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_60')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_61')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_62')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_63')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_64')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_65')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_66')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_67')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_68')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_69')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_70')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_71')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_72')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_73')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_74')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_75')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_76')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_77')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_78')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_79')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_80')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_81')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_82')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_83')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_84')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_85')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_86')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_87')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_88')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_89')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_90')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_91')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_92')));
drop_table_if_exists(upper(concat(in_table, '_TRANS_TEMP_93')));

END;
