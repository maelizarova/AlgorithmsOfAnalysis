def feature_selection_shap(
    data: pd.DataFrame,
    targets: List[str],
    selected_features: Dict[str, List[str]],
    categorical_features: List[str] = None,
    eval_set: pd.DataFrame = None,
    num_features_to_select: int = 20,
    threads: int = -1
) -> Dict[str, List[str]]:
    """
    Дополнительный отбор признаков с помощью SHAP-значений через CatBoost.

    Параметры:
    ----------
    data : pd.DataFrame
        Входной DataFrame с признаками и целевыми переменными.
    targets : List[str]
        Список имен целевых переменных.
    selected_features : Dict[str, List[str]]
        Словарь с предварительно отобранными признаками для каждой целевой переменной.
        Формат: {target_name: [feature1, feature2, ...]}
    categorical_features : List[str], default=None
        Список категориальных признаков.
    eval_set : pd.DataFrame, default=None
        Валидационный набор данных для оценки модели.
    num_features_to_select : int, default=20
        Количество признаков для отбора.
    threads : int, default=-1
        Количество потоков для параллельных вычислений (-1 означает использование всех доступных ядер).

    Возвращает:
    -----------
    Dict[str, List[str]]
        Словарь с отобранными признаками для каждой целевой переменной.
        Формат: {target_name: [selected_feature1, selected_feature2, ...]}

    Пример использования:
    ---------------------
    >>> import pandas as pd
    >>> from catboost import CatBoostClassifier
    >>>
    >>> data = pd.DataFrame({
    ...     'feature1': [1, 2, 3, 4],
    ...     'feature2': [4, 3, 2, 1],
    ...     'feature3': [0.1, 0.5, 0.3, 0.8],
    ...     'target': [0, 1, 0, 1]
    ... })
    >>>
    >>> pre_selected = {'target': ['feature1', 'feature2', 'feature3']}
    >>> final_features = feature_selection_shap(
    ...     data=data,
    ...     targets=['target'],
    ...     selected_features=pre_selected,
    ...     num_features_to_select=2,
    ...     threads=4
    ... )
    >>> print(final_features)
    {'target': ['feature1', 'feature3']}

    Примечания:
    -----------
    - Функция использует CatBoost для расчета SHAP-значений.
    - Для категориальных признаков автоматически применяется соответствующая обработка.
    - Рекомендуется использовать после предварительного отбора признаков для уменьшения вычислительной нагрузки.
    """
    # Реализация функции...
    pass
